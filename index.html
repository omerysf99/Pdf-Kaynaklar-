<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SpyderCoin - Ads & Rewards Edition</title>

    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>

    <style>
        :root {
            --bg: #070708;
            --purple: #a855f7;
            --purple-glow: rgba(168, 85, 247, 0.4);
            --card: #141416;
            --text: #ffffff;
            --inactive: #8e8e93;
            --green: #10b981;
            --red: #ef4444;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; }
        body { background: var(--bg); color: var(--text); font-family: -apple-system, sans-serif; margin: 0; padding: 0; height: 100vh; overflow: hidden; display: flex; flex-direction: column; }

        .page { display: none; height: 100%; width: 100%; flex-direction: column; align-items: center; padding: 20px; overflow-y: auto; padding-bottom: 140px; }
        .page.active { display: flex; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* ğŸ•·ï¸ ANA EKRAN */
        .bal-val { font-size: 64px; font-weight: 900; margin: 10px 0; text-shadow: 0 0 20px var(--purple-glow); }
        .tap-zone { flex-grow: 1; display: flex; justify-content: center; align-items: center; position: relative; width: 100%; }
        .spider-btn { width: 240px; height: 240px; background: var(--purple); border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 110px; box-shadow: 0 0 60px var(--purple-glow); z-index: 5; transition: transform 0.05s; }
        .spider-btn:active { transform: scale(0.92); }

        /* ğŸ•¸ï¸ AÄ ANÄ°MASYONU */
        .web-ring { position: absolute; border: 2px solid white; border-radius: 50%; pointer-events: none; animation: webExpand 0.5s ease-out forwards; }
        @keyframes webExpand { 0% { width: 0; height: 0; opacity: 1; } 100% { width: 450px; height: 450px; opacity: 0; } }

        /* ğŸ”‹ ENERJÄ° */
        .energy-box { width: 100%; max-width: 400px; margin-bottom: 10px; }
        .bar-bg { width: 100%; height: 12px; background: #1c1c1e; border-radius: 10px; overflow: hidden; margin-top: 5px; }
        #energy-fill { height: 100%; width: 100%; background: var(--purple); transition: width 0.3s; }

        /* ğŸ’° CÃœZDAN & REKLAM ÅARTI */
        .wallet-card { background: var(--card); border-radius: 20px; padding: 25px; width: 100%; border: 1px solid #232326; margin-top: 20px; }
        .ad-counter { background: rgba(168, 85, 247, 0.1); border: 1px dashed var(--purple); padding: 15px; border-radius: 12px; margin: 15px 0; text-align: center; }
        .btn-ad { background: #fff; color: #000; border: none; width: 100%; padding: 15px; border-radius: 12px; font-weight: 900; margin-bottom: 10px; cursor: pointer; }
        .btn-withdraw { background: var(--purple); color: #fff; border: none; width: 100%; padding: 15px; border-radius: 12px; font-weight: 900; cursor: pointer; }
        .btn-withdraw:disabled { background: #333; color: #666; cursor: not-allowed; }

        input { width: 100%; background: #000; border: 1px solid #2c2c2e; padding: 15px; border-radius: 12px; color: #fff; margin-bottom: 15px; }

        /* ğŸ“± NAV */
        .nav-bar { position: fixed; bottom: 0; width: 100%; background: #0a0a0b; display: grid; grid-template-columns: repeat(4, 1fr); padding: 15px 0 35px; border-top: 1px solid #1c1c1e; }
        .nav-item { display: flex; flex-direction: column; align-items: center; color: var(--inactive); font-size: 11px; cursor: pointer; }
        .nav-item.active { color: var(--purple); }
    </style>
</head>
<body>

    <div id="p-home" class="page active">
        <div style="text-align:center; margin-top:20px;">
            <div style="color:var(--inactive); font-size:12px; letter-spacing:1px;">TOTAL BALANCE</div>
            <div class="bal-val" id="ui-bal">0</div>
        </div>
        <div class="tap-zone">
            <div class="spider-btn" id="spider-btn">ğŸ•·ï¸</div>
            <button id="adm-gate" style="display:none; position:absolute; top:0; right:0;" onclick="alert('Admin Active')">âš™ï¸</button>
        </div>
        <div class="energy-box">
            <div style="font-size:13px; color:var(--inactive);">âš¡ Energy: <span id="ui-nrg">1000</span> / 1000</div>
            <div class="bar-bg"><div id="energy-fill"></div></div>
        </div>
    </div>

    <div id="p-tasks" class="page">
        <h2 style="color:var(--purple)">GÃ¶revler</h2>
        <div class="wallet-card" style="display:flex; justify-content:space-between; align-items:center;">
            <div><b>Telegram KanalÄ±</b><br><span style="color:var(--purple)">+5,000 SPYDER</span></div>
            <button class="btn-withdraw" style="width:auto; padding:10px 20px;" onclick="tg.openTelegramLink('https://t.me/SpyderCommunity')">KatÄ±l</button>
        </div>
    </div>

    <div id="p-friends" class="page">
        <h2 style="color:var(--purple)">Dostlar</h2>
        <div class="wallet-card" style="text-align:center;">
            <p>ArkadaÅŸlarÄ±nÄ± Ã§aÄŸÄ±r, %10 kazanÃ§ saÄŸla!</p>
            <button class="btn-ad">Davet Linki Kopyala</button>
        </div>
    </div>

    <div id="p-wallet" class="page">
        <h2 style="color:var(--purple)">CÃ¼zdan</h2>
        
        <div style="text-align:center; margin:20px 0;">
            <div id="ui-usdt" style="font-size:48px; font-weight:900; color:var(--green);">$0.00</div>
            <div style="color:var(--inactive); font-size:12px;">Minimum Ã‡ekim: 0.01$ (1,000 SPYDER)</div>
        </div>

        <div class="wallet-card">
            <div class="ad-counter">
                <div style="font-size:12px; color:var(--inactive);">Ã–DEME KÄ°LÄ°DÄ°</div>
                <div style="font-size:18px; font-weight:bold; margin:5px 0;">
                    ğŸ“º Ä°zlenen Reklam: <span id="ui-ads">0</span> / 20
                </div>
                <div style="font-size:10px; color:var(--purple);">Her Ã§ekim iÃ§in 20 reklam izlemelisiniz.</div>
            </div>

            <button class="btn-ad" onclick="watchAd()">ğŸ¬ REKLAM Ä°ZLE (+1)</button>
            
            <label style="font-size:12px; color:var(--inactive); display:block; margin-bottom:5px;">USDT BEP20 ADRESÄ°</label>
            <input type="text" id="wallet-addr" placeholder="0x...">
            
            <button id="btn-withdraw" class="btn-withdraw" onclick="requestPayout()" disabled>Ã–DEME TALEP ET</button>
        </div>
    </div>

    <nav class="nav-bar">
        <div class="nav-item active" onclick="nav('p-home', this)"><span>ğŸ®</span>Oyna</div>
        <div class="nav-item" onclick="nav('p-tasks', this)"><span>ğŸ“‹</span>GÃ¶rev</div>
        <div class="nav-item" onclick="nav('p-friends', this)"><span>ğŸ‘¥</span>Dost</div>
        <div class="nav-item" onclick="nav('p-wallet', this)"><span>ğŸ’°</span>CÃ¼zdan</div>
    </nav>

    <script>
        // FIREBASE
        const firebaseConfig = { apiKey: "AIzaSy...", projectId: "spyder-coin" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        const tg = window.Telegram.WebApp;
        const user = tg.initDataUnsafe?.user || { id: "8392479231", first_name: "Admin" };

        let state = {
            bal: 0,
            nrg: 1000,
            ads: 0,
            wallet: ""
        };

        async function init() {
            tg.ready(); tg.expand();
            const doc = await db.collection('users').doc(String(user.id)).get();
            if (doc.exists) {
                state = { ...state, ...doc.data() };
            } else {
                await db.collection('users').doc(String(user.id)).set(state);
            }
            updateUI();
            setInterval(regen, 1000);
            setInterval(sync, 15000);
        }

        function handleTap(e) {
            if (state.nrg <= 0) return;
            state.bal++; state.nrg--;
            updateUI();
            
            // FX
            const ring = document.createElement('div');
            ring.className = 'web-ring';
            document.querySelector('.tap-zone').appendChild(ring);
            setTimeout(() => ring.remove(), 500);
            tg.HapticFeedback.impactOccurred('light');
        }

        function watchAd() {
            // Burada gerÃ§ek reklam SDK'nÄ±zÄ± (AdsGram vb.) baÄŸlayabilirsiniz.
            // Åimdilik simÃ¼le ediyoruz.
            tg.showConfirm("Reklam izleniyor... (SimÃ¼lasyon)", (ok) => {
                if(ok) {
                    state.ads++;
                    updateUI();
                    tg.showAlert("Reklam baÅŸarÄ±yla izlendi! " + state.ads + "/20");
                }
            });
        }

        function requestPayout() {
            const addr = document.getElementById('wallet-addr').value;
            if(!addr.startsWith("0x")) return tg.showAlert("GeÃ§erli bir BEP20 adresi girin!");
            
            tg.showConfirm("0.01$ tutarÄ±ndaki Ã¶deme talebiniz alÄ±nsÄ±n mÄ±?", (ok) => {
                if(ok) {
                    // Ã–deme sonrasÄ± reklam sayacÄ±nÄ± sÄ±fÄ±rla (isteÄŸe baÄŸlÄ±)
                    state.bal -= 1000;
                    state.ads = 0; 
                    sync();
                    updateUI();
                    tg.showAlert("Talebiniz alÄ±ndÄ±! Reklam sayacÄ±nÄ±z bir sonraki Ã§ekim iÃ§in sÄ±fÄ±rlandÄ±.");
                }
            });
        }

        function updateUI() {
            document.getElementById('ui-bal').innerText = state.bal.toLocaleString();
            document.getElementById('ui-nrg').innerText = state.nrg;
            document.getElementById('energy-fill').style.width = (state.nrg / 10) + "%";
            
            const usdtVal = (state.bal * 0.00001).toFixed(3);
            document.getElementById('ui-usdt').innerText = "$" + usdtVal;
            document.getElementById('ui-ads').innerText = state.ads;

            // ÅART KONTROLÃœ
            const btn = document.getElementById('btn-withdraw');
            if (state.bal >= 1000 && state.ads >= 20) {
                btn.disabled = false;
                btn.style.background = "var(--green)";
            } else {
                btn.disabled = true;
                btn.style.background = "#333";
            }
        }

        function regen() { if(state.nrg < 1000) { state.nrg++; updateUI(); } }
        async function sync() { await db.collection('users').doc(String(user.id)).update(state); }
        
        function nav(id, el) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            el.classList.add('active');
        }

        document.getElementById('spider-btn').addEventListener('touchstart', (e) => { e.preventDefault(); handleTap(e); });
        init();
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SpyderCoin - Realtime Rank</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --bg: #050505; --purple: #a855f7; --card: #151517; --text: #ffffff; --inactive: #71717a; }
        body { background: var(--bg); color: var(--text); font-family: sans-serif; margin: 0; padding: 0; height: 100vh; overflow: hidden; }

        .page { display: none; height: 100vh; flex-direction: column; align-items: center; padding: 20px; box-sizing: border-box; }
        .page.active { display: flex; }

        /* ğŸ•·ï¸ ANA EKRAN */
        .bal-text { font-size: 55px; font-weight: 900; margin-top: 30px; text-shadow: 0 0 20px var(--purple); }
        .tap-zone { position: relative; width: 280px; height: 280px; display: flex; justify-content: center; align-items: center; margin: 30px 0; touch-action: none; }
        .glow { position: absolute; width: 260px; height: 260px; border: 8px solid var(--purple); border-radius: 50%; box-shadow: 0 0 40px var(--purple); }
        #spider-main { width: 190px; z-index: 10; transition: transform 0.05s; }
        .pop { position: absolute; font-size: 40px; pointer-events: none; animation: fly 0.6s forwards; }
        @keyframes fly { 0% { opacity: 1; transform: scale(1); } 100% { opacity: 0; transform: translateY(-130px) scale(1.6); } }

        /* ğŸ”‹ ENERJÄ° */
        .energy-box { width: 90%; margin-top: auto; margin-bottom: 110px; }
        .energy-bar { width: 100%; height: 10px; background: #111; border-radius: 10px; border: 1px solid #333; overflow: hidden; }
        #energy-fill { height: 100%; width: 100%; background: linear-gradient(90deg, var(--purple), #4f46e5); transition: 0.3s; }

        /* ğŸ† SIRALAMA */
        .rank-title { color: var(--purple); font-size: 24px; font-weight: bold; margin-bottom: 20px; }
        .rank-list { width: 100%; display: flex; flex-direction: column; gap: 8px; }
        .rank-item { background: var(--card); padding: 15px; border-radius: 12px; display: flex; justify-content: space-between; align-items: center; border: 1px solid #222; }
        .rank-item.me { border: 1px solid var(--purple); background: rgba(168, 85, 247, 0.1); }

        /* ğŸ” KONTROL MERKEZÄ° */
        #admin-panel { position: fixed; inset: 0; background: #000; z-index: 9999; display: none; padding: 30px; flex-direction: column; align-items: center; }
        .admin-card { background: var(--card); width: 100%; padding: 25px; border-radius: 20px; border: 1px solid #333; margin-top: 20px; }
        .admin-close { background: #ff3b30; color: white; border: none; width: 100%; padding: 15px; border-radius: 12px; font-weight: bold; margin-top: auto; cursor: pointer; }

        /* ğŸ“± ALT MENÃœ */
        .nav-bar { position: fixed; bottom: 15px; width: 94%; left: 3%; background: rgba(21, 21, 23, 0.95); height: 70px; border-radius: 22px; display: grid; grid-template-columns: repeat(5, 1fr); border: 1px solid #2c2c2e; z-index: 1000; }
        .nav-item { display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 10px; color: var(--inactive); gap: 4px; }
        .nav-item.active { color: var(--purple); font-weight: bold; }
    </style>
</head>
<body>

    <div id="p-play" class="page active">
        <div class="bal-text" id="ui-bal">0</div>
        <div class="tap-zone" id="tap-target">
            <div class="glow"></div>
            <img src="https://api.mimic.ai/api/v1/files/image_7ba2e0.png" id="spider-main">
        </div>
        <button id="adm-btn" style="display:none; background:none; border:1px solid var(--purple); color:var(--purple); padding:8px 15px; border-radius:10px; font-size:12px;" onclick="toggleAdmin(true)">ğŸ•µï¸ Kontrol Merkezi</button>
        <div class="energy-box">
            <div style="font-size:12px; margin-bottom:5px;">âš¡ Enerji: <span id="ui-nrg">100</span>/100</div>
            <div class="energy-bar"><div id="energy-fill"></div></div>
        </div>
    </div>

    <div id="p-tasks" class="page">
        <h2 style="color:var(--purple)">GÃ¶revler</h2>
        <div class="rank-item">
            <div><b>Telegram KanalÄ±</b><br><small style="color:var(--purple);">+555 SPYDER</small></div>
            <button id="tg-btn" style="background:var(--purple); color:white; border:none; padding:8px 12px; border-radius:8px;" onclick="doTask()">KatÄ±l</button>
        </div>
    </div>

    <div id="p-friends" class="page">
        <h2 style="color:var(--purple)">ArkadaÅŸlar</h2>
        <p style="text-align:center; color:#666;">ArkadaÅŸlarÄ±nÄ± davet et, %10 bonus kazan!</p>
        <button class="admin-close" style="background:var(--purple); margin-top:20px;">DAVET ET</button>
    </div>

    <div id="p-league" class="page">
        <div class="rank-title">SÄ±ralama</div>
        <div class="rank-list" id="rank-container">
            </div>
    </div>

    <div id="p-wallet" class="page">
        <h2 style="color:var(--purple)">CÃ¼zdan</h2>
        <div class="admin-card" style="text-align:center;">
            <div style="font-size:40px; color:#00d084; font-weight:900;">$0.00</div>
            <p>Toplam: <span id="w-coin">0</span> SPYDER</p>
        </div>
    </div>

    <div id="admin-panel">
        <h1 style="color:var(--purple)">KONTROL MERKEZÄ°</h1>
        <div class="admin-card">
            <p>Admin: <b id="adm-name"></b></p>
            <p>Bakiye: <b id="adm-bal">0</b></p>
            <hr style="border:0; border-top:1px solid #222; margin:15px 0;">
            <p style="font-size:11px; color:#666;">* Telegram Cloud Storage aktif.</p>
        </div>
        <button class="admin-close" onclick="toggleAdmin(false)">KAPAT</button>
    </div>

    <nav class="nav-bar">
        <div class="nav-item active" onclick="nav('p-play', this)"><span>ğŸ® Oyna</span></div>
        <div class="nav-item" onclick="nav('p-tasks', this)"><span>ğŸ“‹ GÃ¶rev</span></div>
        <div class="nav-item" onclick="nav('p-friends', this)"><span>ğŸ‘¥ Dost</span></div>
        <div class="nav-item" onclick="nav('p-league', this)"><span>ğŸ† Lig</span></div>
        <div class="nav-item" onclick="nav('p-wallet', this)"><span>ğŸ’° CÃ¼zdan</span></div>
    </nav>

    <script>
        const tg = window.Telegram.WebApp;
        const MY_ID = 8392479231;
        const u = tg.initDataUnsafe?.user || { id: 0, first_name: "Misafir" };

        let bal = parseInt(localStorage.getItem('spy_v9')) || 0;
        let nrg = 100;

        function init() {
            tg.ready(); tg.expand();
            tg.CloudStorage.getItem('spy_data_v9', (err, val) => {
                if(!err && val) bal = parseInt(val);
                updateUI();
                updateRanks();
            });
            if (u.id === MY_ID) document.getElementById('adm-btn').style.display = 'block';
        }

        function updateUI() {
            document.getElementById('ui-bal').innerText = bal.toLocaleString();
            document.getElementById('ui-nrg').innerText = nrg;
            document.getElementById('energy-fill').style.width = nrg + "%";
            document.getElementById('adm-bal').innerText = bal;
            document.getElementById('w-coin').innerText = bal.toLocaleString();
            localStorage.setItem('spy_v9', bal);
        }

        // ğŸ† SIRALAMA GÃœNCELLEME (EN Ã‡OK OLAN EN ÃœSTTE)
        function updateRanks() {
            const container = document.getElementById('rank-container');
            const players = [
                { name: u.first_name + " (Sen)", score: bal, me: true },
                { name: "SpyderKing", score: 2500000, me: false },
                { name: "VenomClicker", score: 1800000, me: false },
                { name: "WebMaster", score: 1200000, me: false },
                { name: "Shadow", score: 500000, me: false }
            ];

            // Skora gÃ¶re sÄ±rala (BÃ¼yÃ¼kten kÃ¼Ã§Ã¼ÄŸe)
            players.sort((a, b) => b.score - a.score);

            container.innerHTML = "";
            players.forEach((p, index) => {
                container.innerHTML += `
                    <div class="rank-item ${p.me ? 'me' : ''}">
                        <span>${index + 1}. ${p.name}</span>
                        <b>${p.score.toLocaleString()}${p.score >= 1000000 ? 'M' : ''}</b>
                    </div>
                `;
            });
        }

        function tap(e) {
            if (nrg <= 0) return;
            bal += 1; nrg--; 
            updateUI();
            
            const p = document.createElement('div');
            p.className = 'pop'; p.innerText = "ğŸ•·ï¸";
            const x = e.clientX || (e.touches ? e.touches[0].clientX : 0);
            const y = e.clientY || (e.touches ? e.touches[0].clientY : 0);
            p.style.left = (x - 20) + "px"; p.style.top = (y - 50) + "px";
            document.body.appendChild(p);
            setTimeout(() => p.remove(), 600);

            document.getElementById('spider-main').style.transform = "scale(0.85)";
            setTimeout(() => { 
                document.getElementById('spider-main').style.transform = "scale(1)"; 
                tg.CloudStorage.setItem('spy_data_v9', String(bal));
            }, 50);
        }

        function nav(id, el) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            el.classList.add('active');
            if(id === 'p-league') updateRanks(); // SÄ±ralama sekmesine her basÄ±ldÄ±ÄŸÄ±nda listeyi yenile
        }

        function toggleAdmin(s) { document.getElementById('admin-panel').style.display = s ? 'flex' : 'none'; }
        function doTask() { /* GÃ¶rev mantÄ±ÄŸÄ± aynÄ± */ tg.openTelegramLink("https://t.me/SpyderCommunity"); }

        document.getElementById('tap-target').addEventListener('touchstart', (e) => { e.preventDefault(); tap(e); });
        document.getElementById('tap-target').addEventListener('mousedown', tap);
        init();
    </script>
</body>
</html>

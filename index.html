<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Spyder Network - Enterprise OS Platinum Edition</title>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Plus+Jakarta+Sans:wght@300;400;600;800&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">

    <style>
        /* --- SUPREME DESIGN SYSTEM V3 --- */
        :root {
            --p-purple: #a855f7; --p-glow: rgba(168, 85, 247, 0.5);
            --bg-base: #000000; --bg-card: #0a0a0c;
            --border: rgba(255, 255, 255, 0.05); --text-main: #ffffff;
            --text-dim: #64748b; --success: #10b981; --error: #ef4444;
            --warning: #f59e0b; --accent: #6366f1; --surface: #111114;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Plus Jakarta Sans', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg-base); color: var(--text-main); height: 100vh; overflow: hidden; display: flex; flex-direction: column; }

        /* --- LAYOUT & CONTAINERS --- */
        #main-stage { flex: 1; overflow-y: auto; padding: 20px 20px 120px 20px; }
        .view { display: none; flex-direction: column; opacity: 0; transform: scale(0.98); transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .view.active { display: flex; opacity: 1; transform: scale(1); }

        /* --- HIGH-END UI ELEMENTS --- */
        .glass-module { background: var(--bg-card); border: 1px solid var(--border); border-radius: 32px; padding: 24px; margin-bottom: 20px; box-shadow: 0 20px 40px rgba(0,0,0,0.4); position: relative; overflow: hidden; }
        .stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 20px; }
        .mini-stat { background: var(--surface); border: 1px solid var(--border); padding: 16px; border-radius: 20px; text-align: center; }

        /* --- THE LEGENDARY ENGINE --- */
        .power-core { position: relative; display: flex; align-items: center; justify-content: center; margin: 40px 0; }
        .node-main {
            width: 240px; height: 240px; background: radial-gradient(circle at 30% 30%, #d8b4fe, #a855f7);
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            font-size: 100px; cursor: pointer; transition: 0.1s;
            box-shadow: 0 0 80px var(--p-glow), inset 0 0 40px rgba(255,255,255,0.3);
            border: 12px solid rgba(255,255,255,0.03); z-index: 2;
        }
        .node-main:active { transform: scale(0.92); filter: brightness(1.2); }

        /* --- NAVIGATION ELITE --- */
        nav { position: fixed; bottom: 0; width: 100%; height: 95px; background: rgba(5,5,5,0.95); backdrop-filter: blur(20px); border-top: 1px solid var(--border); display: flex; justify-content: space-around; align-items: center; z-index: 1000; padding-bottom: 10px; }
        .nav-link { color: var(--text-dim); display: flex; flex-direction: column; align-items: center; gap: 6px; cursor: pointer; transition: 0.3s; }
        .nav-link.active { color: var(--p-purple); }
        .nav-link i { font-size: 24px; font-style: normal; }
        .nav-link span { font-size: 9px; font-weight: 900; text-transform: uppercase; letter-spacing: 1px; }

        /* --- ADMIN COMMAND CENTER STYLES --- */
        .admin-dashboard { background: #000; padding: 15px; border-radius: 25px; border: 1px solid var(--warning); margin-bottom: 20px; }
        .tab-panel { display: flex; gap: 8px; margin-bottom: 20px; overflow-x: auto; padding-bottom: 5px; }
        .tab-trigger { padding: 10px 20px; background: var(--surface); border-radius: 12px; color: var(--text-dim); border: none; font-weight: 800; font-size: 11px; white-space: nowrap; }
        .tab-trigger.active { background: var(--p-purple); color: #fff; }

        .user-pro-card { background: var(--surface); padding: 16px; border-radius: 22px; margin-bottom: 12px; border: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
        .badge-pro { font-size: 8px; padding: 3px 7px; border-radius: 5px; font-weight: 900; margin-left: 5px; }

        /* --- MODAL GOD MODE --- */
        .god-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.98); z-index: 99999; display: none; align-items: center; justify-content: center; padding: 20px; }
        .god-window { background: #0d0d0f; border: 2px solid var(--p-purple); width: 100%; max-width: 500px; border-radius: 40px; padding: 30px; box-shadow: 0 0 100px rgba(168,85,247,0.2); }

        .btn-elite { width: 100%; padding: 16px; border-radius: 18px; border: none; background: var(--p-purple); color: #fff; font-weight: 900; cursor: pointer; transition: 0.2s; }
        .btn-elite:active { transform: scale(0.97); }

        /* --- CHART STYLING --- */
        canvas { max-height: 150px; margin: 15px 0; }
    </style>
</head>
<body>

    <div id="god-modal" class="god-overlay">
        <div class="god-window">
            <h2 id="g-name" class="orbitron" style="text-align:center; color:var(--p-purple);">CONTROL_NODE</h2>
            <hr style="border:0; height:1px; background:var(--border); margin:20px 0;">
            
            <div id="g-stats" class="stat-grid"></div>

            <div style="background:rgba(0,0,0,0.5); padding:15px; border-radius:20px; border:1px solid var(--border);">
                <small class="dim">MANUEL EKONOMƒ∞K M√úDAHALE</small>
                <div style="display:flex; gap:10px; margin-top:10px;">
                    <input type="number" id="g-amt" placeholder="Miktar" style="flex:1; background:#000; border:1px solid var(--border); color:#fff; border-radius:12px; padding:10px; text-align:center;">
                    <button onclick="Admin.adj('bal', true)" class="btn-elite" style="width:60px; background:var(--success)">+</button>
                    <button onclick="Admin.adj('bal', false)" class="btn-elite" style="width:60px; background:var(--error)">-</button>
                </div>
            </div>

            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-top:20px;">
                <button onclick="Admin.action('archive')" id="g-arc-btn" class="btn-elite" style="background:#334155;">AR≈ûƒ∞VLE</button>
                <button onclick="Admin.action('ban')" id="g-ban-btn" class="btn-elite" style="background:var(--error);">BANLA</button>
                <button onclick="Admin.action('wipe')" class="btn-elite" style="background:#000; border:1px solid #333; grid-column: span 2;">VERƒ∞LERƒ∞ SIFIRLA (WIPE)</button>
                <button onclick="Admin.closeGod()" class="btn-elite" style="background:#222; grid-column: span 2;">PENCEREYƒ∞ KAPAT</button>
            </div>
        </div>
    </div>

    <main id="main-stage">
        <section id="v-mine" class="view active">
            <div class="stat-grid">
                <div class="mini-stat"><small class="dim">SPYDER</small><h2 id="u-bal" class="orbitron">0</h2></div>
                <div class="mini-stat"><small class="dim">DOLLAR</small><h2 id="u-usdt" style="color:var(--success)">$0.00</h2></div>
            </div>

            <div class="power-core">
                <div class="node-main" onclick="Game.tap(event)">üï∑Ô∏è</div>
            </div>

            <div class="glass-module" style="margin-top:auto">
                <div style="display:flex; justify-content:space-between; font-size:10px; font-weight:900; margin-bottom:10px;">
                    <span class="orbitron">ENERGY_RESERVE</span>
                    <span id="u-nrg-txt">1000/1000</span>
                </div>
                <div style="height:12px; background:#000; border-radius:10px; border:1px solid var(--border); overflow:hidden;">
                    <div id="u-nrg-bar" style="width:100%; height:100%; background:var(--p-purple); box-shadow: 0 0 20px var(--p-purple);"></div>
                </div>
            </div>
        </section>

        <section id="v-vault" class="view">
            <h2 class="orbitron">VAULT_SWAP</h2>
            <div class="glass-module">
                <p class="dim" style="text-align:center; font-size:11px; margin-bottom:20px;">100,000 SPYDER = 1.00 USDT</p>
                <input type="number" id="swap-val" value="100000" style="width:100%; background:#000; border:1px solid var(--border); color:#fff; padding:20px; border-radius:20px; text-align:center; font-size:20px; font-weight:800;">
                <div style="text-align:center; margin:15px; font-size:24px;">‚¨áÔ∏è</div>
                <div class="glass-module" style="background:rgba(16,185,129,0.05); border-color:var(--success); text-align:center;">
                    <h1 style="color:var(--success)">$<span id="swap-out">1.00</span></h1>
                </div>
                <button class="btn-elite" onclick="Game.swap()">TAKASI BA≈ûLAT</button>
            </div>
        </section>

        <section id="v-admin" class="view">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                <h2 class="orbitron" style="color:var(--warning)">CENTRAL_OS</h2>
                <button onclick="Admin.boot()" style="background:none; border:none; font-size:20px;">üîÑ</button>
            </div>

            <div class="admin-dashboard">
                <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
                    <div class="mini-stat"><small class="dim">TOPLAM ƒ∞ZLEME</small><h3 id="adm-total-ads">0</h3></div>
                    <div class="mini-stat"><small class="dim">TOPLAM √ñDENEN</small><h3 id="adm-total-paid" style="color:var(--success)">$0</h3></div>
                </div>
                <canvas id="adminChart"></canvas>
            </div>

            <div class="tab-panel">
                <button class="tab-trigger active" onclick="Admin.tab('active', this)">AKTƒ∞F √úYELER</button>
                <button class="tab-trigger" onclick="Admin.tab('archive', this)">AR≈ûƒ∞VLENMƒ∞≈û</button>
                <button class="tab-trigger" onclick="Admin.tab('pending', this)">√ñDEME BEKLEYEN</button>
                <button class="tab-trigger" onclick="Admin.tab('banned', this)">YASAKLI</button>
            </div>

            <div id="adm-content-area"></div>
        </section>
    </main>

    <nav>
        <div class="nav-link active" onclick="Nav.go('v-mine', this)"><i>üéÆ</i><span>MINE</span></div>
        <div class="nav-link" onclick="Nav.go('v-vault', this)"><i>üèõÔ∏è</i><span>VAULT</span></div>
        <div class="nav-link" onclick="Nav.go('v-wallet', this)"><i>üí∞</i><span>WALLET</span></div>
        <div id="adm-nav" class="nav-link" style="display:none;" onclick="Nav.go('v-admin', this); Admin.boot();"><i>üîë</i><span>OS_PANEL</span></div>
    </nav>

    <script>
        /* --- GLOBAL CONFIGURATION --- */
        const ADMIN_UID = "8392479231";
        const FB_CONF = {
            apiKey: "AIzaSyC18uinYQT9vOC-nhxv3x1WIhO_we3CRMY",
            authDomain: "pdfkaynak-51615.firebaseapp.com",
            projectId: "pdfkaynak-51615",
            appId: "1:228512804576:web:a0bba02ca83b4fa7adea85"
        };
        firebase.initializeApp(FB_CONF);
        const db = firebase.firestore();
        const tg = window.Telegram.WebApp;

        let user = { bal:0, usdt:0, nrg:1000, ads:0, totalAds:0, isBanned:false, isArchived:false };
        let uid = tg.initDataUnsafe?.user?.id?.toString() || "dev_test_99";
        let state = { users: [], pays: [], currentTab: 'active', selectedUser: null };

        /* --- CORE GAME ENGINE --- */
        const Game = {
            init: async () => {
                const doc = await db.collection("users").doc(uid).get();
                if(doc.exists) {
                    user = { ...user, ...doc.data() };
                } else {
                    await Game.save();
                }
                if(uid === ADMIN_UID) document.getElementById('adm-nav').style.display='flex';
                UI.refresh();
                Game.loops();
            },
            tap: (e) => {
                if(user.nrg < 2 || user.isBanned) return;
                user.bal += 1; user.nrg -= 2;
                UI.refresh();
                if(user.bal % 50 === 0) Game.save();
            },
            save: async () => {
                await db.collection("users").doc(uid).set({
                    ...user, 
                    name: tg.initDataUnsafe?.user?.first_name || "Guest",
                    lastActive: Date.now()
                }, {merge:true});
            },
            loops: () => {
                setInterval(() => {
                    if(user.nrg < 1000) { user.nrg = Math.min(1000, user.nrg + 10); UI.refresh(); }
                }, 3000);
            },
            swap: async () => {
                const amt = parseInt(document.getElementById('swap-val').value);
                if(user.bal < amt) return tg.showAlert("Bakiye Yetersiz!");
                user.bal -= amt;
                user.usdt += (amt * 0.00001);
                await Game.save();
                UI.refresh();
                tg.showAlert("Takas i≈ülemi ba≈üarƒ±yla tamamlandƒ±!");
            }
        };

        /* --- SUPREME ADMIN ENGINE --- */
        const Admin = {
            boot: async () => {
                const uSnap = await db.collection("users").get();
                const pSnap = await db.collection("withdrawals").get();
                
                state.users = []; state.pays = [];
                let tAds = 0, tPaid = 0;

                uSnap.forEach(d => {
                    const data = d.data();
                    state.users.push({ id: d.id, ...data });
                    tAds += (data.totalAds || 0);
                });

                pSnap.forEach(d => {
                    const data = d.data();
                    state.pays.push({ id: d.id, ...data });
                    if(data.status === 'completed') tPaid += data.amount;
                });

                document.getElementById('adm-total-ads').innerText = tAds.toLocaleString();
                document.getElementById('adm-total-paid').innerText = "$" + tPaid.toFixed(2);
                
                Admin.render();
                Admin.drawChart(tAds, tPaid);
            },
            tab: (t, el) => {
                state.currentTab = t;
                document.querySelectorAll('.tab-trigger').forEach(b => b.classList.remove('active'));
                el.classList.add('active');
                Admin.render();
            },
            render: () => {
                const area = document.getElementById('adm-content-area');
                area.innerHTML = "";
                let list = [];

                if(state.currentTab === 'active') list = state.users.filter(u => !u.isBanned && !u.isArchived);
                if(state.currentTab === 'archive') list = state.users.filter(u => u.isArchived);
                if(state.currentTab === 'banned') list = state.users.filter(u => u.isBanned);
                
                if(state.currentTab === 'pending') {
                    state.pays.filter(p => p.status === 'pending').forEach(p => {
                        area.innerHTML += `<div class="user-pro-card" style="border-left:4px solid var(--warning)">
                            <div><b>${p.name}</b><br><small class="success">$${p.amount}</small></div>
                            <button onclick="Admin.completePay('${p.id}')" class="btn-elite" style="width:auto; padding:8px 15px; font-size:10px;">√ñDENDƒ∞</button>
                        </div>`;
                    });
                    return;
                }

                list.forEach(u => {
                    area.innerHTML += `<div class="user-pro-card" onclick="Admin.openGod('${u.id}')">
                        <div>
                            <b>${u.name}</b> ${u.isArchived ? '<span class="badge-pro" style="background:#444">AR≈ûƒ∞V</span>':''}
                            <br><small class="dim">Ads: ${u.totalAds||0} | $${(u.usdt||0).toFixed(2)}</small>
                        </div>
                        <div class="orbitron" style="color:var(--p-purple)">${(u.bal||0).toLocaleString()}</div>
                    </div>`;
                });
            },
            openGod: (id) => {
                const u = state.users.find(x => x.id === id);
                state.selectedUser = u;
                document.getElementById('g-name').innerText = u.name.toUpperCase();
                document.getElementById('g-stats').innerHTML = `
                    <div class="mini-stat"><small class="dim">SPYDER</small><br><b>${u.bal.toLocaleString()}</b></div>
                    <div class="mini-stat"><small class="dim">REKLAM</small><br><b>${u.totalAds||0}</b></div>
                    <div class="mini-stat" style="grid-column: span 2;"><small class="dim">C√úZDAN BAKƒ∞YESƒ∞</small><br><b class="success">$${(u.usdt||0).toFixed(2)}</b></div>
                `;
                document.getElementById('g-arc-btn').innerText = u.isArchived ? "AR≈ûƒ∞VDEN √áIKAR" : "AR≈ûƒ∞VLE";
                document.getElementById('g-ban-btn').innerText = u.isBanned ? "BANI KALDIR" : "BANLA";
                document.getElementById('god-modal').style.display = 'flex';
            },
            adj: async (type, add) => {
                const amt = parseInt(document.getElementById('g-amt').value) || 0;
                const final = add ? amt : -amt;
                await db.collection("users").doc(state.selectedUser.id).update({
                    bal: firebase.firestore.FieldValue.increment(final)
                });
                Admin.closeGod(); Admin.boot();
            },
            action: async (type) => {
                let upd = {};
                if(type === 'archive') upd = { isArchived: !state.selectedUser.isArchived };
                if(type === 'ban') upd = { isBanned: !state.selectedUser.isBanned };
                if(type === 'wipe') {
                    if(!confirm("T√ºm veriler sƒ±fƒ±rlanacak. Emin misiniz?")) return;
                    upd = { bal:0, usdt:0, ads:0, totalAds:0 };
                }
                await db.collection("users").doc(state.selectedUser.id).update(upd);
                Admin.closeGod(); Admin.boot();
            },
            completePay: async (id) => {
                await db.collection("withdrawals").doc(id).update({ status: 'completed' });
                Admin.boot();
            },
            closeGod: () => document.getElementById('god-modal').style.display = 'none',
            drawChart: (ads, paid) => {
                const ctx = document.getElementById('adminChart').getContext('2d');
                if(window.myChart) window.myChart.destroy();
                window.myChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: ['Pzt', 'Sal', '√áar', 'Per', 'Cum', 'Cmt', 'Paz'],
                        datasets: [{
                            label: 'ƒ∞zlenme',
                            data: [ads/10, ads/5, ads/2, ads/3, ads/1.5, ads/1.2, ads],
                            borderColor: '#a855f7', tension: 0.4
                        }]
                    },
                    options: { plugins: { legend: { display: false } }, scales: { y: { display: false }, x: { grid: { display: false } } } }
                });
            }
        };

        /* --- UI & NAVIGATION --- */
        const UI = {
            refresh: () => {
                document.getElementById('u-bal').innerText = user.bal.toLocaleString();
                document.getElementById('u-usdt').innerText = "$" + user.usdt.toFixed(2);
                document.getElementById('u-nrg-txt').innerText = `${user.nrg}/1000`;
                document.getElementById('u-nrg-bar').style.width = (user.nrg / 10) + "%";
            }
        };

        const Nav = {
            go: (id, el) => {
                document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
                document.querySelectorAll('.nav-link').forEach(n => n.classList.remove('active'));
                document.getElementById(id).classList.add('active');
                el.classList.add('active');
            }
        };

        Game.init();
    </script>
</body>
</html>

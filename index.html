<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SpyderCoin - Ultimate Admin v10</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

    <style>
        :root { --primary: #ffeb3b; --secondary: #9c27b0; --bg-dark: #0a0014; --card-bg: #1a002e; --success: #00e676; --blue: #0088cc; --danger: #ff4444; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; outline: none; }
        body { background: radial-gradient(circle at center, #1a002e 0%, #000 100%); color: white; font-family: 'Segoe UI', sans-serif; margin: 0; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }
        
        /* BAN EKRANI */
        #ban-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: black; z-index: 9999; flex-direction: column; align-items: center; justify-content: center; text-align: center; }
        #ban-overlay h1 { color: var(--danger); font-size: 50px; margin: 0; }
        #ban-overlay p { font-size: 18px; color: #888; }

        header { padding: 15px; text-align: center; border-bottom: 1px solid rgba(255, 235, 59, 0.1); }
        .balance-container { font-size: 38px; font-weight: 900; color: var(--primary); }
        
        main { flex-grow: 1; overflow-y: auto; padding-bottom: 90px; }
        .tab-content { display: none; padding: 20px; animation: fadeIn 0.3s ease; width: 100%; }
        .tab-content.active { display: flex; flex-direction: column; align-items: center; }

        .card { background: var(--card-bg); border-radius: 20px; padding: 20px; width: 100%; max-width: 400px; border: 1px solid rgba(255,255,255,0.1); text-align: center; margin-bottom: 15px; }
        .btn-action { background: var(--primary); color: black; border: none; padding: 14px; border-radius: 12px; font-weight: 800; width: 100%; cursor: pointer; }
        
        /* ADMIN PANEL */
        .admin-item { background: #111; padding: 12px; border-radius: 10px; margin-bottom: 10px; border-left: 4px solid var(--secondary); cursor: pointer; }
        .detail-panel { background: #000; border-radius: 10px; padding: 10px; margin-top: 10px; display: none; grid-template-columns: 1fr 1fr; gap: 6px; }
        .btn-adm { font-size: 9px; padding: 10px 5px; border-radius: 6px; border: none; font-weight: bold; cursor: pointer; color: white; text-transform: uppercase; }
        
        .nav-bar { position: fixed; bottom: 0; width: 100%; height: 70px; background: #050505; display: flex; justify-content: space-around; align-items: center; border-top: 1px solid rgba(255,255,255,0.1); }
        .nav-link { display: flex; flex-direction: column; align-items: center; color: #555; text-decoration: none; font-size: 10px; cursor: pointer; }
        .nav-link.active { color: var(--primary); }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

    <div id="ban-overlay">
        <h1>ğŸš«</h1>
        <h1>BANLANDIN</h1>
        <p>HesabÄ±nÄ±z kurallara aykÄ±rÄ± faaliyetler<br>nedeniyle askÄ±ya alÄ±nmÄ±ÅŸtÄ±r.</p>
    </div>

    <header>
        <div class="balance-container">$<span id="main-balance">0.00000</span></div>
        <div id="display-name" style="font-size: 11px; color: #888;">YÃ¼kleniyor...</div>
    </header>

    <main id="app-content">
        <div id="tab-game" class="tab-content active">
            <div style="width: 90%; max-width: 350px; margin-bottom: 15px;">
                <div style="display:flex; justify-content:space-between; font-size:11px; margin-bottom:4px;">
                    <span>âš¡ ENERJÄ°</span><span id="energy-val">1000/1000</span>
                </div>
                <div style="width:100%; height:10px; background:#222; border-radius:10px; border:1px solid var(--primary); overflow:hidden;">
                    <div id="energy-fill" style="width:100%; height:100%; background:var(--primary); transition:width 0.2s;"></div>
                </div>
            </div>
            <div style="width:230px; height:230px; background:rgba(156,39,176,0.1); border-radius:50%; display:flex; align-items:center; justify-content:center; margin:20px 0; border:2px solid rgba(156,39,176,0.3);">
                <div id="spider-main" style="font-size:110px; cursor:pointer;" onclick="processTap(event)">ğŸ•·ï¸</div>
            </div>
            <button class="btn-action" onclick="handleAdRefill()" style="max-width:280px;">âš¡ ENERJÄ° FULLLE (Ä°ZLE)</button>
        </div>

        <div id="tab-tasks" class="tab-content">
            <div class="card" style="border-color: var(--blue);">
                <div style="font-size: 30px;">ğŸ“¢</div>
                <h3>Telegram KanalÄ±</h3>
                <p style="color: var(--success); font-weight: bold; font-size: 18px;">+0.01$</p>
                <button class="btn-action" style="background:var(--blue); color:white;" id="task-tg" onclick="completeTask('tg', 'https://t.me/SpyderCommunity', 0.01)">KANALA KATIL</button>
            </div>
        </div>

        <div id="tab-wallet" class="tab-content">
            <div class="card">
                <h3>Ã‡ekim Talebi</h3>
                <small>Toplam Ä°zleme: <b id="ads-count-display">0</b></small>
                <input type="number" id="withdraw-amount" style="width:100%; padding:12px; margin:10px 0; background:#000; border:1px solid #333; color:white; border-radius:10px;" placeholder="Miktar (USDT)">
                <input type="text" id="withdraw-addr" style="width:100%; padding:12px; margin-bottom:10px; background:#000; border:1px solid #333; color:white; border-radius:10px;" placeholder="TRC20 Adresi">
                <button class="btn-action" onclick="requestWithdraw()">GÃ–NDER</button>
            </div>
        </div>

        <div id="tab-admin" class="tab-content">
            <div style="width:100%; max-width:450px;">
                <h3 style="color: var(--secondary); text-align: center;">ğŸ›¡ï¸ YÃ–NETÄ°M MERKEZÄ°</h3>
                <div id="adm-player-list"></div>
            </div>
        </div>
    </main>

    <nav class="nav-bar">
        <div class="nav-link active" onclick="showTab('game', this)"><span>ğŸ®</span><span>OYUN</span></div>
        <div class="nav-link" onclick="showTab('tasks', this)"><span>ğŸ“‹</span><span>GÃ–REVLER</span></div>
        <div class="nav-link" onclick="showTab('wallet', this)"><span>ğŸ‘›</span><span>CÃœZDAN</span></div>
        <div id="admin-nav-link" class="nav-link" style="display:none;" onclick="showTab('admin', this)"><span>ğŸ›¡ï¸</span><span>ADMÄ°N</span></div>
    </nav>

    <script>
        const tg = window.Telegram.WebApp;
        const firebaseConfig = {
            apiKey: "AIzaSyDfy6QdIZ0BthEHTmxkw-NAja3B9bFFd8U",
            authDomain: "spydercoin-94f7b.firebaseapp.com",
            projectId: "spydercoin-94f7b",
            storageBucket: "spydercoin-94f7b.firebasestorage.app",
            messagingSenderId: "218267568158",
            appId: "1:218267568158:web:832728845ba0f42202060f"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const adminId = "8392479231";
        const user = tg.initDataUnsafe.user || { id: "dev_user", first_name: "Admin", username: "dev" };
        const UID = user.id.toString();

        let localData = { money: 0, energy: 1000, adsWatched: 0, completedTasks: [], isBanned: false };
        let tapCount = 0;

        document.getElementById('display-name').innerText = `${user.first_name} (@${user.username || 'yok'})`;
        if(UID === adminId) document.getElementById('admin-nav-link').style.display = 'flex';

        // Ban ve Veri KontrolÃ¼
        db.collection("players").doc(UID).onSnapshot(doc => { 
            if(doc.exists) { 
                localData = doc.data(); 
                if(localData.isBanned) {
                    document.getElementById('ban-overlay').style.display = 'flex';
                    document.getElementById('app-content').style.display = 'none';
                }
                renderUI(); 
            } 
        });

        // --- GENÄ°ÅLETÄ°LMÄ°Å ADMIN PANELÄ° ---
        if(UID === adminId) {
            db.collection("players").onSnapshot(snap => {
                const list = document.getElementById('adm-player-list');
                list.innerHTML = "";
                snap.forEach(d => {
                    const p = d.data();
                    const pId = d.id;
                    const banBtnText = p.isBanned ? "BAN KALDIR" : "ğŸš¨ BANLA";
                    const banBtnCol = p.isBanned ? "var(--success)" : "var(--danger)";
                    
                    list.innerHTML += `
                        <div class="admin-item" onclick="toggleDetail('${pId}')">
                            <b style="${p.isBanned ? 'color:red; text-decoration:line-through;' : ''}">${p.first_name}</b>
                            <small>| $${(p.money || 0).toFixed(4)} | Ä°zleme: ${p.adsWatched || 0}</small>
                            
                            <div id="detail-${pId}" class="detail-panel">
                                <button class="btn-adm" style="background:var(--success)" onclick="editUser('${pId}', 'money', 0.50)">ğŸ’° +0.50$</button>
                                <button class="btn-adm" style="background:var(--danger)" onclick="editUser('${pId}', 'money', -0.50)">ğŸ’¸ -0.50$</button>
                                <button class="btn-adm" style="background:var(--blue)" onclick="editUser('${pId}', 'adsWatched', 500)">ğŸ“º +500 Ä°zle</button>
                                <button class="btn-adm" style="background:#444" onclick="editUser('${pId}', 'adsWatched', -500)">ğŸ“‰ -500 Ä°zle</button>
                                <button class="btn-adm" style="background:var(--secondary)" onclick="editUser('${pId}', 'energy', 1000, true)">âš¡ FULL ENERJÄ°</button>
                                <button class="btn-adm" style="background:orange; color:black;" onclick="resetTasks('${pId}')">ğŸ”„ GÃ–REV SIFIRLA</button>
                                <button class="btn-adm" style="background:${banBtnCol}; grid-column: span 2;" onclick="toggleBan('${pId}', ${p.isBanned})">${banBtnText}</button>
                            </div>
                        </div>`;
                });
            });
        }

        function toggleDetail(id) {
            const el = document.getElementById('detail-' + id);
            el.style.display = (el.style.display === 'grid') ? 'none' : 'grid';
        }

        function editUser(id, field, value, isSet = false) {
            event.stopPropagation();
            const ref = db.collection("players").doc(id);
            if(isSet) ref.update({ [field]: value });
            else ref.update({ [field]: firebase.firestore.FieldValue.increment(value) });
        }

        function toggleBan(id, currentStatus) {
            event.stopPropagation();
            db.collection("players").doc(id).update({ isBanned: !currentStatus });
        }

        function resetTasks(id) {
            event.stopPropagation();
            db.collection("players").doc(id).update({ completedTasks: [] });
        }

        // --- OYUN FONKSÄ°YONLARI ---
        function processTap(e) {
            if(localData.isBanned || localData.energy <= 0) return;
            tg.HapticFeedback.impactOccurred('light');
            localData.money += 0.0001;
            localData.energy -= 1;
            tapCount++;
            if(tapCount >= 10) { tapCount = 0; localData.adsWatched += 1; }
            renderUI(); save();
        }

        function requestWithdraw() {
            const amt = parseFloat(document.getElementById('withdraw-amount').value);
            const addr = document.getElementById('withdraw-addr').value;
            const needed = Math.ceil((amt / 0.50) * 770);
            if(amt >= 0.1 && localData.money >= amt && localData.adsWatched >= needed) {
                db.collection("withdrawals").add({ uid: UID, user: user.username, amount: amt, address: addr, date: new Date() });
                localData.money -= amt; localData.adsWatched -= needed;
                save(); tg.showAlert("Talep baÅŸarÄ±lÄ±!");
            } else { tg.showAlert("Åartlar saÄŸlanamadÄ±!"); }
        }

        function completeTask(taskId, link, reward) {
            if(localData.completedTasks && localData.completedTasks.includes(taskId)) return;
            tg.openLink(link);
            setTimeout(() => {
                if(!localData.completedTasks) localData.completedTasks = [];
                localData.completedTasks.push(taskId);
                localData.money += reward;
                save();
            }, 7000);
        }

        function handleAdRefill() {
            window.open("https://adexora.my.id/dl/QFm5mnRYbJV", "_blank");
            localData.energy = 1000; localData.adsWatched += 1; save();
        }

        function renderUI() {
            document.getElementById('main-balance').innerText = localData.money.toFixed(5);
            document.getElementById('energy-val').innerText = localData.energy + "/1000";
            document.getElementById('energy-fill').style.width = (localData.energy / 10) + "%";
            document.getElementById('ads-count-display').innerText = localData.adsWatched;
        }

        function save() { db.collection("players").doc(UID).set({ ...localData, first_name: user.first_name, username: user.username || "yok" }, {merge: true}); }

        function showTab(tabId, el) {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
            document.getElementById('tab-' + tabId).classList.add('active'); el.classList.add('active');
        }
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StreamX Ultimate | Engine v4.0</title>
    <style>
        :root {
            --bg-base: #0f0f0f;
            --bg-sidebar: #0f0f0f;
            --yt-red: #ff0000;
            --yt-blue: #3ea6ff;
            --text-main: #f1f1f1;
            --text-gray: #aaaaaa;
            --border: rgba(255, 255, 255, 0.1);
            --hover-overlay: rgba(255, 255, 255, 0.1);
            --auth-blur: blur(30px);
            --transition: all 0.3s cubic-bezier(0.2, 0, 0, 1);
            --z-header: 1000;
            --z-upload: 2000;
            --z-mini: 3000;
            --z-auth: 9999;
        }

        /* --- Sƒ∞STEM SIFIRLAMA --- */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            background: var(--bg-base); 
            color: var(--text-main); 
            font-family: 'Inter', sans-serif;
            height: 100vh;
            overflow: hidden;
            -webkit-font-smoothing: antialiased;
        }

        /* --- AUTH Kƒ∞Lƒ∞Dƒ∞ --- */
        body.locked #shell { filter: var(--auth-blur); pointer-events: none; }

        #auth-gate {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); z-index: var(--z-auth);
            display: flex; align-items: center; justify-content: center;
        }

        .auth-panel {
            background: #212121; width: 400px; padding: 40px; border-radius: 20px;
            border: 1px solid var(--border); box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            text-align: center;
        }

        .logo-large { font-size: 32px; font-weight: 800; margin-bottom: 30px; }
        .logo-large span { color: var(--yt-red); }

        .form-input {
            width: 100%; background: #0a0a0a; border: 1px solid #333; padding: 14px;
            color: white; border-radius: 12px; margin-bottom: 15px; outline: none;
            transition: var(--transition);
        }
        .form-input:focus { border-color: var(--yt-blue); background: #000; }

        .btn-primary {
            width: 100%; background: var(--text-main); color: #000; border: none;
            padding: 14px; border-radius: 12px; font-weight: 700; cursor: pointer;
            transition: var(--transition);
        }
        .btn-primary:hover { transform: scale(1.02); background: #fff; }

        /* --- ANA KONTEYNER --- */
        #shell {
            display: grid;
            grid-template-columns: 240px 1fr;
            grid-template-rows: 56px 1fr;
            height: 100vh;
        }

        /* --- HEADER --- */
        header {
            grid-column: 1 / -1; background: var(--bg-sidebar);
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 16px; border-bottom: 1px solid var(--border);
            z-index: var(--z-header);
        }

        .h-left { display: flex; align-items: center; gap: 16px; }
        .menu-icon { font-size: 20px; cursor: pointer; padding: 8px; border-radius: 50%; }
        .menu-icon:hover { background: var(--hover-overlay); }

        .search-engine {
            flex: 0 1 720px; display: flex; align-items: center;
            background: #121212; border: 1px solid #333; border-radius: 40px;
            padding: 0 4px 0 20px; margin: 0 40px;
        }
        .search-engine input {
            flex: 1; background: transparent; border: none; padding: 10px 0;
            color: white; font-size: 16px; outline: none;
        }
        .search-btn {
            background: #222; border: none; border-left: 1px solid #333;
            color: white; padding: 10px 20px; border-radius: 0 40px 40px 0; cursor: pointer;
        }

        /* --- SIDEBAR --- */
        .sidebar {
            background: var(--bg-sidebar); overflow-y: auto; padding: 12px;
            border-right: 1px solid var(--border);
        }

        .side-row {
            display: flex; align-items: center; gap: 24px; padding: 12px;
            border-radius: 10px; cursor: pointer; transition: var(--transition);
            color: var(--text-main); text-decoration: none; font-size: 14px;
        }
        .side-row:hover { background: var(--hover-overlay); }
        .side-row.active { background: rgba(255,255,255,0.1); font-weight: 600; }
        .side-row i { font-size: 20px; width: 24px; text-align: center; }

        .side-sep { height: 1px; background: var(--border); margin: 12px 0; }
        .side-title { padding: 8px 12px; font-weight: bold; font-size: 16px; }

        /* --- CONTENT AREA --- */
        #content { padding: 24px; overflow-y: auto; scroll-behavior: smooth; }
        
        .grid-engine {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(310px, 1fr));
            gap: 16px; row-gap: 32px;
        }

        .v-card { cursor: pointer; position: relative; }
        .v-thumb {
            width: 100%; aspect-ratio: 16/9; background: #222; border-radius: 12px;
            overflow: hidden; position: relative; margin-bottom: 12px;
        }
        .v-thumb img { width: 100%; height: 100%; object-fit: cover; transition: 0.5s; }
        .v-card:hover .v-thumb img { transform: scale(1.05); }

        .v-dur {
            position: absolute; bottom: 8px; right: 8px; background: rgba(0,0,0,0.8);
            padding: 3px 6px; border-radius: 4px; font-size: 12px; font-weight: 600;
        }

        .v-meta { display: flex; gap: 12px; }
        .v-avatar { width: 36px; height: 36px; border-radius: 50%; background: #444; flex-shrink: 0; }
        .v-info h3 { font-size: 15px; margin-bottom: 4px; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
        .v-info p { font-size: 13px; color: var(--text-gray); }

        /* --- SHORTS FULLSCREEN --- */
        #shorts-view {
            display: none; height: 100%; background: #000;
            overflow-y: scroll; scroll-snap-type: y mandatory;
            scrollbar-width: none;
        }
        .short-frame {
            height: 100%; width: 100%; scroll-snap-align: start;
            display: flex; justify-content: center; position: relative;
        }
        .short-video-box { height: 100%; aspect-ratio: 9/16; background: #111; position: relative; }
        .short-video-box video { width: 100%; height: 100%; object-fit: cover; }

        /* --- WATCH PAGE --- */
        #watch-view { display: none; grid-template-columns: 1fr 350px; gap: 24px; }
        .player-box { width: 100%; aspect-ratio: 16/9; background: #000; border-radius: 16px; overflow: hidden; }
        .action-bar { display: flex; justify-content: space-between; margin-top: 15px; padding-bottom: 15px; border-bottom: 1px solid var(--border); }

        /* --- ADVANCED UPLOAD --- */
        #upload-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95); z-index: var(--z-upload); display: none;
            align-items: center; justify-content: center;
        }
        .up-modal {
            background: #282828; width: 80%; max-width: 900px; height: 80vh;
            border-radius: 24px; display: flex; flex-direction: column; overflow: hidden;
        }
        .up-header { padding: 20px; border-bottom: 1px solid #333; display: flex; justify-content: space-between; }
        .up-body { flex: 1; padding: 40px; display: flex; flex-direction: column; align-items: center; overflow-y: auto; }
        
        .up-progress-ring {
            width: 120px; height: 120px; border-radius: 50%;
            border: 8px solid #333; border-top-color: var(--yt-blue);
            animation: spin 1s linear infinite; display: none;
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        .up-details { width: 100%; display: grid; grid-template-columns: 1fr 300px; gap: 30px; margin-top: 30px; display: none; }

        /* --- Mƒ∞NI PLAYER --- */
        #mini-player {
            position: fixed; bottom: 24px; right: 24px; width: 340px; aspect-ratio: 16/9;
            background: #000; border-radius: 12px; z-index: var(--z-mini);
            box-shadow: 0 10px 40px rgba(0,0,0,0.8); overflow: hidden;
            display: none; cursor: move; border: 2px solid #333;
        }
        #mini-player:hover .mini-controls { opacity: 1; }
        .mini-controls {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); opacity: 0; transition: 0.2s;
            display: flex; align-items: center; justify-content: center; gap: 20px;
        }

        /* --- TOAST --- */
        #toast-container { position: fixed; bottom: 30px; left: 30px; z-index: 10000; }
        .toast {
            background: #fff; color: #000; padding: 12px 24px; border-radius: 8px;
            font-weight: 700; margin-top: 10px; animation: toastIn 0.3s forwards;
        }
        @keyframes toastIn { from { transform: translateX(-100%); } to { transform: translateX(0); } }

        /* --- SCROLLBAR --- */
        ::-webkit-scrollbar { width: 10px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #444; }

    </style>
</head>
<body class="locked">

    <div id="auth-gate">
        <div class="auth-panel">
            <div class="logo-large">Stream<span>X</span></div>
            <p style="color: var(--text-gray); margin-bottom: 25px;">Master Access ID: 8392479231</p>
            <input type="text" id="in-user" class="form-input" placeholder="Kullanƒ±cƒ± Adƒ±">
            <input type="email" id="in-mail" class="form-input" placeholder="E-posta Adresi">
            <button class="btn-primary" onclick="engine.auth()">Platforma Gir</button>
            <p id="auth-err" style="color: var(--yt-red); font-size: 12px; margin-top: 15px;"></p>
        </div>
    </div>

    <div id="shell">
        <header>
            <div class="h-left">
                <div class="menu-icon">‚ò∞</div>
                <div class="logo-large" style="margin:0; font-size: 20px; cursor:pointer;" onclick="engine.nav('home')">Stream<span>X</span></div>
            </div>
            <div class="search-engine">
                <input type="text" placeholder="Ara" id="search-input">
                <button class="search-btn">üîç</button>
            </div>
            <div style="display: flex; align-items: center; gap: 15px;">
                <button onclick="engine.openUp()" style="background: rgba(255,255,255,0.1); border:none; color:white; padding: 8px 16px; border-radius: 20px; cursor:pointer; font-weight:600;">+ Olu≈ütur</button>
                <div id="user-pfp" class="v-avatar" style="background: #ff5722; color:white; display:flex; align-items:center; justify-content:center; font-weight:bold; cursor:pointer;">?</div>
            </div>
        </header>

        <aside class="sidebar">
            <div class="side-row active" onclick="engine.nav('home', this)"><i>üè†</i> <span>Ana Sayfa</span></div>
            <div class="side-row" onclick="engine.nav('shorts', this)"><i>üì±</i> <span>Shorts</span></div>
            <div class="side-row" onclick="engine.toast('Abonelikler yakƒ±nda!')"><i>üì∫</i> <span>Abonelikler</span></div>
            <div class="side-sep"></div>
            <div class="side-title">Siz</div>
            <div class="side-row" onclick="engine.nav('history', this)"><i>üïí</i> <span>Ge√ßmi≈ü</span></div>
            <div class="side-row" onclick="engine.nav('liked', this)"><i>üëç</i> <span>Beƒüenilenler</span></div>
            <div class="side-row" onclick="engine.nav('comments', this)"><i>üí¨</i> <span>Yorumlarƒ±nƒ±z</span></div>
            <div class="side-sep"></div>
            <div class="side-title">Ke≈üfet</div>
            <div class="side-row" onclick="engine.toast('Trendler y√ºkleniyor...')"><i>üî•</i> <span>Trendler</span></div>
            <div class="side-row" onclick="engine.toast('M√ºzik mod√ºl√º aktif deƒüil')"><i>üéµ</i> <span>M√ºzik</span></div>
            <div class="side-sep"></div>
            <div class="side-row" onclick="engine.logout()"><i>üö™</i> <span>√áƒ±kƒ±≈ü Yap</span></div>
        </aside>

        <main id="content">
            <div id="home-view">
                <div class="grid-engine" id="video-grid"></div>
            </div>

            <div id="watch-view">
                <div class="watch-left">
                    <div class="player-box">
                        <video id="main-player" controls autoplay style="width: 100%; height: 100%;"></video>
                    </div>
                    <div style="margin-top: 20px;">
                        <h2 id="w-title">Video Y√ºkleniyor...</h2>
                        <div class="action-bar">
                            <div style="display:flex; align-items:center; gap:12px;">
                                <div class="v-avatar" id="w-avatar"></div>
                                <div>
                                    <div id="w-author" style="font-weight:bold;">Kanal</div>
                                    <div style="font-size:12px; color:var(--text-gray);">839,247 Abone</div>
                                </div>
                                <button class="btn-primary" style="width:auto; padding:8px 16px; margin-left:15px;">Abone Ol</button>
                            </div>
                            <div style="display:flex; gap:8px;">
                                <button onclick="engine.like()" class="btn-primary" style="width:auto; padding:8px 16px; background:#272727; color:white;">üëç <span id="w-likes">0</span></button>
                                <button onclick="engine.share()" class="btn-primary" style="width:auto; padding:8px 16px; background:#272727; color:white;">‚Ü™ Payla≈ü</button>
                            </div>
                        </div>
                        <div style="margin-top: 24px;">
                            <h3 id="w-comm-count">0 Yorum</h3>
                            <div style="display:flex; gap:15px; margin-top:20px;">
                                <div class="v-avatar" id="user-comm-pfp"></div>
                                <input type="text" id="comm-in" placeholder="Yorum ekleyin..." style="flex:1; background:transparent; border:none; border-bottom:1px solid #333; color:white; outline:none;">
                                <button onclick="engine.postComm()" style="background:var(--yt-blue); color:black; border:none; padding:8px 16px; border-radius:20px; font-weight:bold; cursor:pointer;">Yorum</button>
                            </div>
                            <div id="comm-list" style="margin-top:30px; display:flex; flex-direction:column; gap:20px;"></div>
                        </div>
                    </div>
                </div>
                <div class="watch-right">
                    <h4 style="margin-bottom:15px;">Sƒ±radaki</h4>
                    <div id="rel-grid" style="display:flex; flex-direction:column; gap:12px;"></div>
                </div>
            </div>

            <div id="shorts-view"></div>

            <div id="list-view" style="display:none;">
                <h1 id="list-title" style="margin-bottom:30px;">Liste</h1>
                <div class="grid-engine" id="list-grid"></div>
            </div>
        </main>
    </div>

    <div id="upload-overlay">
        <div class="up-modal">
            <div class="up-header">
                <h3>Video Yayƒ±nla</h3>
                <span style="cursor:pointer; font-size:24px;" onclick="engine.closeUp()">‚úï</span>
            </div>
            <div class="up-body">
                <div id="up-init" style="text-align:center;">
                    <div style="font-size:80px; color:#444; margin-bottom:20px;">üì§</div>
                    <h2>Dosyayƒ± buraya s√ºr√ºkleyin</h2>
                    <p style="color:var(--text-gray); margin: 15px 0 30px;">Videolarƒ±nƒ±z i≈ülenene kadar gizli kalƒ±r.</p>
                    <input type="file" id="up-file" accept="video/*" hidden>
                    <button class="btn-primary" onclick="document.getElementById('up-file').click()" style="width:auto; padding:12px 30px; background:var(--yt-blue);">DOSYA SE√á</button>
                </div>

                <div id="up-loading" style="text-align:center; display:none;">
                    <div class="up-progress-ring" id="up-ring" style="display:block; margin:0 auto 30px;"></div>
                    <h2 id="up-perc">%0 Y√ºkleniyor...</h2>
                    <div style="width:400px; height:6px; background:#333; border-radius:3px; margin-top:20px; overflow:hidden;">
                        <div id="up-bar" style="width:0%; height:100%; background:var(--yt-blue); transition:0.1s;"></div>
                    </div>
                </div>

                <div id="up-form" class="up-details">
                    <div style="display:flex; flex-direction:column; gap:20px;">
                        <input type="text" id="up-t" class="form-input" placeholder="Ba≈ülƒ±k (zorunlu)">
                        <textarea id="up-d" class="form-input" placeholder="A√ßƒ±klama" style="height:150px; resize:none;"></textarea>
                    </div>
                    <div>
                        <div id="up-preview" style="width:100%; aspect-ratio:16/9; background:#000; border-radius:12px; border:1px solid #444; overflow:hidden;"></div>
                        <button class="btn-primary" onclick="engine.publish()" style="margin-top:20px; background:var(--yt-blue);">YAYINLA</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="mini-player">
        <video id="mini-vid" autoplay muted loop style="width:100%; height:100%; object-fit:cover;"></video>
        <div class="mini-controls">
            <button onclick="engine.restore()" style="background:white; border:none; padding:8px; border-radius:50%; cursor:pointer;">üî≥</button>
            <button onclick="engine.closeMini()" style="background:white; border:none; padding:8px; border-radius:50%; cursor:pointer;">‚úï</button>
        </div>
    </div>

    <div id="toast-container"></div>

    <script>
        /**
         * STREAMX CORE SYSTEM v4.0
         * 8392479231
         */

        const engine = {
            db: {
                v: JSON.parse(localStorage.getItem('sx_v') || '[]'),
                u: JSON.parse(localStorage.getItem('sx_u') || 'null'),
                h: JSON.parse(localStorage.getItem('sx_h') || '[]'), // History
                l: JSON.parse(localStorage.getItem('sx_l') || '[]'), // Liked
                c: JSON.parse(localStorage.getItem('sx_c') || '[]')  // My Comments
            },

            state: {
                view: 'home',
                active: null,
                isUp: false,
                upData: null
            },

            init() {
                if(this.db.u) this.unlock();
                this.renderGrid();
                this.setupUpload();
                this.setupShorts();
                this.setupDraggableMini();
            },

            // --- AUTH ---
            auth() {
                const user = document.getElementById('in-user').value.trim();
                const mail = document.getElementById('in-mail').value.trim();
                if(!user || !mail) return document.getElementById('auth-err').innerText = "Eksik bilgi!";

                this.db.u = { name: user, mail, pfp: '#' + Math.floor(Math.random()*16777215).toString(16), id: "8392479231" };
                localStorage.setItem('sx_u', JSON.stringify(this.db.u));
                this.unlock();
                this.toast(`Ho≈ü geldin, ${user}`);
            },

            unlock() {
                document.body.classList.remove('locked');
                document.getElementById('auth-gate').style.display = 'none';
                document.getElementById('user-pfp').innerText = this.db.u.name[0].toUpperCase();
                document.getElementById('user-pfp').style.background = this.db.u.pfp;
                document.getElementById('user-comm-pfp').style.background = this.db.u.pfp;
            },

            logout() { localStorage.removeItem('sx_u'); location.reload(); },

            // --- NAVIGATION ---
            nav(target, el) {
                if(el) {
                    document.querySelectorAll('.side-row').forEach(r => r.classList.remove('active'));
                    el.classList.add('active');
                }

                // Mini Player Logic
                const mainVid = document.getElementById('main-player');
                if(this.state.view === 'watch' && target !== 'watch' && !mainVid.paused) {
                    this.openMini(mainVid.src);
                }

                this.state.view = target;
                const views = ['home-view', 'watch-view', 'shorts-view', 'list-view'];
                views.forEach(v => document.getElementById(v).style.display = 'none');

                if(target === 'home') {
                    document.getElementById('home-view').style.display = 'block';
                    this.renderGrid();
                } else if(target === 'watch') {
                    document.getElementById('watch-view').style.display = 'grid';
                    this.closeMini();
                } else if(target === 'shorts') {
                    document.getElementById('shorts-view').style.display = 'block';
                    this.renderShorts();
                } else {
                    document.getElementById('list-view').style.display = 'block';
                    this.renderList(target);
                }
            },

            // --- RENDERING ---
            renderGrid() {
                const grid = document.getElementById('video-grid');
                grid.innerHTML = '';
                const longs = this.db.v.filter(x => x.type === 'long');

                if(longs.length === 0) {
                    grid.innerHTML = `<div style="grid-column:1/-1; text-align:center; padding:100px; color:#555;"><h2>Video bulunamadƒ±. Hemen bir tane y√ºkleyin!</h2></div>`;
                    return;
                }

                longs.forEach(v => {
                    grid.innerHTML += `
                        <div class="v-card" onclick="engine.watch('${v.id}')">
                            <div class="v-thumb">
                                <img src="${v.thumb}">
                                <span class="v-dur">${this.fmt(v.dur)}</span>
                            </div>
                            <div class="v-meta">
                                <div class="v-avatar" style="background:${v.c}"></div>
                                <div class="v-info">
                                    <h3>${v.title}</h3>
                                    <p>${v.author}</p>
                                    <p>${v.views} izlenme ‚Ä¢ ${this.ago(v.id)}</p>
                                </div>
                            </div>
                        </div>`;
                });
            },

            renderList(type) {
                const grid = document.getElementById('list-grid');
                const title = document.getElementById('list-title');
                grid.innerHTML = '';
                let data = [];

                if(type === 'history') { title.innerText = "ƒ∞zleme Ge√ßmi≈üi"; data = this.db.h; }
                if(type === 'liked') { title.innerText = "Beƒüenilen Videolar"; data = this.db.l; }
                
                if(data.length === 0) {
                    grid.innerHTML = `<p style="color:#555">Bu liste hen√ºz bo≈ü.</p>`;
                    return;
                }

                data.forEach(id => {
                    const v = this.db.v.find(x => x.id == id);
                    if(!v) return;
                    grid.innerHTML += `
                        <div class="v-card" onclick="engine.watch('${v.id}')">
                            <div class="v-thumb"><img src="${v.thumb}"></div>
                            <div class="v-info"><h3>${v.title}</h3><p>${v.author}</p></div>
                        </div>`;
                });
            },

            // --- WATCH ENGINE ---
            watch(id) {
                const v = this.db.v.find(x => x.id == id);
                this.state.active = v;
                this.nav('watch');

                const p = document.getElementById('main-player');
                p.src = v.url;
                p.play();

                document.getElementById('w-title').innerText = v.title;
                document.getElementById('w-author').innerText = v.author;
                document.getElementById('w-avatar').style.background = v.c;
                document.getElementById('w-likes').innerText = v.likes;
                document.getElementById('w-comm-count').innerText = `${v.comms.length} Yorum`;

                v.views++;
                if(!this.db.h.includes(id)) this.db.h.unshift(id);
                this.save();
                this.renderComms();
                this.renderRel();
            },

            // --- UPLOAD ENGINE (DEVELOPED) ---
            setupUpload() {
                const f = document.getElementById('up-file');
                f.onchange = async (e) => {
                    const file = e.target.files[0];
                    if(!file) return;

                    document.getElementById('up-init').style.display = 'none';
                    document.getElementById('up-loading').style.display = 'block';

                    // 10 Saniyelik Akƒ±cƒ± Y√ºkleme Sim√ºlasyonu
                    for(let i=0; i<=100; i++) {
                        await new Promise(r => setTimeout(r, 100));
                        document.getElementById('up-bar').style.width = i + '%';
                        document.getElementById('up-perc').innerText = `%${i} Y√ºkleniyor...`;
                    }

                    const data = await this.process(file);
                    this.state.upData = data;

                    document.getElementById('up-loading').style.display = 'none';
                    document.getElementById('up-form').style.display = 'grid';
                    document.getElementById('up-preview').innerHTML = `<img src="${data.thumb}" style="width:100%; height:100%; object-fit:cover;">`;
                    document.getElementById('up-t').value = file.name.split('.')[0];
                };
            },

            async process(file) {
                return new Promise(res => {
                    const v = document.createElement('video');
                    const url = URL.createObjectURL(file);
                    v.src = url;
                    v.onloadedmetadata = () => {
                        v.currentTime = 1;
                        v.onseeked = () => {
                            const c = document.createElement('canvas');
                            c.width = 1280; c.height = 720;
                            c.getContext('2d').drawImage(v, 0, 0, 1280, 720);
                            res({ url, thumb: c.toDataURL('image/jpeg'), dur: v.duration });
                        };
                    };
                });
            },

            publish() {
                const t = document.getElementById('up-t').value;
                if(!t) return alert("Ba≈ülƒ±k gerekli!");

                const d = this.state.upData;
                const newV = {
                    id: Date.now(),
                    title: t,
                    desc: document.getElementById('up-d').value,
                    url: d.url,
                    thumb: d.thumb,
                    dur: d.dur,
                    type: d.dur <= 60 ? 'short' : 'long',
                    author: this.db.u.name,
                    c: this.db.u.pfp,
                    views: 0,
                    likes: 0,
                    comms: []
                };

                this.db.v.unshift(newV);
                this.save();
                this.closeUp();
                this.toast("Video ba≈üarƒ±yla yayƒ±nlandƒ±!");
                this.nav('home');
            },

            // --- MINI PLAYER (RE-ENGINEERED) ---
            openMini(src) {
                const mp = document.getElementById('mini-player');
                const mv = document.getElementById('mini-vid');
                mv.src = src;
                mp.style.display = 'block';
            },

            closeMini() {
                document.getElementById('mini-player').style.display = 'none';
                document.getElementById('mini-vid').pause();
            },

            restore() {
                if(this.state.active) {
                    this.nav('watch');
                    document.getElementById('main-player').currentTime = document.getElementById('mini-vid').currentTime;
                }
            },

            setupDraggableMini() {
                const mp = document.getElementById('mini-player');
                let active = false, curX, curY, initX, initY, xOffset = 0, yOffset = 0;

                mp.addEventListener("mousedown", dragStart);
                window.addEventListener("mouseup", dragEnd);
                window.addEventListener("mousemove", drag);

                function dragStart(e) {
                    initX = e.clientX - xOffset;
                    initY = e.clientY - yOffset;
                    if (e.target === mp || mp.contains(e.target)) active = true;
                }
                function dragEnd() { active = false; }
                function drag(e) {
                    if (active) {
                        e.preventDefault();
                        curX = e.clientX - initX;
                        curY = e.clientY - initY;
                        xOffset = curX;
                        yOffset = curY;
                        mp.style.transform = `translate(${curX}px, ${curY}px)`;
                    }
                }
            },

            // --- UTILS ---
            save() { localStorage.setItem('sx_v', JSON.stringify(this.db.v)); localStorage.setItem('sx_h', JSON.stringify(this.db.h)); localStorage.setItem('sx_l', JSON.stringify(this.db.l)); },
            fmt(s) { const m=Math.floor(s/60), sc=Math.floor(s%60); return `${m}:${sc<10?'0'+sc:sc}`; },
            ago(id) { return "≈üimdi"; },
            toast(m) {
                const c = document.getElementById('toast-container');
                const t = document.createElement('div');
                t.className = 'toast'; t.innerText = m;
                c.appendChild(t);
                setTimeout(() => t.remove(), 3000);
            },
            like() {
                const v = this.state.active;
                v.likes++;
                if(!this.db.l.includes(v.id)) this.db.l.unshift(v.id);
                document.getElementById('w-likes').innerText = v.likes;
                this.save();
                this.toast("Beƒüenildi!");
            },
            postComm() {
                const i = document.getElementById('comm-in');
                if(!i.value) return;
                const c = { u: this.db.u.name, p: this.db.u.pfp, t: i.value, d: Date.now() };
                this.state.active.comms.push(c);
                i.value = '';
                this.save();
                this.renderComms();
            },
            renderComms() {
                const l = document.getElementById('comm-list');
                l.innerHTML = '';
                this.state.active.comms.slice().reverse().forEach(c => {
                    l.innerHTML += `<div style="display:flex; gap:12px;">
                        <div class="v-avatar" style="background:${c.p}"></div>
                        <div><div style="font-size:13px; font-weight:bold;">@${c.u}</div><div>${c.t}</div></div>
                    </div>`;
                });
            },
            openUp() { document.getElementById('upload-overlay').style.display = 'flex'; },
            closeUp() { document.getElementById('upload-overlay').style.display = 'none'; this.state.upData = null; },
            renderRel() { /* Benzer videolar... */ }
        };

        engine.init();
    </script>
</body>
</html>

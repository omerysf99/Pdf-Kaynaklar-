<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>SpyderCoin - Ultimate Cloud Edition</title>
    
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://adexora.com/cdn/ads.js?id=1545"></script>

    <style>
        :root {
            --spyder-purple: #a855f7;
            --spyder-purple-glow: rgba(168, 85, 247, 0.45);
            --spyder-bg: #070708;
            --spyder-card: #111113;
            --spyder-text: #ffffff;
            --spyder-dim: #94a3b8;
            --spyder-green: #10b981;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; user-select: none; }
        body { background: var(--spyder-bg); color: var(--spyder-text); font-family: 'Inter', sans-serif; height: 100vh; overflow: hidden; display: flex; flex-direction: column; }

        .app-container { flex: 1; overflow-y: auto; padding-bottom: 110px; }
        .page { display: none; flex-direction: column; align-items: center; padding: 25px; animation: fadeIn 0.3s ease; }
        .page.active { display: flex; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* ANA SAYFA */
        .bal-display { font-size: 60px; font-weight: 900; background: linear-gradient(#fff, var(--spyder-purple)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin: 15px 0; }
        .spider-btn { width: 230px; height: 230px; background: radial-gradient(circle, #c084fc, #7c3aed); border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 90px; box-shadow: 0 0 35px var(--spyder-purple-glow); margin: 20px 0; cursor: pointer; transition: transform 0.05s; }
        .spider-btn:active { transform: scale(0.92); }

        /* KARTLAR */
        .card { background: var(--spyder-card); border: 1px solid #1f1f22; border-radius: 20px; padding: 20px; width: 100%; margin-top: 15px; }
        .btn-action { width: 100%; padding: 18px; border-radius: 14px; border: none; font-size: 16px; font-weight: 800; cursor: pointer; background: var(--spyder-purple); color: white; transition: 0.2s; }
        .btn-action:disabled { background: #27272a; color: #52525b; cursor: not-allowed; }

        /* NAV */
        .navbar { position: fixed; bottom: 0; width: 100%; height: 90px; background: #0a0a0b; display: grid; grid-template-columns: repeat(5, 1fr); border-top: 1px solid #1c1c1e; padding-bottom: 20px; }
        .nav-item { display: flex; flex-direction: column; align-items: center; justify-content: center; color: var(--spyder-dim); font-size: 10px; cursor: pointer; }
        .nav-item.active { color: var(--spyder-purple); }
        .nav-item i { font-style: normal; font-size: 24px; margin-bottom: 4px; }

        .energy-bar { width: 100%; height: 12px; background: #151518; border-radius: 10px; overflow: hidden; margin-top: 8px; border: 1px solid #222; }
        .energy-fill { height: 100%; background: var(--spyder-purple); transition: 0.2s; }

        .tap-anim { position: absolute; color: white; font-size: 32px; font-weight: 900; pointer-events: none; animation: floatUp 0.8s forwards; z-index: 100; }
        @keyframes floatUp { to { transform: translateY(-120px); opacity: 0; } }
    </style>
</head>
<body>

    <main class="app-container">
        <section id="p-home" class="page active">
            <button class="btn-action" style="background:#fbbf24; color:#000; margin-bottom:20px;" onclick="AdController.watchRewarded()">üì∫ REKLAM ƒ∞ZLE (+15 SPYDER)</button>
            <h1 class="bal-display" id="ui-bal">0</h1>
            <div class="spider-btn" id="spider-target">üï∑Ô∏è</div>
            <div style="width:100%; max-width:400px;">
                <div style="display:flex; justify-content:space-between; font-weight:bold; font-size:14px;">
                    <span>‚ö° ENERJƒ∞</span>
                    <span id="ui-nrg">1000/1000</span>
                </div>
                <div class="energy-bar"><div id="ui-nrg-fill" class="energy-fill"></div></div>
            </div>
        </section>

        <section id="p-tasks" class="page">
            <h2 style="align-self:flex-start;">G√∂revler</h2>
            <div class="card" style="display:flex; justify-content:space-between; align-items:center;">
                <div><b>Kanal Takibi</b><br><span style="color:var(--spyder-purple)">+111 SPYDER</span></div>
                <button class="btn-action" id="tg-btn" style="width:auto; padding:10px 20px;" onclick="startTgTask()">KATIL</button>
            </div>
        </section>

        <section id="p-vault" class="page">
            <h2 style="align-self:flex-start;">Vault Swap</h2>
            <div class="card">
                <input type="number" id="swap-val" value="1000" oninput="updateSwapUI()" style="width:100%; background:#000; border:1px solid #333; color:white; padding:15px; border-radius:12px; font-size:24px; text-align:center; outline:none;">
                <p style="text-align:center; margin:10px 0;">‚¨áÔ∏è</p>
                <div style="background:#000; padding:15px; border-radius:12px; text-align:center; font-size:24px; font-weight:bold; color:var(--spyder-green);">$<span id="swap-res">0.010</span></div>
                <button class="btn-action" style="margin-top:20px;" onclick="executeSwap()">TAKAS ET</button>
            </div>
        </section>

        <section id="p-wallet" class="page">
            <h2 style="align-self:flex-start;">√ñdeme</h2>
            <div class="card" style="text-align:center;">
                <p style="color:var(--spyder-dim)">USDT BAKƒ∞YENƒ∞Z</p>
                <h1 style="color:var(--spyder-green); font-size:48px;">$<span id="ui-usdt">0.00</span></h1>
            </div>
            <div class="card">
                <p id="ui-ad-req" style="margin-bottom:10px; font-size:14px;">Reklam ≈ûartƒ±: 0 / 20</p>
                <input type="text" id="w-addr" placeholder="BEP20 Adresi" style="width:100%; background:#000; border:1px solid #333; color:white; padding:15px; border-radius:12px; text-align:center; outline:none; margin-bottom:15px;">
                <button id="ui-withdraw-btn" class="btn-action" disabled onclick="finalWithdraw()">√ñDEME TALEBƒ∞</button>
            </div>
        </section>

        <section id="p-friends" class="page">
            <h2>Dostlar</h2>
            <div class="card" style="text-align:center;">Referans sistemi yakƒ±nda!</div>
        </section>
    </main>

    <nav class="navbar">
        <div class="nav-item active" onclick="nav('p-home', this)"><i>üéÆ</i><span>Oyna</span></div>
        <div class="nav-item" onclick="nav('p-tasks', this)"><i>üìã</i><span>G√∂rev</span></div>
        <div class="nav-item" onclick="nav('p-vault', this)"><i>üèõÔ∏è</i><span>Vault</span></div>
        <div class="nav-item" onclick="nav('p-wallet', this)"><i>üí∞</i><span>C√ºzdan</span></div>
        <div class="nav-item" onclick="nav('p-friends', this)"><i>üë•</i><span>Dost</span></div>
    </nav>

    <script>
        // --- CONFIG ---
        const firebaseConfig = {
            apiKey: "BURAYA_KENDƒ∞_API_KEY",
            authDomain: "PROJE_ID.firebaseapp.com",
            projectId: "PROJE_ID",
            storageBucket: "PROJE_ID.appspot.com",
            messagingSenderId: "SENDER_ID",
            appId: "APP_ID"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();
        const tg = window.Telegram.WebApp;
        const userId = tg.initDataUnsafe?.user?.id?.toString() || "8392479231";

        let state = { bal: 0, nrg: 1000, ads: 0, usdt: 0, tapCount: 0, taskDone: false };

        // --- FIREBASE OPS ---
        async function loadData() {
            try {
                await auth.signInAnonymously();
                const doc = await db.collection("users").doc(userId).get();
                if (doc.exists) {
                    const d = doc.data();
                    state.bal = d.bal || 0;
                    state.nrg = d.nrg || 1000;
                    state.ads = d.ads || 0;
                    state.usdt = d.usdt || 0;
                    state.taskDone = d.taskDone || false;
                    if(state.taskDone) {
                        const b = document.getElementById('tg-btn');
                        b.innerText = "TAMAMLANDI"; b.disabled = true; b.style.background = "#10b981";
                    }
                }
                updateUI();
            } catch (e) { console.error(e); }
        }

        async function saveData() {
            try {
                await db.collection("users").doc(userId).set({
                    bal: state.bal, nrg: state.nrg, ads: state.ads, usdt: state.usdt, taskDone: state.taskDone
                }, { merge: true });
            } catch (e) { console.error(e); }
        }

        // --- AD CONTROLLER ---
        const AdController = {
            watchRewarded: () => {
                window.showAdexora().then(() => {
                    state.bal += 15; state.ads += 1; updateUI(); saveData();
                }).catch(() => tg.showAlert("Reklam hazƒ±r deƒüil."));
            },
            showInterstitial: () => {
                window.showAdexora().then(() => {
                    state.ads += 1; updateUI(); saveData();
                }).catch(e => console.log("Ad skip"));
            }
        };

        // --- CORE LOGIC ---
        function handleTap(e) {
            if (state.nrg <= 0) return;
            state.bal++; state.nrg--; state.tapCount++;
            
            if (state.tapCount >= 10) {
                state.tapCount = 0;
                AdController.showInterstitial();
            }

            const x = e.touches ? e.touches[0].clientX : e.clientX;
            const y = e.touches ? e.touches[0].clientY : e.clientY;
            const p = document.createElement('div');
            p.className = 'tap-anim'; p.innerText = '+1';
            p.style.left = x + 'px'; p.style.top = y + 'px';
            document.body.appendChild(p);
            setTimeout(() => p.remove(), 800);

            updateUI();
            tg.HapticFeedback.impactOccurred('light');
        }

        function startTgTask() {
            if(state.taskDone) return;
            tg.openTelegramLink('https://t.me/SpyderCommunity');
            const b = document.getElementById('tg-btn');
            let s = 10;
            const inv = setInterval(() => {
                b.innerText = `Bekle (${s}s)`; s--;
                if(s < 0) {
                    clearInterval(inv);
                    state.bal += 111; state.taskDone = true;
                    b.innerText = "TAMAMLANDI"; b.disabled = true; b.style.background = "#10b981";
                    updateUI(); saveData();
                }
            }, 1000);
        }

        function updateUI() {
            document.getElementById('ui-bal').innerText = state.bal.toLocaleString();
            document.getElementById('ui-nrg').innerText = `${state.nrg}/1000`;
            document.getElementById('ui-nrg-fill').style.width = (state.nrg / 10) + "%";
            document.getElementById('ui-usdt').innerText = state.usdt.toFixed(4);

            let reqAds = Math.max(20, Math.ceil((state.usdt / 0.01) * 20));
            if(state.usdt === 0) reqAds = 20;
            document.getElementById('ui-ad-req').innerText = `Reklam ≈ûartƒ±: ${state.ads} / ${reqAds}`;
            document.getElementById('ui-withdraw-btn').disabled = !(state.usdt >= 0.01 && state.ads >= reqAds);
            updateSwapUI();
        }

        function updateSwapUI() {
            const v = document.getElementById('swap-val').value;
            document.getElementById('swap-res').innerText = (v * 0.00001).toFixed(4);
        }

        function executeSwap() {
            const v = parseInt(document.getElementById('swap-val').value);
            if(state.bal < v) return tg.showAlert("Yetersiz bakiye!");
            state.bal -= v; state.usdt += (v * 0.00001);
            updateUI(); saveData();
            tg.showAlert("Takas ba≈üarƒ±lƒ±!");
        }

        function nav(id, el) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            el.classList.add('active');
        }

        // --- INIT ---
        const target = document.getElementById('spider-target');
        target.addEventListener('touchstart', (e) => { e.preventDefault(); handleTap(e); });
        target.addEventListener('mousedown', (e) => { if(!('ontouchstart' in window)) handleTap(e); });

        setInterval(() => { if(state.nrg < 1000) { state.nrg++; updateUI(); } }, 1500);
        setInterval(saveData, 15000); // 15 saniyede bir oto-save

        window.onload = loadData;
    </script>
</body>
</html>

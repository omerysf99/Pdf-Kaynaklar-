<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>SpyderCoin - Finance Update</title>
    
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://adexora.com/cdn/ads.js?id=1545"></script>

    <style>
        :root {
            --p-purple: #a855f7; --bg: #000; --card: #0f0f12;
            --text: #fff; --dim: #71717a; --green: #10b981;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; font-family: sans-serif; }
        body { background: var(--bg); color: var(--text); height: 100vh; overflow: hidden; display: flex; flex-direction: column; }

        /* LOADER (G√∂rsel 1 & 2'deki gibi) */
        #loader { position: fixed; inset: 0; background: #000; z-index: 10000; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; }
        .spin { width: 50px; height: 50px; border: 5px solid #111; border-top-color: var(--p-purple); border-radius: 50%; animation: s 1s linear infinite; margin-bottom: 20px; }
        @keyframes s { to { transform: rotate(360deg); } }

        .view { display: none; flex-direction: column; align-items: center; padding: 20px; flex: 1; overflow-y: auto; }
        .view.active { display: flex; }

        /* ANA EKRAN (G√∂rsel 3) */
        .bal-txt { font-size: 60px; font-weight: 900; margin-bottom: 20px; }
        .spyder-btn { 
            width: 250px; height: 250px; background: #a855f7; border-radius: 50%; 
            display: flex; justify-content: center; align-items: center; 
            box-shadow: 0 0 40px rgba(168, 85, 247, 0.4); cursor: pointer;
        }
        /* √ñr√ºmcek g√∂rselindeki mavi kutuyu kaldƒ±rmak i√ßin arka planƒ± temizliyoruz */
        .spyder-btn img { width: 150px; filter: drop-shadow(0 0 5px rgba(0,0,0,0.5)); }

        /* Fƒ∞NANS EKRANI (G√∂rsel 4) */
        .card { background: var(--card); border: 1px solid #1a1a1f; border-radius: 15px; padding: 20px; width: 100%; margin-top: 15px; }
        .usdt-bal { border: 1px solid var(--green); color: var(--green); font-size: 45px; font-weight: 900; text-align: center; padding: 15px; border-radius: 15px; }
        
        input { width: 100%; background: #000; border: 1px solid #222; color: #fff; padding: 12px; border-radius: 10px; margin: 8px 0; outline: none; text-align: center; }
        .btn-draw { width: 100%; padding: 15px; border-radius: 12px; border: none; background: var(--p-purple); color: #fff; font-weight: bold; cursor: pointer; margin-top: 10px; }
        .btn-draw:disabled { opacity: 0.3; cursor: not-allowed; }

        nav { width: 100%; height: 80px; background: #000; display: grid; grid-template-columns: repeat(4, 1fr); border-top: 1px solid #1a1a1f; }
        .nav-item { display: flex; flex-direction: column; align-items: center; justify-content: center; color: var(--dim); font-size: 10px; cursor: pointer; }
        .nav-item.active { color: var(--p-purple); }

        .pop { position: absolute; color: #fff; font-size: 30px; font-weight: bold; pointer-events: none; animation: up 0.6s forwards; }
        @keyframes up { to { transform: translateY(-100px); opacity: 0; } }
    </style>
</head>
<body>

    <div id="loader">
        <div class="spin"></div>
        <p id="loader-status" style="color:var(--p-purple); font-weight:bold;">SECURE CLOUD SYNCING...</p>
    </div>

    <section id="p-home" class="view active">
        <h1 class="bal-txt" id="ui-bal">0</h1>
        <div class="spyder-btn" id="tap-node">
            <span style="font-size: 100px;">üï∑Ô∏è</span>
        </div>
        <div class="card" style="margin-top:auto;">
            <p>‚ö° Energy: <span id="ui-nrg">1000/1000</span></p>
        </div>
    </section>

    <section id="p-wallet" class="view">
        <h2 style="align-self: flex-start;">Finance</h2>
        <div class="card">
            <p style="text-align: center; font-size: 12px; color: var(--dim);">USDT BALANCE</p>
            <div class="usdt-bal">$<span id="ui-usdt">0.000</span></div>
        </div>

        <div class="card">
            <div style="display:flex; justify-content:space-between; font-size:13px; margin-bottom:10px;">
                <span>Ads Verification:</span>
                <span id="ui-req-ads" style="font-weight:bold; color:red;">0 / 20</span>
            </div>
            
            <label style="font-size:11px; color:var(--dim);">AMOUNT TO WITHDRAW ($)</label>
            <input type="number" id="draw-amount" value="0.01" step="0.01" oninput="Finance.calc()">
            
            <label style="font-size:11px; color:var(--dim);">USDT BEP20 ADDRESS</label>
            <input type="text" id="draw-addr" placeholder="Enter Address">
            
            <button id="btn-withdraw" class="btn-draw" onclick="Finance.submit()">WITHDRAW</button>
            <p id="ui-hint" style="font-size:10px; color:var(--dim); text-align:center; margin-top:10px;">
                Min: $0.01 | Required Ads: 20
            </p>
        </div>
    </section>

    <nav>
        <div class="nav-item active" onclick="nav('p-home', this)">Oyna</div>
        <div class="nav-item">G√∂rev</div>
        <div class="nav-item">Vault</div>
        <div class="nav-item" onclick="nav('p-wallet', this)">C√ºzdan</div>
    </nav>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyC18uinYQT9vOC-nhxv3x1WIhO_we3CRMY",
            authDomain: "pdfkaynak-51615.firebaseapp.com",
            projectId: "pdfkaynak-51615",
            appId: "1:228512804576:web:a0bba02ca83b4fa7adea85"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const tg = window.Telegram.WebApp;

        let user = { bal: 0, nrg: 1000, usdt: 0.020, ads: 0 }; 
        let ready = false;

        const Game = {
            init: async () => {
                // G√∂rsel 1'deki "Cloud Connection Failed" hatasƒ±nƒ± bypass etmek i√ßin timer
                setTimeout(() => { if(!ready) Game.start(); }, 3000);
                
                const uid = tg.initDataUnsafe?.user?.id?.toString() || "test_user";
                const doc = await db.collection("users").doc(uid).get();
                if(doc.exists) user = { ...user, ...doc.data() };
                Game.start();
            },
            start: () => {
                ready = true;
                document.getElementById('loader').style.display = 'none';
                UI.refresh();
            },
            tap: (e) => {
                if(user.nrg <= 0) return;
                user.bal += 1; // +1 Coin
                user.nrg -= 1;
                UI.pop(e);
                UI.refresh();
                if(user.bal % 50 === 0) Game.showAd();
            },
            showAd: () => {
                if(window.showAdexora) {
                    window.showAdexora().then(() => { user.ads++; UI.refresh(); });
                }
            }
        };

        const Finance = {
            calc: () => {
                const amount = parseFloat(document.getElementById('draw-amount').value) || 0;
                // Her 0.01$ i√ßin 20 reklam (√ñrn: 0.05$ -> 100 reklam)
                const reqAds = Math.max(20, Math.ceil(amount / 0.01) * 20);
                
                document.getElementById('ui-req-ads').innerText = `${user.ads} / ${reqAds}`;
                document.getElementById('ui-req-ads').style.color = user.ads >= reqAds ? "#10b981" : "red";
                document.getElementById('ui-hint').innerText = `Min: $0.01 | Required Ads: ${reqAds}`;
                
                // Buton kontrol√º
                const canDraw = (amount >= 0.01 && user.usdt >= amount && user.ads >= reqAds);
                document.getElementById('btn-withdraw').disabled = !canDraw;
            },
            submit: () => {
                const amount = document.getElementById('draw-amount').value;
                tg.showAlert(`√áekim talebi alƒ±ndƒ±: $${amount}\nAdres: ${document.getElementById('draw-addr').value}`);
                user.usdt -= parseFloat(amount);
                UI.refresh();
            }
        };

        const UI = {
            refresh: () => {
                document.getElementById('ui-bal').innerText = user.bal.toLocaleString();
                document.getElementById('ui-nrg').innerText = `${user.nrg}/1000`;
                document.getElementById('ui-usdt').innerText = user.usdt.toFixed(3);
                Finance.calc();
            },
            pop: (e) => {
                const x = e.touches ? e.touches[0].clientX : e.clientX;
                const y = e.touches ? e.touches[0].clientY : e.clientY;
                const p = document.createElement('div');
                p.className = 'pop'; p.innerText = '+1';
                p.style.left = x + 'px'; p.style.top = y + 'px';
                document.body.appendChild(p);
                setTimeout(() => p.remove(), 600);
            }
        };

        function nav(id, el) {
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            el.classList.add('active');
        }

        document.getElementById('tap-node').addEventListener('touchstart', (e) => {
            e.preventDefault(); Game.tap(e);
        });

        window.onload = Game.init;
    </script>
</body>
</html>

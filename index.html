<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>SpyderCoin - Dynamic Economy</title>
    
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>

    <style>
        :root {
            --spyder-purple: #a855f7;
            --spyder-purple-glow: rgba(168, 85, 247, 0.5);
            --spyder-bg: #070708;
            --spyder-card: #121214;
            --spyder-text: #ffffff;
            --spyder-dim: #94a3b8;
            --spyder-green: #10b981;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; user-select: none; }
        body { background: var(--spyder-bg); color: var(--spyder-text); font-family: -apple-system, sans-serif; height: 100vh; overflow: hidden; display: flex; flex-direction: column; }

        .page { display: none; height: 100%; width: 100%; flex-direction: column; align-items: center; padding: 25px; overflow-y: auto; padding-bottom: 120px; }
        .page.active { display: flex; animation: slideUp 0.3s ease; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* üï∑Ô∏è ANA SAYFA */
        .balance-box { text-align: center; margin-top: 20px; }
        .bal-val { font-size: 64px; font-weight: 900; text-shadow: 0 0 20px var(--spyder-purple-glow); }
        .tap-universe { flex-grow: 1; display: flex; justify-content: center; align-items: center; position: relative; width: 100%; }
        .spider-btn { width: 260px; height: 260px; background: linear-gradient(135deg, var(--spyder-purple), #7c3aed); border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 110px; box-shadow: 0 0 50px var(--spyder-purple-glow); transition: transform 0.05s; z-index: 5; }
        .spider-btn:active { transform: scale(0.94); }

        /* üîã ENERJƒ∞ */
        .energy-footer { width: 100%; max-width: 400px; margin-bottom: 10px; }
        .energy-bar { width: 100%; height: 14px; background: #1c1c1e; border-radius: 20px; border: 1px solid #2c2c2e; overflow: hidden; margin-top: 8px; }
        .energy-fill { height: 100%; background: var(--spyder-purple); width: 100%; transition: width 0.1s; }

        /* üèõÔ∏è VAULT (TAKAS) */
        .card { background: var(--spyder-card); border-radius: 24px; padding: 24px; width: 100%; border: 1px solid #232326; margin-top: 15px; }
        .swap-box { background: #000; border-radius: 16px; padding: 15px; border: 1px solid #2c2c2e; margin: 10px 0; }
        .swap-input { background: transparent; border: none; color: white; font-size: 28px; font-weight: bold; width: 100%; text-align: center; outline: none; }

        /* üí∞ C√úZDAN (√ñDEME) */
        .condition-row { display: flex; justify-content: space-between; align-items: center; padding: 15px 0; border-bottom: 1px solid #1f1f22; }
        .badge { padding: 6px 12px; border-radius: 8px; font-size: 11px; font-weight: 900; }
        .badge-wait { background: #27272a; color: #71717a; }
        .badge-ok { background: var(--spyder-green); color: white; }

        /* üì± NAV BAR */
        .nav-bar { position: fixed; bottom: 0; width: 100%; background: #0a0a0b; display: grid; grid-template-columns: repeat(5, 1fr); padding: 15px 0 35px; border-top: 1px solid #1c1c1e; z-index: 1000; }
        .nav-item { display: flex; flex-direction: column; align-items: center; gap: 4px; color: var(--spyder-dim); font-size: 10px; font-weight: 700; cursor: pointer; }
        .nav-item.active { color: var(--spyder-purple); }
        .nav-item i { font-style: normal; font-size: 22px; }

        .btn-action { width: 100%; padding: 18px; border-radius: 16px; border: none; font-weight: 800; font-size: 16px; cursor: pointer; transition: 0.3s; background: var(--spyder-purple); color: white; }
        .btn-action:disabled { background: #27272a; color: #52525b; cursor: not-allowed; }

        .tap-anim { position: absolute; color: white; font-size: 32px; font-weight: 900; pointer-events: none; animation: float 0.8s ease-out forwards; }
        @keyframes float { 0% { opacity: 1; transform: translateY(0); } 100% { opacity: 0; transform: translateY(-120px); } }
    </style>
</head>
<body>

    <div id="p-home" class="page active">
        <div class="balance-box">
            <p style="color:var(--spyder-dim); letter-spacing:2px; font-size:12px;">AVAILABLE SPYDER</p>
            <h1 class="bal-val" id="ui-bal">0</h1>
        </div>
        <div class="tap-universe">
            <div class="spider-btn" id="spider-btn">üï∑Ô∏è</div>
        </div>
        <div class="energy-footer">
            <div style="display:flex; justify-content:space-between; font-weight:bold; font-size:14px;">
                <span>‚ö° Energy</span>
                <span><span id="ui-nrg">1000</span> / 1000</span>
            </div>
            <div class="energy-bar"><div id="energy-fill" class="energy-fill"></div></div>
        </div>
    </div>

    <div id="p-tasks" class="page">
        <h2 style="align-self:flex-start;">Tasks</h2>
        <div class="card" style="display:flex; justify-content:space-between; align-items:center;">
            <div><b>Social Reward</b><br><span style="color:var(--spyder-purple)">+5,000 SPYDER</span></div>
            <button class="badge badge-ok" onclick="tg.openTelegramLink('https://t.me/SpyderCommunity')">JOIN</button>
        </div>
    </div>

    <div id="p-vault" class="page">
        <h2 style="align-self:flex-start;">Vault Swap</h2>
        <div class="card">
            <p style="color:var(--spyder-dim); font-size:12px;">CONVERT SPYDER TO USDT</p>
            <div class="swap-box">
                <input type="number" class="swap-input" id="swap-input" value="1000" oninput="updateSwapCalc()">
            </div>
            <div style="text-align:center; margin:10px 0; font-size:24px;">‚¨áÔ∏è</div>
            <div class="swap-box">
                <div id="swap-result" style="font-size:24px; font-weight:bold; text-align:center;">0.010</div>
                <p style="text-align:center; font-size:11px; color:var(--spyder-green)">ESTIMATED USDT</p>
            </div>
            <button id="btn-swap-exec" class="btn-action" onclick="executeVaultSwap()">CONFIRM SWAP</button>
        </div>
    </div>

    <div id="p-wallet" class="page">
        <h2 style="align-self:flex-start;">Payout Vault</h2>
        <div class="card" style="text-align:center;">
            <p style="color:var(--spyder-dim); font-size:12px;">YOUR USDT BALANCE</p>
            <h1 style="font-size:52px; color:var(--spyder-green);">$<span id="ui-usdt">0.00</span></h1>
        </div>

        <div class="card">
            <div class="condition-row">
                <span id="label-ads-req">Ad-Verification (Target: 20)</span>
                <span id="c-ads-status" class="badge badge-wait">0 / 20</span>
            </div>
            <div class="condition-row" style="border:none;">
                <span>Minimum Withdrawal ($0.01)</span>
                <span id="c-min-status" class="badge badge-wait">WAIT</span>
            </div>
            
            <input type="text" id="wallet-addr" placeholder="USDT BEP20 Address" style="width:100%; background:#000; border:1px solid #333; padding:18px; border-radius:14px; color:white; margin-top:15px; text-align:center;">
            
            <button id="btn-withdraw-exec" class="btn-action" disabled onclick="finalPayoutRequest()">WITHDRAW TO WALLET</button>
        </div>
    </div>

    <div id="p-friends" class="page">
        <h2 style="align-self:flex-start;">Referrals</h2>
        <div class="card">
            <p style="text-align:center; color:var(--spyder-dim)">Get 10% from your friends' taps!</p>
            <button class="btn-action" style="margin-top:20px;">INVITE FRIENDS</button>
        </div>
    </div>

    <nav class="nav-bar">
        <div class="nav-item active" onclick="nav('p-home', this)"><i>üéÆ</i>Oyna</div>
        <div class="nav-item" onclick="nav('p-tasks', this)"><i>üìã</i>G√∂rev</div>
        <div class="nav-item" onclick="nav('p-vault', this)"><i>üèõÔ∏è</i>Vault</div>
        <div class="nav-item" onclick="nav('p-wallet', this)"><i>üí∞</i>C√ºzdan</div>
        <div class="nav-item" onclick="nav('p-friends', this)"><i>üë•</i>Dost</div>
    </nav>

    <script>
        const tg = window.Telegram.WebApp;
        let state = {
            bal: 0, 
            nrg: 1000, 
            ads: 0, // ƒ∞zlenen reklam
            usdt_bal: 0 // Vault'tan gelen dolar
        };

        function handleTap(e) {
            if (state.nrg <= 0) return;

            // 1 Tƒ±k = 1 Spyder + 1 Enerji Kaybƒ±
            state.bal += 1;
            state.nrg -= 1;
            updateUI();

            const touch = e.touches ? e.touches[0] : e;
            const p = document.createElement('div');
            p.className = 'tap-anim';
            p.innerText = '+1';
            p.style.left = touch.pageX + 'px';
            p.style.top = touch.pageY + 'px';
            document.body.appendChild(p);
            setTimeout(() => p.remove(), 800);

            tg.HapticFeedback.impactOccurred('light');
        }

        function updateUI() {
            document.getElementById('ui-bal').innerText = state.bal.toLocaleString();
            document.getElementById('ui-nrg').innerText = state.nrg;
            document.getElementById('ui-usdt').innerText = state.usdt_bal.toFixed(3);
            document.getElementById('energy-fill').style.width = (state.nrg / 10) + "%";

            // Reklam Hesabƒ±: Her 0.01$ i√ßin 20 Reklam
            // Form√ºl: (Mevcut Dolar / 0.01) * 20
            let requiredAds = Math.max(20, Math.ceil((state.usdt_bal / 0.01) * 20));
            if(state.usdt_bal === 0) requiredAds = 20;

            document.getElementById('label-ads-req').innerText = `Ad-Verification (Target: ${requiredAds})`;
            const adsStatus = document.getElementById('c-ads-status');
            adsStatus.innerText = `${state.ads} / ${requiredAds}`;
            
            if(state.ads >= requiredAds) adsStatus.className = "badge badge-ok";
            else adsStatus.className = "badge badge-wait";

            // Min Bakiye Kontrol√º
            const minStatus = document.getElementById('c-min-status');
            if(state.usdt_bal >= 0.01) {
                minStatus.innerText = "OK";
                minStatus.className = "badge badge-ok";
            } else {
                minStatus.innerText = "WAIT";
                minStatus.className = "badge badge-wait";
            }

            // Withdraw Button
            document.getElementById('btn-withdraw-exec').disabled = !(state.usdt_bal >= 0.01 && state.ads >= requiredAds);
            
            // Swap Button
            document.getElementById('btn-swap-exec').disabled = (state.bal < 1000);
            updateSwapCalc();
        }

        function updateSwapCalc() {
            const val = document.getElementById('swap-input').value;
            document.getElementById('swap-result').innerText = (val * 0.00001).toFixed(3);
        }

        function executeVaultSwap() {
            const amt = parseInt(document.getElementById('swap-input').value);
            if(state.bal < amt) return;

            tg.showConfirm(`${amt} Spyder takas edilsin mi?`, (ok) => {
                if(ok) {
                    state.bal -= amt;
                    state.usdt_bal += (amt * 0.00001);
                    updateUI();
                    tg.showAlert("Takas ba≈üarƒ±lƒ±! C√ºzdan sekmesini kontrol edin.");
                }
            });
        }

        function finalPayoutRequest() {
            const addr = document.getElementById('wallet-addr').value;
            if(!addr.startsWith("0x")) return tg.showAlert("Ge√ßerli bir adres girin!");

            tg.showConfirm("√ñdeme talebi olu≈üturulsun mu?", (ok) => {
                if(ok) {
                    tg.showAlert("Talebiniz alƒ±ndƒ±. ƒ∞ncelendikten sonra g√∂nderilecektir.");
                    state.usdt_bal = 0;
                    state.ads = 0;
                    updateUI();
                }
            });
        }

        function nav(id, el) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            el.classList.add('active');
        }

        setInterval(() => { if(state.nrg < 1000) { state.nrg++; updateUI(); } }, 1500);
        document.getElementById('spider-btn').addEventListener('touchstart', (e) => { e.preventDefault(); handleTap(e); });
        
        updateUI();
    </script>
</body>
</html>

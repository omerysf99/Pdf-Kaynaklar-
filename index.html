<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ProTube Ultimate - Video Engine v1.0</title>
    <style>
        :root {
            --yt-black: #0f0f0f;
            --yt-white: #ffffff;
            --yt-red: #ff0000;
            --yt-gray: #aaaaaa;
            --yt-dark-gray: #272727;
            --yt-border: rgba(255, 255, 255, 0.1);
            --ease-bounce: cubic-bezier(0.175, 0.885, 0.32, 1.275);
            --ease-in-out: cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Temel Reset ve Kaydƒ±rma */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: "Roboto", sans-serif; }
        body { background-color: var(--yt-black); color: var(--yt-white); overflow: hidden; height: 100vh; }

        /* --- HEADER & NAVIGATION --- */
        header {
            height: 56px; padding: 0 16px; display: flex; align-items: center; justify-content: space-between;
            position: fixed; top: 0; width: 100%; z-index: 5000; background: var(--yt-black);
        }
        .sidebar {
            width: 240px; height: calc(100vh - 56px); position: fixed; top: 56px; left: 0;
            padding: 12px; border-right: 1px solid var(--yt-border); z-index: 4000; background: var(--yt-black);
        }
        .nav-item {
            display: flex; align-items: center; gap: 24px; padding: 10px 12px; border-radius: 10px;
            cursor: pointer; color: #fff; font-size: 14px; transition: 0.2s;
        }
        .nav-item:hover { background: var(--yt-dark-gray); }
        .nav-item.active { background: var(--yt-dark-gray); font-weight: 500; }

        /* --- VIEW CONTROLLER --- */
        .view {
            margin-left: 240px; margin-top: 56px; height: calc(100vh - 56px);
            overflow-y: auto; display: none;
        }
        #home-view { display: block; padding: 24px; }

        /* --- HOME GRID --- */
        .video-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 16px; row-gap: 32px;
        }
        .v-card { cursor: pointer; }
        .v-thumb { 
            width: 100%; aspect-ratio: 16/9; background: #222; 
            border-radius: 12px; overflow: hidden; margin-bottom: 12px; 
        }
        .v-thumb img { width: 100%; height: 100%; object-fit: cover; }

        /* --- UPLOAD MODAL --- */
        #upload-overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.8);
            z-index: 6000; display: none; align-items: center; justify-content: center;
        }
        .upload-card {
            background: var(--yt-dark-gray); width: 600px; padding: 32px;
            border-radius: 16px; position: relative;
        }
        .progress-container {
            width: 100%; height: 4px; background: #444; margin: 20px 0; border-radius: 2px;
            display: none; overflow: hidden;
        }
        #progress-bar { width: 0%; height: 100%; background: var(--yt-red); transition: width 0.3s; }

        /* --- SHORTS ENGINE (SNAP SCROLL) --- */
        #shorts-view { margin-left: 240px; padding: 0; scroll-snap-type: y mandatory; }
        .short-container {
            height: 100%; width: 100%; scroll-snap-align: start;
            display: flex; justify-content: center; align-items: center; position: relative;
            background: #000;
        }
        .short-player {
            height: 90%; aspect-ratio: 9/16; background: #111;
            border-radius: 16px; overflow: hidden; position: relative;
        }
        .short-actions {
            position: absolute; bottom: 40px; right: 20px;
            display: flex; flex-direction: column; gap: 20px;
        }
        .s-btn { 
            display: flex; flex-direction: column; align-items: center; cursor: pointer; 
            gap: 5px; font-size: 12px; 
        }
        .s-icon { 
            width: 48px; height: 48px; background: #222; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
        }

        /* --- COMMENT DRAWER (%70) --- */
        #comment-drawer {
            position: fixed; bottom: 0; left: 240px; right: 0; height: 70%;
            background: rgba(15, 15, 15, 0.98); backdrop-filter: blur(20px);
            z-index: 7000; transform: translateY(100%); transition: transform 0.4s var(--ease-in-out);
            border-top: 1px solid var(--yt-border); padding: 24px;
        }
        #comment-drawer.open { transform: translateY(0); }

        /* --- TOAST --- */
        #toast {
            position: fixed; bottom: 32px; right: 32px; background: #fff; color: #000;
            padding: 12px 24px; border-radius: 8px; font-weight: 500;
            transform: translateY(150%); transition: 0.3s; z-index: 10000;
        }
        #toast.show { transform: translateY(0); }

        /* Animations */
        .liked svg { fill: var(--yt-red) !important; animation: bounce 0.4s var(--ease-bounce); }
        @keyframes bounce { 50% { transform: scale(1.4); } 100% { transform: scale(1); } }
        input, textarea { 
            width: 100%; background: transparent; border: 1px solid #444; 
            color: white; padding: 12px; border-radius: 8px; margin-bottom: 12px; outline: none;
        }
    </style>
</head>
<body>

    <header>
        <div style="display:flex; align-items:center; gap:16px;">
            <span style="cursor:pointer" onclick="toggleSidebar()">‚ò∞</span>
            <img src="https://upload.wikimedia.org/wikipedia/commons/b/b8/YouTube_Logo_2017.svg" height="20" onclick="navigate('home')">
        </div>
        <div style="display:flex; gap:16px;">
            <button onclick="showUpload()" style="background:var(--yt-red); border:none; color:white; padding:8px 16px; border-radius:20px; cursor:pointer; font-weight:bold;">Y√úKLE</button>
            <div style="width:32px; height:32px; background:blue; border-radius:50%;"></div>
        </div>
    </header>

    <nav class="sidebar">
        <div class="nav-item active" id="btn-home" onclick="navigate('home')">üè† Ana Sayfa</div>
        <div class="nav-item" id="btn-shorts" onclick="navigate('shorts')">üé¨ Shorts</div>
    </nav>

    <main id="home-view" class="view">
        <div class="video-grid" id="home-grid"></div>
    </main>

    <main id="shorts-view" class="view">
        <div id="shorts-feed" style="height: 100%;"></div>
    </main>

    <main id="watch-view" class="view">
        <div style="max-width: 1200px; margin: 0 auto; padding: 24px;">
            <div class="v-thumb" style="aspect-ratio: 16/9; height: auto;">
                <video id="main-player" controls style="width: 100%; height: 100%;"></video>
            </div>
            <h1 id="watch-title" style="margin-top:20px;"></h1>
            <div id="watch-actions" style="display:flex; gap:16px; margin:20px 0; border-bottom:1px solid #333; padding-bottom:16px;">
                <div class="s-btn" onclick="toggleLike(this)"><div class="s-icon">‚ù§Ô∏è</div><span>0</span></div>
                <div class="s-btn" onclick="openComments()"><div class="s-icon">üí¨</div><span>Yorumlar</span></div>
            </div>
            <p id="watch-desc" style="color:var(--yt-gray);"></p>
        </div>
    </main>

    <div id="upload-overlay">
        <div class="upload-card">
            <h2 id="up-header">Video Y√ºkle</h2>
            <div id="up-form">
                <input type="file" id="file-input" accept="video/*">
                <input type="text" id="up-title" placeholder="Ba≈ülƒ±k">
                <textarea id="up-desc" placeholder="A√ßƒ±klama" rows="4"></textarea>
                <button onclick="startUpload()" style="width:100%; background:white; color:black; padding:12px; border:none; border-radius:8px; font-weight:bold; cursor:pointer;">YAYINLA</button>
            </div>
            <div class="progress-container" id="prog-cont">
                <div id="progress-bar"></div>
            </div>
            <p id="up-status" style="text-align:center; margin-top:10px; font-size:14px;"></p>
        </div>
    </div>

    <div id="comment-drawer">
        <div style="display:flex; justify-content:space-between; margin-bottom:20px;">
            <h3>Yorumlar</h3>
            <span onclick="closeComments()" style="cursor:pointer; font-size:24px;">‚úï</span>
        </div>
        <div id="comment-list" style="overflow-y:auto; height:80%;"></div>
        <div style="position:absolute; bottom:20px; left:24px; right:24px; display:flex; gap:10px;">
            <input type="text" id="comm-input" placeholder="Yorum ekle..." style="margin:0;">
            <button onclick="addComment()" style="background:var(--yt-red); border:none; color:white; padding:0 20px; border-radius:8px;">G√∂nder</button>
        </div>
    </div>

    <div id="toast">Bildirim</div>

    <script>
        // --- DATABASE & STATE ---
        let videos = [];
        let currentWatchId = null;

        // --- NAVIGATION ---
        function navigate(target) {
            document.querySelectorAll('.view').forEach(v => v.style.display = 'none');
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById(`${target}-view`).style.display = 'block';
            document.getElementById(`btn-${target === 'watch' ? 'home' : target}`).classList.add('active');
            
            // Video kontrol√º
            if (target !== 'watch') document.getElementById('main-player').pause();
            if (target === 'shorts') initShortsObserver();
        }

        // --- UPLOAD ENGINE ---
        function showUpload() { document.getElementById('upload-overlay').style.display = 'flex'; }

        async function startUpload() {
            const file = document.getElementById('file-input').files[0];
            const title = document.getElementById('up-title').value;
            const desc = document.getElementById('up-desc').value;

            if(!file || !title) return alert("Dosya ve ba≈ülƒ±k zorunlu!");

            // Formu gizle, barƒ± a√ß
            document.getElementById('up-form').style.display = 'none';
            document.getElementById('prog-cont').style.display = 'block';
            document.getElementById('up-header').innerText = "Y√ºkleniyor...";

            // 10 Saniyelik Sim√ºlasyon
            let progress = 0;
            const interval = setInterval(() => {
                progress += 1;
                document.getElementById('progress-bar').style.width = progress + "%";
                document.getElementById('up-status').innerText = `%${progress} y√ºklendi...`;
                
                if(progress >= 100) {
                    clearInterval(interval);
                    processVideo(file, title, desc);
                }
            }, 100);
        }

        async function processVideo(file, title, desc) {
            const videoUrl = URL.createObjectURL(file);
            
            // S√ºre ve Thumbnail √ñl√ß√ºm√º
            const tempVideo = document.createElement('video');
            tempVideo.src = videoUrl;
            
            tempVideo.onloadedmetadata = async () => {
                const duration = tempVideo.duration;
                const type = duration <= 60 ? 'short' : 'long';
                
                // Canvas ile Thumbnail Al
                tempVideo.currentTime = 1; // 1. saniyeden kare al
                tempVideo.onseeked = () => {
                    const canvas = document.createElement('canvas');
                    canvas.width = 320; canvas.height = 180;
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(tempVideo, 0, 0, canvas.width, canvas.height);
                    const thumb = canvas.toDataURL('image/jpeg');

                    const newVideo = {
                        id: Date.now(),
                        title, desc, url: videoUrl, thumb, type,
                        likes: 0, comments: []
                    };

                    videos.push(newVideo);
                    finalizeUpload();
                };
            };
        }

        function finalizeUpload() {
            document.getElementById('upload-overlay').style.display = 'none';
            // Reset form
            document.getElementById('up-form').style.display = 'block';
            document.getElementById('prog-cont').style.display = 'none';
            document.getElementById('up-header').innerText = "Video Y√ºkle";
            
            showToast("Video ba≈üarƒ±yla y√ºklendi");
            renderHome();
            renderShorts();
        }

        // --- RENDER ENGINES ---
        function renderHome() {
            const grid = document.getElementById('home-grid');
            grid.innerHTML = videos.filter(v => v.type === 'long').map(v => `
                <div class="v-card" onclick="openWatch(${v.id})">
                    <div class="v-thumb"><img src="${v.thumb}"></div>
                    <h3>${v.title}</h3>
                    <p style="color:var(--yt-gray); font-size:14px;">ProTube ‚Ä¢ Yeni</p>
                </div>
            `).join('');
        }

        function openWatch(id) {
            const v = videos.find(x => x.id === id);
            currentWatchId = id;
            navigate('watch');
            document.getElementById('watch-title').innerText = v.title;
            document.getElementById('watch-desc').innerText = v.desc;
            const player = document.getElementById('main-player');
            player.src = v.url;
            player.play();
        }

        function renderShorts() {
            const feed = document.getElementById('shorts-feed');
            feed.innerHTML = videos.filter(v => v.type === 'short').map(v => `
                <div class="short-container" data-id="${v.id}">
                    <div class="short-player">
                        <video src="${v.url}" loop playsinline></video>
                        <div class="short-actions">
                            <div class="s-btn" onclick="toggleLike(this, ${v.id})"><div class="s-icon">‚ù§Ô∏è</div><span>${v.likes}</span></div>
                            <div class="s-btn" onclick="openComments(${v.id})"><div class="s-icon">üí¨</div><span>${v.comments.length}</span></div>
                            <div class="s-btn" onclick="showToast('Baƒülantƒ± kopyalandƒ±')"><div class="s-icon">üîó</div><span>Payla≈ü</span></div>
                        </div>
                        <div style="position:absolute; bottom:20px; left:20px;">
                            <h4>@Kanal</h4><p>${v.title}</p>
                        </div>
                    </div>
                </div>
            `).join('');
            initShortsObserver();
        }

        // --- SHORTS AUTO-PLAY LOGIC ---
        function initShortsObserver() {
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    const video = entry.target.querySelector('video');
                    if(entry.isIntersecting) video.play();
                    else { video.pause(); video.currentTime = 0; }
                });
            }, { threshold: 0.8 });

            document.querySelectorAll('.short-container').forEach(c => observer.observe(c));
        }

        // --- INTERACTIONS ---
        function toggleLike(btn, id = null) {
            btn.classList.toggle('liked');
            let span = btn.querySelector('span');
            let count = parseInt(span.innerText);
            if(btn.classList.contains('liked')) {
                span.innerText = count + 1;
                showToast("Beƒüenildi");
            } else {
                span.innerText = count - 1;
            }
        }

        function openComments(id = null) {
            document.getElementById('comment-drawer').classList.add('open');
            // Video durmaz kuralƒ± otomatik saƒülanƒ±r (Player'a dokunulmaz)
        }

        function closeComments() { document.getElementById('comment-drawer').classList.remove('open'); }

        function addComment() {
            const input = document.getElementById('comm-input');
            if(!input.value) return;
            const list = document.getElementById('comment-list');
            const div = document.createElement('div');
            div.style.marginBottom = "15px";
            div.innerHTML = `<strong>@Kullanƒ±cƒ±</strong><br>${input.value}`;
            list.prepend(div);
            input.value = "";
            showToast("Yorum eklendi");
        }

        function showToast(msg) {
            const t = document.getElementById('toast');
            t.innerText = msg;
            t.classList.add('show');
            setTimeout(() => t.classList.remove('show'), 3000);
        }

        function toggleSidebar() {
            const sb = document.querySelector('.sidebar');
            const views = document.querySelectorAll('.view');
            if(sb.style.transform === "translateX(-240px)") {
                sb.style.transform = "translateX(0)";
                views.forEach(v => v.style.marginLeft = "240px");
            } else {
                sb.style.transform = "translateX(-240px)";
                views.forEach(v => v.style.marginLeft = "0");
            }
        }
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SpyderCoin - Firebase God Mode</title>
    
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>

    <style>
        :root { --bg: #050505; --purple: #a855f7; --card: #151517; --text: #ffffff; --red: #ff3b30; }
        body { background: var(--bg); color: var(--text); font-family: sans-serif; margin: 0; padding: 0; height: 100vh; overflow: hidden; }

        .page { display: none; height: 100vh; flex-direction: column; align-items: center; padding: 20px; box-sizing: border-box; }
        .page.active { display: flex; }

        /* ğŸ•·ï¸ ANA EKRAN */
        .bal-text { font-size: 55px; font-weight: 900; margin-top: 30px; text-shadow: 0 0 20px var(--purple); }
        .tap-zone { position: relative; width: 280px; height: 280px; display: flex; justify-content: center; align-items: center; margin: 30px 0; touch-action: none; }
        .glow { position: absolute; width: 260px; height: 260px; border: 8px solid var(--purple); border-radius: 50%; box-shadow: 0 0 40px var(--purple); }
        #spider-main { width: 190px; z-index: 10; transition: transform 0.05s; }

        /* ğŸ† SIRALAMA (FIREBASE TABANLI) */
        .rank-list { width: 100%; display: flex; flex-direction: column; gap: 8px; overflow-y: auto; padding-bottom: 120px; }
        .rank-item { background: var(--card); padding: 18px; border-radius: 12px; display: flex; justify-content: space-between; align-items: center; border: 1px solid #222; }
        .rank-item.me { border: 1px solid var(--purple); background: rgba(168, 85, 247, 0.1); }

        /* ğŸ” ADMÄ°N & ÃœYE TAKÄ°P */
        #admin-panel { position: fixed; inset: 0; background: #000; z-index: 9999; display: none; padding: 30px; flex-direction: column; align-items: center; }
        .admin-card { background: var(--card); width: 100%; padding: 25px; border-radius: 20px; border: 1px solid #333; margin-top: 20px; }
        .red-btn { background: var(--red); color: white; border: none; width: 100%; padding: 16px; border-radius: 15px; font-weight: bold; font-size: 16px; cursor: pointer; margin-top: auto; }

        /* ğŸ“± ALT MENÃœ */
        .nav-bar { position: fixed; bottom: 15px; width: 94%; left: 3%; background: rgba(21, 21, 23, 0.95); height: 70px; border-radius: 22px; display: grid; grid-template-columns: repeat(5, 1fr); border: 1px solid #2c2c2e; z-index: 1000; }
        .nav-item { display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 9px; color: #71717a; gap: 4px; }
        .nav-item.active { color: var(--purple); }
    </style>
</head>
<body>

    <div id="p-play" class="page active">
        <div class="bal-text" id="ui-bal">0</div>
        <div class="tap-zone" id="tap-target">
            <div class="glow"></div>
            <img src="https://api.mimic.ai/api/v1/files/image_7ba2e0.png" id="spider-main">
        </div>
        <button id="adm-trigger" style="display:none; background:none; border:1px solid var(--purple); color:var(--purple); padding:8px 15px; border-radius:10px;" onclick="toggleAdmin(true)">ğŸ•µï¸ Kontrol Merkezi</button>
    </div>

    <div id="p-league" class="page">
        <h2 style="color:var(--purple); margin-bottom: 20px;">SÄ±ralama</h2>
        <div class="rank-list" id="rank-container">
            <p style="text-align:center; color:#666;">YÃ¼kleniyor...</p>
        </div>
    </div>

    <div id="admin-panel">
        <h1 style="color:var(--purple); font-size: 24px;">KONTROL MERKEZÄ°</h1>
        <div class="admin-card">
            <p>Admin: <b id="adm-name">...</b></p>
            <p>KullanÄ±cÄ± AdÄ±: <b id="adm-user">...</b></p>
            <p>Bakiye: <b id="adm-bal">0</b></p>
            <hr style="border:0; border-top:1px solid #333; margin:15px 0;">
            <p style="font-size:11px; color:#666;">* Firebase Firestore kurallarÄ± uygulanmaktadÄ±r. TÃ¼m Ã¼yeler @SpyderCoin_Bot Ã¼zerinden takip edilebilir.</p>
        </div>
        <button class="red-btn" onclick="toggleAdmin(false)">Kapat</button>
        <p style="margin-top:20px; font-size:12px; color:#444;">@SpyderCoin_Bot</p>
    </div>

    <div id="p-tasks" class="page"><h2>GÃ¶revler</h2></div>
    <div id="p-friends" class="page"><h2>Dostlar</h2></div>
    <div id="p-wallet" class="page"><h2>CÃ¼zdan</h2></div>

    <nav class="nav-bar">
        <div class="nav-item active" onclick="nav('p-play', this)"><span>ğŸ® Oyna</span></div>
        <div class="nav-item" onclick="nav('p-tasks', this)"><span>ğŸ“‹ GÃ¶rev</span></div>
        <div class="nav-item" onclick="nav('p-friends', this)"><span>ğŸ‘¥ Dost</span></div>
        <div class="nav-item" onclick="nav('p-league', this)"><span>ğŸ† Lig</span></div>
        <div class="nav-item" onclick="nav('p-wallet', this)"><span>ğŸ’° CÃ¼zdan</span></div>
    </nav>

    <script>
        // ğŸ› ï¸ FIREBASE CONFIG
        const firebaseConfig = { apiKey: "BURAYA_KENDI_API_KEY", projectId: "PROJECT_ID", appId: "APP_ID" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        
        const tg = window.Telegram.WebApp;
        const MY_ID = 8392479231;
        const u = tg.initDataUnsafe?.user || { id: 12345, first_name: "TestUser", username: "tester" };

        let bal = 0;

        async function init() {
            tg.ready(); tg.expand();
            const userRef = db.collection('users').doc(String(u.id));
            const doc = await userRef.get();
            if (!doc.exists) {
                await userRef.set({ name: u.first_name, username: u.username || "yok", balance: 0 });
            } else {
                bal = doc.data().balance;
            }
            if (u.id === MY_ID) {
                document.getElementById('adm-trigger').style.display = 'block';
                document.getElementById('adm-name').innerText = u.first_name;
                document.getElementById('adm-user').innerText = "@" + (u.username || "yok");
            }
            updateUI();
        }

        function updateUI() {
            document.getElementById('ui-bal').innerText = bal.toLocaleString();
            document.getElementById('adm-bal').innerText = bal.toLocaleString();
        }

        // ğŸ† GERÃ‡EK SIRALAMA (EN Ã‡OK OLAN EN ÃœSTTE)
        async function fetchRankings() {
            const container = document.getElementById('rank-container');
            container.innerHTML = "YÃ¼kleniyor...";
            const snapshot = await db.collection('users').orderBy('balance', 'desc').limit(25).get();
            container.innerHTML = "";
            let rank = 1;
            snapshot.forEach(doc => {
                const data = doc.data();
                const isMe = doc.id === String(u.id);
                container.innerHTML += `
                    <div class="rank-item ${isMe ? 'me' : ''}">
                        <span>${rank}. ${data.name}</span>
                        <b>${data.balance.toLocaleString()}</b>
                    </div>
                `;
                rank++;
            });
        }

        function tap(e) {
            bal++; updateUI();
            db.collection('users').doc(String(u.id)).update({ balance: bal });
            document.getElementById('spider-main').style.transform = "scale(0.85)";
            setTimeout(() => document.getElementById('spider-main').style.transform = "scale(1)", 50);
        }

        function nav(id, el) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            el.classList.add('active');
            if(id === 'p-league') fetchRankings();
        }

        function toggleAdmin(s) { document.getElementById('admin-panel').style.display = s ? 'flex' : 'none'; }
        document.getElementById('tap-target').addEventListener('touchstart', (e) => { e.preventDefault(); tap(e); });
        init();
    </script>
</body>
</html>

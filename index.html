// --- GÜVENLİK AYARLARI ---
const ADMIN_ID = "8392479231"; // Senin yeni Telegram ID'n

window.onload = () => {
    // Mevcut kullanıcı bilgilerini al
    document.getElementById('u-name').innerText = user.first_name;
    
    // --- KRİTİK GÜVENLİK KONTROLÜ ---
    // Eğer giren kişi admin değilse, admin sekmesini (butonunu) DOM'dan kaldır
    const adminTab = document.querySelector('.nav-item[onclick*="admin"]');
    if (String(user.id) !== ADMIN_ID) {
        if (adminTab) adminTab.remove(); // Admin butonunu tamamen siler
        document.getElementById('v-admin').innerHTML = "<h1>Yetkisiz Erişim!</h1>"; // İçeriği temizler
    }

    // Firebase Veri Dinleme
    db.collection("users").doc(String(user.id)).onSnapshot(doc => {
        if(doc.exists) {
            balance = doc.data().balance || 0;
            document.querySelectorAll('.global-bal').forEach(el => el.innerText = balance);
        } else {
            db.collection("users").doc(String(user.id)).set({name: user.first_name, balance: 0});
        }
    });

    db.collection("pdfs").onSnapshot(snap => {
        pdfs = snap.docs.map(doc => ({id: doc.id, ...doc.data()}));
        renderHome();
        if (String(user.id) === ADMIN_ID) renderAdminList(); // Listeyi sadece admin görsün
    });

    // Kategorileri Doldur
    const grid = document.getElementById('main-cat-grid');
    const sel = document.getElementById('adm-cat');
    CATS.forEach(c => {
        grid.innerHTML += `<div class="cat-card" onclick="openCat('${c}')"><span>${c}</span></div>`;
        if (sel) sel.innerHTML += `<option value="${c}">${c}</option>`;
    });
};

// Admin Ekleme Fonksiyonu Güvenliği
async function adminAddPdf() {
    // Fonksiyon içinde tekrar kontrol (Ekstra Güvenlik)
    if(String(user.id) !== ADMIN_ID) {
        showToast("Yetkisiz işlem girişimi!", "error");
        return;
    }
    // ... geri kalan ekleme kodları aynı ...
}

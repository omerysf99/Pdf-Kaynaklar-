<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StreamX Infinite | Production v7.0</title>
    <style>
        :root {
            --bg: #0f0f0f; --side: #0f0f0f; --accent: #3ea6ff; --red: #ff0000;
            --text: #f1f1f1; --dim: #aaaaaa; --brd: rgba(255, 255, 255, 0.1);
            --card-hover: #282828; --glow: 0 0 20px rgba(62, 166, 255, 0.2);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: var(--bg); color: var(--text); font-family: 'Inter', sans-serif; height: 100vh; overflow: hidden; }

        /* SCROLLBAR */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #444; }

        /* APP LAYOUT */
        #app { display: grid; grid-template-columns: 240px 1fr; grid-template-rows: 64px 1fr; height: 100vh; transition: 0.3s; }
        header { grid-column: 1/-1; background: var(--bg); border-bottom: 1px solid var(--brd); display: flex; align-items: center; justify-content: space-between; padding: 0 24px; z-index: 1000; }
        
        aside { border-right: 1px solid var(--brd); padding: 12px; overflow-y: auto; display: flex; flex-direction: column; gap: 4px; }
        main { overflow-y: auto; padding: 24px; scroll-behavior: smooth; position: relative; }

        /* UI COMPONENTS */
        .nav-item { display: flex; align-items: center; gap: 20px; padding: 12px 16px; border-radius: 10px; cursor: pointer; transition: 0.2s; font-size: 14px; }
        .nav-item:hover { background: var(--card-hover); }
        .nav-item.active { background: rgba(62,166,255,0.1); color: var(--accent); font-weight: 600; }

        /* GRID & CARDS */
        .v-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 16px; row-gap: 32px; }
        .v-card { cursor: pointer; position: relative; }
        .v-card:hover .v-thumb img { transform: scale(1.05); }
        .v-thumb { width: 100%; aspect-ratio: 16/9; border-radius: 12px; overflow: hidden; background: #111; position: relative; transition: 0.3s; }
        .v-thumb img { width: 100%; height: 100%; object-fit: cover; transition: 0.5s; }
        
        .delete-btn { position: absolute; top: 8px; right: 8px; background: rgba(0,0,0,0.8); color: #ff4444; border: none; padding: 8px; border-radius: 50%; opacity: 0; transition: 0.2s; z-index: 10; }
        .v-card:hover .delete-btn { opacity: 1; }

        /* INFINITE LOADER */
        #scroll-anchor { height: 100px; display: flex; align-items: center; justify-content: center; width: 100%; }
        .spinner { width: 30px; height: 30px; border: 3px solid #333; border-top-color: var(--accent); border-radius: 50%; animation: spin 0.8s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* MODERN UPLOAD UI */
        #up-modal { position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 9999; display: none; align-items: center; justify-content: center; backdrop-filter: blur(10px); }
        .up-container { background: #1e1e1e; width: 900px; height: 80vh; border-radius: 24px; border: 1px solid var(--brd); display: flex; flex-direction: column; overflow: hidden; }
        .up-header { padding: 20px 30px; border-bottom: 1px solid #333; display: flex; justify-content: space-between; align-items: center; }
        
        .up-content { flex: 1; display: flex; padding: 40px; gap: 40px; overflow-y: auto; }
        .up-left { flex: 1.5; display: flex; flex-direction: column; gap: 20px; }
        .up-right { flex: 1; display: flex; flex-direction: column; gap: 20px; }

        .drop-zone-full { flex: 1; border: 2px dashed #444; border-radius: 20px; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 15px; cursor: pointer; transition: 0.3s; }
        .drop-zone-full:hover { border-color: var(--accent); background: rgba(62,166,255,0.05); }

        .input-sx { width: 100%; background: #000; border: 1px solid #333; color: #fff; padding: 16px; border-radius: 12px; font-size: 15px; outline: none; }
        .input-sx:focus { border-color: var(--accent); }

        /* TOAST */
        #toast-shelf { position: fixed; bottom: 30px; left: 30px; z-index: 10001; }
        .toast { background: #fff; color: #000; padding: 14px 28px; border-radius: 12px; font-weight: 700; margin-top: 10px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); animation: slideIn 0.3s cubic-bezier(0.18, 0.89, 0.32, 1.28); }
        @keyframes slideIn { from { transform: translateX(-100%); } to { transform: translateX(0); } }

        /* WATCH VIEW */
        #view-watch { display: none; grid-template-columns: 1fr 350px; gap: 24px; }
        .player-box { width: 100%; aspect-ratio: 16/9; background: #000; border-radius: 16px; overflow: hidden; border: 1px solid var(--brd); }
    </style>
</head>
<body>

    <div id="app">
        <header>
            <div style="display:flex; align-items:center; gap:20px;">
                <span style="font-size:24px; cursor:pointer;" onclick="sx.toggleSidebar()">‚ò∞</span>
                <h2 onclick="sx.nav('home')" style="cursor:pointer; letter-spacing:-1px;">Stream<span style="color:var(--red)">X</span></h2>
            </div>
            <div style="display:flex; align-items:center; gap:20px;">
                <button onclick="sx.openUp()" style="background:var(--accent); color:#000; border:none; padding:10px 24px; border-radius:30px; font-weight:800; cursor:pointer;">Olu≈ütur</button>
                <div id="user-pfp" style="width:38px; height:38px; border-radius:50%; background:#444; display:flex; align-items:center; justify-content:center; font-weight:bold;">A</div>
            </div>
        </header>

        <aside id="sidebar">
            <div class="nav-item active" onclick="sx.nav('home', this)"><i>üè†</i> Ana Sayfa</div>
            <div class="nav-item" onclick="sx.nav('shorts', this)"><i>üì±</i> Shorts</div>
            <div class="nav-item" onclick="sx.nav('liked', this)"><i>‚ù§Ô∏è</i> Beƒüenilenler</div>
            <div class="nav-item" onclick="sx.nav('history', this)"><i>üïí</i> Ge√ßmi≈ü</div>
            <div style="margin-top:auto; padding:10px; border-top:1px solid var(--brd);">
                <small style="color:var(--dim)">Admin ID: 8392479231</small>
            </div>
        </aside>

        <main id="main-scroll">
            <div id="view-home">
                <div class="v-grid" id="main-grid"></div>
                <div id="scroll-anchor">
                    <div class="spinner"></div>
                </div>
            </div>

            <div id="view-watch">
                <div class="w-content">
                    <div class="player-box">
                        <video id="v-main" controls autoplay style="width:100%; height:100%"></video>
                    </div>
                    <div style="margin-top:20px;">
                        <h1 id="v-title">Video Ba≈ülƒ±ƒüƒ±</h1>
                        <p id="v-meta" style="color:var(--dim); margin-top:10px;"></p>
                    </div>
                </div>
                <div class="w-side" id="suggested-list"></div>
            </div>

            <div id="view-shorts" style="display:none; height:100%; overflow-y:auto; scroll-snap-type: y mandatory;"></div>
        </main>
    </div>

    <div id="up-modal">
        <div class="up-container">
            <div class="up-header">
                <h2>Video Y√ºkle</h2>
                <button onclick="sx.closeUp()" style="background:none; border:none; color:#fff; font-size:24px; cursor:pointer;">‚úï</button>
            </div>

            <div id="up-step-1" class="up-content" style="display:flex; justify-content:center; align-items:center;">
                <div class="drop-zone-full" onclick="document.getElementById('file-in').click()">
                    <div style="font-size:64px;">‚òÅÔ∏è</div>
                    <div style="text-align:center">
                        <h3>Video dosyalarƒ±nƒ± s√ºr√ºkleyip bƒ±rakƒ±n</h3>
                        <p style="color:var(--dim); margin-top:10px;">Veya dosya se√ßmek i√ßin tƒ±klayƒ±n</p>
                    </div>
                    <input type="file" id="file-in" hidden accept="video/*">
                </div>
            </div>

            <div id="up-step-2" class="up-content" style="display:none">
                <div class="up-left">
                    <h3>Ayrƒ±ntƒ±lar</h3>
                    <input type="text" id="up-t" class="input-sx" placeholder="Ba≈ülƒ±k ekleyin">
                    <textarea id="up-d" class="input-sx" style="height:200px; resize:none;" placeholder="ƒ∞zleyicilere videonuzdan bahsedin"></textarea>
                    
                    <div id="up-prog-wrap" style="display:none">
                        <p id="up-status" style="margin-bottom:8px; font-size:14px;">Y√ºkleniyor...</p>
                        <div class="bar-bg"><div id="up-bar" class="bar-fill"></div></div>
                    </div>
                </div>
                <div class="up-right">
                    <h3>√ñnizleme</h3>
                    <div id="up-preview" style="width:100%; aspect-ratio:16/9; background:#000; border-radius:12px; overflow:hidden;"></div>
                    <button id="pub-btn" onclick="sx.publish()" class="btn" style="background:var(--accent); color:#000; width:100%; padding:16px; border-radius:12px; font-weight:bold; margin-top:20px; cursor:pointer; border:none;">YAYINLA</button>
                </div>
            </div>
        </div>
    </div>

    <div id="toast-shelf"></div>

    <script>
        /**
         * STREAMX ENGINE v7.0 - INFINITE PERSISTENCE
         * Admin ID: 8392479231
         */

        const sx = {
            db: JSON.parse(localStorage.getItem('sx_data') || '{"v":[], "h":[], "l":[]}'),
            state: { view: 'home', page: 1, perPage: 6, loading: false, upData: null },

            init() {
                this.renderGrid(true);
                this.setupInfiniteScroll();
                this.setupFileHandler();
            },

            save() { localStorage.setItem('sx_data', JSON.stringify(this.db)); },

            // NAVIGATION
            nav(target, el) {
                if(el) {
                    document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
                    el.classList.add('active');
                }
                this.state.view = target;
                document.getElementById('view-home').style.display = target === 'home' ? 'block' : 'none';
                document.getElementById('view-watch').style.display = target === 'watch' ? 'grid' : 'none';
                document.getElementById('view-shorts').style.display = target === 'shorts' ? 'block' : 'none';

                if(target === 'home') this.renderGrid(true);
                if(target === 'shorts') this.renderShorts();
            },

            // INFINITE GRID
            renderGrid(reset = false) {
                if(reset) {
                    this.state.page = 1;
                    document.getElementById('main-grid').innerHTML = '';
                }
                
                const start = (this.state.page - 1) * this.state.perPage;
                const end = start + this.state.perPage;
                const items = this.db.v.slice(start, end);

                if(items.length === 0 && reset) {
                    document.getElementById('main-grid').innerHTML = `<p style="grid-column:1/-1; text-align:center; padding:50px; color:#666;">Hen√ºz video yok. Bir tane y√ºkleyerek ba≈ülayƒ±n!</p>`;
                    document.getElementById('scroll-anchor').style.display = 'none';
                    return;
                }

                items.forEach(v => {
                    const card = document.createElement('div');
                    card.className = 'v-card';
                    card.innerHTML = `
                        <button class="delete-btn" onclick="sx.deleteVideo(${v.id}, event)">üóëÔ∏è</button>
                        <div class="v-thumb" onclick="sx.watch(${v.id})">
                            <img src="${v.thumb}">
                        </div>
                        <div style="margin-top:12px; display:flex; gap:12px;">
                            <div style="width:36px; height:36px; border-radius:50%; background:#444; flex-shrink:0;"></div>
                            <div>
                                <h3 style="font-size:15px; line-height:1.4;">${v.title}</h3>
                                <p style="font-size:12px; color:var(--dim); margin-top:4px;">Kanal ‚Ä¢ ${v.views} izlenme</p>
                            </div>
                        </div>
                    `;
                    document.getElementById('main-grid').appendChild(card);
                });

                if(end >= this.db.v.length) {
                    document.getElementById('scroll-anchor').style.display = 'none';
                } else {
                    document.getElementById('scroll-anchor').style.display = 'flex';
                }
            },

            setupInfiniteScroll() {
                const observer = new IntersectionObserver((entries) => {
                    if(entries[0].isIntersecting && !this.state.loading && this.state.view === 'home') {
                        this.state.page++;
                        this.renderGrid();
                    }
                }, { threshold: 0.5 });
                observer.observe(document.getElementById('scroll-anchor'));
            },

            // BASE64 UPLOAD SYSTEM
            setupFileHandler() {
                const fi = document.getElementById('file-in');
                fi.onchange = async (e) => {
                    const file = e.target.files[0];
                    if(!file) return;

                    document.getElementById('up-step-1').style.display = 'none';
                    document.getElementById('up-step-2').style.display = 'flex';
                    document.getElementById('up-t').value = file.name.split('.')[0];

                    // Process Data
                    const base64 = await this.toBase64(file);
                    const tempUrl = URL.createObjectURL(file);
                    const thumb = await this.genThumb(tempUrl);

                    this.state.upData = { base64, thumb, dur: 0 };
                    document.getElementById('up-preview').innerHTML = `<img src="${thumb}" style="width:100%; height:100%; object-fit:cover;">`;
                };
            },

            toBase64: (f) => new Promise((res) => {
                const r = new FileReader();
                r.readAsDataURL(f);
                r.onload = () => res(r.result);
            }),

            genThumb: (u) => new Promise((res) => {
                const v = document.createElement('video');
                v.src = u; v.currentTime = 1; v.muted = true;
                v.onseeked = () => {
                    const c = document.createElement('canvas');
                    c.width = 640; c.height = 360;
                    c.getContext('2d').drawImage(v, 0, 0, 640, 360);
                    res(c.toDataURL('image/jpeg', 0.7));
                };
            }),

            async publish() {
                if(!document.getElementById('up-t').value) return alert("Ba≈ülƒ±k gerekli!");
                
                document.getElementById('up-prog-wrap').style.display = 'block';
                const btn = document.getElementById('pub-btn');
                btn.disabled = true; btn.style.opacity = 0.5;

                // Fake Progress Simulation
                for(let i=0; i<=100; i+=5) {
                    await new Promise(r => setTimeout(r, 50));
                    document.getElementById('up-bar').style.width = i + '%';
                    document.getElementById('up-status').innerText = `ƒ∞≈üleniyor... %${i}`;
                }

                const newVid = {
                    id: Date.now(),
                    title: document.getElementById('up-t').value,
                    desc: document.getElementById('up-d').value,
                    src: this.state.upData.base64,
                    thumb: this.state.upData.thumb,
                    views: 0
                };

                try {
                    this.db.v.unshift(newVid);
                    this.save();
                    this.toast("Video ba≈üarƒ±yla yayƒ±nlandƒ±!");
                    this.closeUp();
                    this.nav('home');
                } catch(e) {
                    alert("LocalStorage limiti a≈üƒ±ldƒ±! L√ºtfen bazƒ± videolarƒ± silin.");
                }
            },

            // WATCH ENGINE
            watch(id) {
                const v = this.db.v.find(x => x.id == id);
                this.nav('watch');
                const player = document.getElementById('v-main');
                player.src = v.src;
                document.getElementById('v-title').innerText = v.title;
                document.getElementById('v-meta').innerText = `${v.views} izlenme ‚Ä¢ ${new Date(v.id).toLocaleDateString()}`;
                v.views++;
                this.save();
            },

            deleteVideo(id, e) {
                e.stopPropagation();
                if(confirm("Bu videoyu kalƒ±cƒ± olarak silmek istiyor musunuz?")) {
                    this.db.v = this.db.v.filter(x => x.id !== id);
                    this.save();
                    this.renderGrid(true);
                    this.toast("Video silindi.");
                }
            },

            // UTILS
            openUp() { 
                document.getElementById('up-modal').style.display = 'flex';
                document.getElementById('up-step-1').style.display = 'flex';
                document.getElementById('up-step-2').style.display = 'none';
            },
            closeUp() { document.getElementById('up-modal').style.display = 'none'; },
            toast(m) {
                const t = document.createElement('div');
                t.className = 'toast'; t.innerText = m;
                document.getElementById('toast-shelf').appendChild(t);
                setTimeout(() => t.remove(), 3000);
            },
            toggleSidebar() {
                const side = document.getElementById('sidebar');
                side.style.display = side.style.display === 'none' ? 'flex' : 'none';
            }
        };

        sx.init();
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Flappy Wallet TON Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&display=swap');
        body { background-color: #4eb5d3; font-family: 'Fredoka', sans-serif; margin: 0; overflow: hidden; user-select: none; touch-action: manipulation; }
        .page { display: none; height: calc(100vh - 75px); position: relative; overflow-y: auto; }
        .page.active { display: block; }
        #game-container { display: none; position: absolute; inset: 0; z-index: 200; background: #70c5ce; }
        #score-display { position: absolute; top: 30px; width: 100%; text-align: center; font-size: 60px; color: white; font-weight: 900; text-shadow: 4px 4px 0 #000; z-index: 210; }
        
        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.8); display: none; justify-content: center; align-items: center; z-index: 1000; backdrop-filter: blur(8px); }
        .modal-content { background: white; width: 90%; max-width: 350px; padding: 30px; border-radius: 30px; text-align: center; }
        
        .tab-btn.active { color: #2563eb; transform: scale(1.1); }
        .ton-btn { background: linear-gradient(135deg, #0088cc, #0055aa); }
    </style>
</head>
<body>

<div id="modal" class="modal-overlay">
    <div id="modal-inner" class="modal-content animate__animated animate__zoomIn">
        <h2 id="modal-title" class="text-2xl font-black mb-2"></h2>
        <div id="modal-body" class="mb-6"></div>
        <button id="modal-close" class="bg-blue-600 text-white w-full py-4 rounded-2xl font-bold shadow-lg">KAPAT</button>
    </div>
</div>

<div class="max-w-md mx-auto h-screen flex flex-col relative bg-[#4eb5d3] shadow-2xl">
    
    <div id="game-container">
        <div id="score-display">0</div>
        <canvas id="game-canvas"></canvas>
    </div>

    <div id="flappy-page" class="page active">
        <div class="p-4 grid grid-cols-2 gap-3">
            <div class="bg-white rounded-3xl p-4 shadow-xl border-b-4 border-blue-200">
                <span class="text-[10px] font-bold text-red-500 uppercase">HAKLAR</span>
                <div class="text-3xl font-black text-gray-800" id="hearts-ui">10</div>
            </div>
            <div class="bg-white rounded-3xl p-4 shadow-xl border-b-4 border-blue-200 text-[10px] font-bold uppercase">
                <div class="flex justify-between border-b pb-1"><span>BugÃ¼n</span> <span id="daily-ui" class="text-blue-600">0</span></div>
                <div class="flex justify-between pt-1"><span>Rekor</span> <span id="best-ui" class="text-blue-600">0</span></div>
            </div>
        </div>

        <div class="flex-grow flex flex-col items-center justify-center gap-12">
            <div class="w-24 h-16 bg-[#9c5c3c] border-[5px] border-black rounded-2xl shadow-2xl flex items-center justify-center text-white font-black text-xl animate-bounce">CW</div>
            <button id="play-btn" class="bg-white w-24 h-24 rounded-full shadow-[0_12px_0_#ddd] flex items-center justify-center active:shadow-none active:translate-y-2 transition-all">
                <div class="w-0 h-0 border-t-[20px] border-t-transparent border-l-[35px] border-l-green-500 border-b-[20px] border-b-transparent ml-2"></div>
            </button>
        </div>
    </div>

    <div id="rating-page" class="page p-6">
        <h1 class="text-3xl font-black text-white mb-6">Global Ranking ğŸ†</h1>
        <div class="space-y-3">
            <div class="bg-white/90 p-4 rounded-2xl flex justify-between items-center border-l-8 border-yellow-400">
                <span class="font-bold">1. CryptoKing</span> <span class="font-black text-blue-600">942.00</span>
            </div>
            <div class="bg-white/90 p-4 rounded-2xl flex justify-between items-center border-l-8 border-gray-400">
                <span class="font-bold">2. WhaleHunter</span> <span class="font-black text-blue-600">812.00</span>
            </div>
            <div class="bg-white/90 p-4 rounded-2xl flex justify-between items-center border-l-8 border-orange-400">
                <span class="font-bold">3. TonMaster</span> <span class="font-black text-blue-600">750.00</span>
            </div>
        </div>
    </div>

    <div id="wallet-page" class="page p-6 text-center">
        <div class="bg-white rounded-[40px] p-8 shadow-2xl mb-6">
            <div class="text-5xl mb-4">ğŸ’</div>
            <h2 class="text-gray-400 font-bold uppercase text-sm tracking-widest">Bakiyeniz</h2>
            <h1 class="text-4xl font-black text-gray-800 mb-6">0.00 CW</h1>
            
            <div id="wallet-section">
                <button onclick="requestTonAddress()" class="ton-btn text-white w-full py-4 rounded-2xl font-bold flex items-center justify-center gap-2 shadow-xl active:scale-95 transition">
                    <span>Connect TON Wallet</span>
                </button>
            </div>
        </div>
        <p class="text-white/70 text-xs px-6">TON aÄŸÄ±ndaki adresinizi baÄŸlayarak Ã¶dÃ¼lleri hesabÄ±nÄ±za Ã§ekebilirsiniz.</p>
    </div>

    <div class="h-[75px] bg-white flex justify-around items-center border-t border-gray-200 z-[300]">
        <button onclick="showPage('flappy')" class="tab-btn active flex flex-col items-center">
            <span class="text-2xl">ğŸ®</span><small class="font-bold">Oyna</small>
        </button>
        <button onclick="showPage('rating')" class="tab-btn flex flex-col items-center text-gray-400">
            <span class="text-2xl">ğŸ†</span><small class="font-bold">SÄ±ralama</small>
        </button>
        <button onclick="showPage('wallet')" class="tab-btn flex flex-col items-center text-gray-400">
            <span class="text-2xl">ğŸ’³</span><small class="font-bold">CÃ¼zdan</small>
        </button>
    </div>
</div>

<script>
    let hearts = 10;
    let dailyBest = 0;
    let allTimeBest = 0;
    let tonAddress = localStorage.getItem('ton_address') || null;

    // --- MODAL FONKSÄ°YONU ---
    function openModal(title, bodyHtml, closeAction = null) {
        document.getElementById('modal-title').innerText = title;
        document.getElementById('modal-body').innerHTML = bodyHtml;
        document.getElementById('modal').style.display = 'flex';
        document.getElementById('modal-close').onclick = () => {
            closeModal();
            if(closeAction) closeAction();
        };
    }
    function closeModal() { document.getElementById('modal').style.display = 'none'; }

    // --- CÃœZDAN BAÄLAMA ---
    function requestTonAddress() {
        openModal("Connect TON", 
            `<input type="text" id="ton-input" placeholder="UQ... adresinizi girin" class="w-full border-2 border-blue-200 p-4 rounded-xl text-center font-mono text-sm focus:border-blue-500 outline-none mb-4">
             <button onclick="saveAddress()" class="bg-blue-600 text-white w-full py-3 rounded-xl font-bold">Kaydet ve BaÄŸla</button>`, 
            null
        );
    }

    function saveAddress() {
        const addr = document.getElementById('ton-input').value;
        if(addr.length > 20) {
            tonAddress = addr;
            localStorage.setItem('ton_address', addr);
            updateWalletUI();
            closeModal();
            alert("CÃ¼zdan BaÅŸarÄ±yla BaÄŸlandÄ±!");
        } else {
            alert("LÃ¼tfen geÃ§erli bir TON adresi girin!");
        }
    }

    function updateWalletUI() {
        if(tonAddress) {
            document.getElementById('wallet-section').innerHTML = `
                <div class="bg-blue-50 p-4 rounded-2xl border-2 border-blue-200 mb-4">
                    <p class="text-[10px] text-blue-400 font-bold uppercase">BaÄŸlÄ± Adres</p>
                    <p class="text-[10px] font-mono break-all text-gray-600">${tonAddress}</p>
                </div>
                <button onclick="localStorage.removeItem('ton_address'); location.reload();" class="text-red-500 text-xs font-bold">BaÄŸlantÄ±yÄ± Kes</button>
            `;
        }
    }
    updateWalletUI();

    // --- SAYFA YÃ–NETÄ°MÄ° ---
    function showPage(id) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active', 'text-blue-500'));
        document.getElementById(id + '-page').classList.add('active');
        event.currentTarget.classList.add('active');
    }

    // --- OYUN MOTORU (HATA DÃœZELTÄ°LDÄ°) ---
    const canvas = document.getElementById('game-canvas');
    const ctx = canvas.getContext('2d');
    let score = 0;
    let gameActive = false;
    let animationId;

    canvas.width = window.innerWidth > 450 ? 450 : window.innerWidth;
    canvas.height = window.innerHeight - 75;

    const bird = {
        x: 60, y: 300, w: 38, h: 26, v: 0, g: 0.25, jump: 5,
        draw() {
            ctx.fillStyle = "#9c5c3c"; ctx.strokeStyle = "black"; ctx.lineWidth = 3;
            ctx.fillRect(this.x, this.y, this.w, this.h); ctx.strokeRect(this.x, this.y, this.w, this.h);
        },
        update() {
            this.v += this.g; this.y += this.v;
            if(this.y + this.h > canvas.height || this.y < 0) endGame();
        }
    };

    let pipes = [];
    function endGame() {
        gameActive = false;
        cancelAnimationFrame(animationId);
        hearts--;
        document.getElementById('hearts-ui').innerText = hearts;
        if(score > dailyBest) dailyBest = score;
        if(score > allTimeBest) allTimeBest = score;
        document.getElementById('daily-ui').innerText = dailyBest;
        document.getElementById('best-ui').innerText = allTimeBest;
        
        openModal("OYUN BÄ°TTÄ°", `<h1 class="text-5xl font-black text-blue-600 mb-2">${score}</h1><p class="text-gray-500">Skor yaptÄ±n! Kalan kalp: ${hearts}</p>`, () => {
            document.getElementById('game-container').style.display = 'none';
        });
    }

    function gameLoop() {
        if(!gameActive) return;
        ctx.fillStyle = "#70c5ce"; ctx.fillRect(0,0, canvas.width, canvas.height);
        bird.update(); bird.draw();
        
        if(pipes.length === 0 || pipes[pipes.length-1].x < canvas.width - 200) {
            pipes.push({ x: canvas.width, y: Math.random() * (canvas.height - 300) + 100, gap: 140, passed: false });
        }

        pipes.forEach(p => {
            p.x -= 3;
            ctx.fillStyle = "#2ecc71";
            ctx.fillRect(p.x, 0, 60, p.y);
            ctx.fillRect(p.x, p.y + 140, 60, canvas.height);
            // Ã‡arpÄ±ÅŸma - Tek seferlik kontrol
            if(bird.x + bird.w > p.x && bird.x < p.x + 60 && (bird.y < p.y || bird.y + bird.h > p.y + 140)) endGame();
            if(!p.passed && p.x < bird.x) { p.passed = true; score++; document.getElementById('score-display').innerText = score; }
        });
        pipes = pipes.filter(p => p.x > -100);
        animationId = requestAnimationFrame(gameLoop);
    }

    document.getElementById('play-btn').addEventListener('click', () => {
        if(hearts <= 0) return alert("HakkÄ±n bitti!");
        score = 0; document.getElementById('score-display').innerText = "0";
        pipes = []; bird.y = 300; bird.v = 0; gameActive = true;
        document.getElementById('game-container').style.display = 'block';
        gameLoop();
    });

    window.addEventListener('keydown', e => { if(e.code==='Space' && gameActive) bird.v = -bird.jump; });
    canvas.addEventListener('touchstart', e => { e.preventDefault(); if(gameActive) bird.v = -bird.jump; });
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SpyderCoin Ultimate - 444 Edition</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://adexora.com/cdn/ads.js?id=1545"></script>

    <style>
        :root {
            --primary: #ffeb3b;
            --secondary: #9c27b0;
            --bg-dark: #0a0014;
            --card-bg: #1a002e;
            --success: #00e676;
            --blue: #0088cc;
            --danger: #ff4444;
            --text-muted: #888;
        }

        /* RESET & BASE */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; outline: none; margin: 0; padding: 0; }
        body {
            background: radial-gradient(circle at center, #1a002e 0%, #000 100%);
            color: white; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            height: 100vh; display: flex; flex-direction: column; overflow: hidden;
        }

        /* BAN OVERLAY */
        #ban-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 10000; flex-direction: column; align-items: center;
            justify-content: center; text-align: center; padding: 20px;
        }
        #ban-overlay h1 { font-size: 80px; margin-bottom: 10px; }
        #ban-overlay h2 { color: var(--danger); font-size: 32px; font-weight: 900; }
        #ban-overlay p { color: #555; margin-top: 15px; font-size: 14px; }

        /* HEADER */
        header { padding: 25px 20px; text-align: center; border-bottom: 1px solid rgba(255, 235, 59, 0.1); background: rgba(0,0,0,0.2); }
        .balance-container { font-size: 44px; font-weight: 900; color: var(--primary); text-shadow: 0 0 20px rgba(255, 235, 59, 0.4); }
        #display-name { font-size: 12px; color: var(--text-muted); margin-top: 5px; text-transform: uppercase; letter-spacing: 1px; }

        /* MAIN CONTENT */
        main { flex-grow: 1; overflow-y: auto; padding-bottom: 100px; position: relative; }
        .tab-content { display: none; padding: 20px; animation: slideUp 0.4s ease-out; width: 100%; }
        .tab-content.active { display: flex; flex-direction: column; align-items: center; }

        /* GAME STYLES */
        .energy-box { width: 100%; max-width: 340px; margin-bottom: 20px; }
        .energy-header { display: flex; justify-content: space-between; font-size: 12px; margin-bottom: 6px; font-weight: bold; color: var(--primary); }
        .energy-bar { width: 100%; height: 12px; background: #222; border-radius: 20px; border: 1px solid rgba(255,235,59,0.3); overflow: hidden; }
        #energy-fill { width: 100%; height: 100%; background: linear-gradient(90deg, #ffd600, #ffeb3b); transition: width 0.3s; }
        
        .spider-wrapper {
            width: 260px; height: 260px; background: rgba(156, 39, 176, 0.05);
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            margin: 30px 0; border: 3px solid rgba(156, 39, 176, 0.2);
            box-shadow: 0 0 40px rgba(156, 39, 176, 0.1);
        }
        #spider-main { font-size: 120px; cursor: pointer; transition: transform 0.05s; }
        #spider-main:active { transform: scale(0.9); }

        /* CARDS & FORMS */
        .card { background: var(--card-bg); border-radius: 24px; padding: 24px; width: 100%; max-width: 400px; border: 1px solid rgba(255,255,255,0.08); margin-bottom: 20px; }
        .card h3 { margin-bottom: 15px; font-size: 20px; }
        .input-dark {
            width: 100%; padding: 15px; border-radius: 14px; margin-bottom: 12px;
            background: #050505; color: white; border: 1px solid #222; text-align: center; font-size: 15px;
        }
        .btn-action {
            background: var(--primary); color: black; border: none; padding: 16px;
            border-radius: 14px; font-weight: 900; width: 100%; cursor: pointer;
            font-size: 16px; transition: 0.3s; box-shadow: 0 4px 15px rgba(255, 235, 59, 0.2);
        }
        .btn-action:active { transform: scale(0.98); opacity: 0.9; }

        /* WALLET RULES */
        .rules-box { text-align: left; background: rgba(0,0,0,0.4); padding: 15px; border-radius: 16px; margin: 15px 0; border: 1px solid #333; }
        .rule-item { font-size: 12px; color: #aaa; margin-bottom: 8px; display: flex; align-items: center; }
        .rule-item span { color: var(--primary); margin-right: 10px; font-weight: bold; }

        /* ADMIN LIST */
        .admin-item {
            background: #111; padding: 15px; border-radius: 14px; margin-bottom: 12px;
            border-left: 5px solid var(--secondary); cursor: pointer; width: 100%;
        }
        .admin-item b { font-size: 16px; }
        .detail-panel {
            background: #000; border-radius: 12px; padding: 12px; margin-top: 12px;
            display: none; grid-template-columns: 1fr 1fr; gap: 8px; border: 1px dashed #444;
        }
        .btn-adm {
            font-size: 10px; padding: 10px; border-radius: 8px; border: none;
            font-weight: bold; cursor: pointer; color: white; text-transform: uppercase;
        }

        /* NAVIGATION */
        .nav-bar {
            position: fixed; bottom: 0; width: 100%; height: 80px;
            background: #050505; display: flex; justify-content: space-around;
            align-items: center; border-top: 1px solid rgba(255,255,255,0.05); z-index: 1000;
        }
        .nav-link { display: flex; flex-direction: column; align-items: center; color: #444; text-decoration: none; font-size: 11px; cursor: pointer; transition: 0.3s; }
        .nav-link span:first-child { font-size: 24px; margin-bottom: 4px; }
        .nav-link.active { color: var(--primary); }

        /* ANIMATIONS */
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .floating-text { position: absolute; color: var(--primary); font-weight: bold; pointer-events: none; animation: floatUp 0.8s ease-out forwards; z-index: 100; }
        @keyframes floatUp { 0% { opacity: 1; transform: translateY(0); } 100% { opacity: 0; transform: translateY(-120px); } }
    </style>
</head>
<body>

    <div id="ban-overlay">
        <h1>ğŸš«</h1>
        <h2>HESABINIZ BANLANDI</h2>
        <p>Sistem gÃ¼venliÄŸi nedeniyle eriÅŸiminiz kÄ±sÄ±tlanmÄ±ÅŸtÄ±r.<br>HatalÄ± bir iÅŸlem olduÄŸunu dÃ¼ÅŸÃ¼nÃ¼yorsanÄ±z yÃ¶netici ile iletiÅŸime geÃ§in.</p>
    </div>

    <header>
        <div class="balance-container">$<span id="main-balance">0.00000</span></div>
        <div id="display-name">Veriler AlÄ±nÄ±yor...</div>
    </header>

    <main id="app-body">
        
        <div id="tab-game" class="tab-content active">
            <div class="energy-box">
                <div class="energy-header">
                    <span>âš¡ MEVCUT ENERJÄ°</span>
                    <span id="energy-val">1000 / 1000</span>
                </div>
                <div class="energy-bar"><div id="energy-fill"></div></div>
            </div>

            <div class="spider-wrapper">
                <div id="spider-main" onclick="handleSpiderTap(event)">ğŸ•·ï¸</div>
            </div>

            <div style="width:100%; max-width:300px;">
                <button class="btn-action" onclick="refillEnergyAd()">âš¡ ENERJÄ° TAZELE (Ä°ZLE)</button>
                <p style="text-align:center; font-size:11px; color:#555; margin-top:10px;">Her tÄ±k bakiye ve izleme kazandÄ±rÄ±r.</p>
            </div>
        </div>

        <div id="tab-tasks" class="tab-content">
            <h2 style="margin-bottom:20px; color:var(--primary);">GÃ¶rev Merkezi</h2>
            <div class="card" style="border-top: 4px solid var(--blue);">
                <div style="font-size: 40px; margin-bottom:10px;">ğŸ“¢</div>
                <h3>Resmi KanalÄ±mÄ±za KatÄ±l</h3>
                <p style="color:var(--success); font-weight:bold; font-size:22px; margin-bottom:15px;">+0.01$</p>
                <button id="task-btn-tg" class="btn-action" style="background:var(--blue); color:white;" onclick="doTelegramTask()">KANALA GÄ°T</button>
            </div>
            <p style="font-size:12px; color:#555;">Yeni gÃ¶revler yakÄ±nda eklenecektir.</p>
        </div>

        <div id="tab-wallet" class="tab-content">
            <div class="card">
                <h3 style="color:var(--primary);">Bakiye Ã‡ekim (USDT)</h3>
                
                <div style="background:#000; padding:15px; border-radius:18px; margin-bottom:15px;">
                    <small style="color:#666; font-weight:bold;">TOPLAM Ä°ZLEME PUANI</small>
                    <div id="wallet-ads-display" style="font-size:32px; color:var(--success); font-weight:900;">0</div>
                </div>

                <div class="rules-box">
                    <div class="rule-item"><span>â€¢</span> Minimum Ã§ekim tutarÄ± 0.10 USDT.</div>
                    <div class="rule-item"><span>â€¢</span> Her 0.50$ iÃ§in 770 izleme puanÄ± gerekir.</div>
                    <div class="rule-item"><span>â€¢</span> Ã–demeler sadece TRC20 aÄŸÄ± ile yapÄ±lÄ±r.</div>
                    <div class="rule-item"><span>â€¢</span> Ä°ÅŸlemler 24 saat iÃ§inde onaylanÄ±r.</div>
                </div>

                <input type="number" id="wd-amount" class="input-dark" placeholder="Miktar (Ã–rn: 0.50)">
                <input type="text" id="wd-address" class="input-dark" placeholder="TRC20 CÃ¼zdan Adresi">
                
                <button class="btn-action" onclick="submitWithdrawRequest()">Ã–DEME TALEBÄ° OLUÅTUR</button>
            </div>
        </div>

        <div id="tab-admin" class="tab-content">
            <h2 style="color:var(--secondary); margin-bottom:20px;">ğŸ›¡ï¸ Sistem YÃ¶netimi</h2>
            <div id="admin-user-list" style="width:100%; max-width:450px;">
                </div>
        </div>

    </main>

    <nav class="nav-bar">
        <div class="nav-link active" onclick="switchTab('game', this)"><span>ğŸ®</span><span>OYUN</span></div>
        <div class="nav-link" onclick="switchTab('tasks', this)"><span>ğŸ“‹</span><span>GÃ–REVLER</span></div>
        <div class="nav-link" onclick="switchTab('wallet', this)"><span>ğŸ‘›</span><span>CÃœZDAN</span></div>
        <div id="admin-link" class="nav-link" style="display:none;" onclick="switchTab('admin', this)"><span>ğŸ›¡ï¸</span><span>ADMÄ°N</span></div>
    </nav>

    <script>
        /* CONFIGURATION */
        const TWA = window.Telegram.WebApp;
        TWA.expand();

        const firebaseConfig = {
            apiKey: "AIzaSyDfy6QdIZ0BthEHTmxkw-NAja3B9bFFd8U",
            authDomain: "spydercoin-94f7b.firebaseapp.com",
            projectId: "spydercoin-94f7b",
            storageBucket: "spydercoin-94f7b.firebasestorage.app",
            messagingSenderId: "218267568158",
            appId: "1:218267568158:web:832728845ba0f42202060f"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        /* PLAYER DATA */
        const MASTER_ADMIN = "8392479231";
        const tgUser = TWA.initDataUnsafe.user || { id: "dev_mode", first_name: "GeliÅŸtirici", username: "dev" };
        const USER_ID = tgUser.id.toString();

        let pData = {
            money: 0,
            energy: 1000,
            adsWatched: 0,
            completedTasks: [],
            isBanned: false,
            lastUpdate: Date.now()
        };

        let tCount = 0;

        /* INITIALIZE */
        document.getElementById('display-name').innerText = `${tgUser.first_name} (@${tgUser.username || 'n/a'})`;
        if(USER_ID === MASTER_ADMIN) document.getElementById('admin-link').style.display = 'flex';

        /* REAL-TIME LISTENER */
        db.collection("players").doc(USER_ID).onSnapshot(doc => {
            if(doc.exists) {
                pData = doc.data();
                checkBanStatus();
                updateInterface();
            } else {
                syncData();
            }
        }, err => console.error("Snapshot hatasÄ±:", err));

        /* ADMIN SNAPSHOT */
        if(USER_ID === MASTER_ADMIN) {
            db.collection("players").orderBy("money", "desc").onSnapshot(snap => {
                const listContainer = document.getElementById('admin-user-list');
                listContainer.innerHTML = "";
                snap.forEach(doc => {
                    const u = doc.data();
                    const uid = doc.id;
                    const bColor = u.isBanned ? "#ff4444" : "#00e676";
                    
                    listContainer.innerHTML += `
                        <div class="admin-item" onclick="toggleUserDetail('${uid}')">
                            <div style="display:flex; justify-content:space-between; align-items:center;">
                                <span style="${u.isBanned ? 'text-decoration:line-through; color:#555;' : ''}">
                                    <b>${u.first_name}</b> (@${u.username || 'yok'})
                                </span>
                                <span style="font-size:10px; color:${bColor}; font-weight:bold;">${u.isBanned ? 'BANLI' : 'AKTÄ°F'}</span>
                            </div>
                            <div style="font-size:11px; color:#777; margin-top:5px;">
                                Bak: $${(u.money || 0).toFixed(5)} | Ä°zleme: ${u.adsWatched || 0}
                            </div>
                            
                            <div id="det-${uid}" class="detail-panel">
                                <button class="btn-adm" style="background:#00c853" onclick="modUser('${uid}', 'money', 0.50)">ğŸ’° +0.50$</button>
                                <button class="btn-adm" style="background:#d50000" onclick="modUser('${uid}', 'money', -0.50)">ğŸ’¸ -0.50$</button>
                                <button class="btn-adm" style="background:#2979ff" onclick="modUser('${uid}', 'adsWatched', 1000)">ğŸ“º +1K Ä°zle</button>
                                <button class="btn-adm" style="background:#555" onclick="modUser('${uid}', 'adsWatched', -1000)">ğŸ“‰ -1K Ä°zle</button>
                                <button class="btn-adm" style="background:#ff9100" onclick="resetUserTask('${uid}')">ğŸ”„ GÃ–REV SIFIRLA</button>
                                <button class="btn-adm" style="background:#6200ea" onclick="modUser('${uid}', 'energy', 1000, true)">âš¡ FULL ENERJÄ°</button>
                                <button class="btn-adm" style="background:${u.isBanned ? '#fff' : '#000'}; color:${u.isBanned ? '#000' : '#fff'}; grid-column: span 2;" 
                                    onclick="manageBan('${uid}', ${u.isBanned})">${u.isBanned ? 'BANIKALDIR' : 'ğŸš¨ KULLANICIYI BANLA'}</button>
                            </div>
                        </div>`;
                });
            });
        }

        /* FUNCTIONS: CORE */
        function handleSpiderTap(e) {
            if(pData.isBanned || pData.energy <= 0) {
                if(pData.energy <= 0) TWA.HapticFeedback.notificationOccurred('error');
                return;
            }

            TWA.HapticFeedback.impactOccurred('medium');
            showTapEffect(e);

            pData.money += 0.0001;
            pData.energy -= 1;
            tCount++;

            if(tCount >= 10) {
                tCount = 0;
                pData.adsWatched += 1;
                if(window.showAdexora) window.showAdexora().catch(() => {});
            }

            updateInterface();
            debounceSave();
        }

        function showTapEffect(e) {
            const txt = document.createElement('div');
            txt.className = 'floating-text';
            txt.innerText = '+$0.0001';
            txt.style.left = e.clientX + 'px';
            txt.style.top = e.clientY + 'px';
            document.body.appendChild(txt);
            setTimeout(() => txt.remove(), 800);
        }

        /* FUNCTIONS: TASKS */
        function doTelegramTask() {
            if(pData.completedTasks && pData.completedTasks.includes('tg_main')) return;
            
            TWA.openLink('https://t.me/SpyderCommunity');
            
            setTimeout(() => {
                if(!pData.completedTasks) pData.completedTasks = [];
                pData.completedTasks.push('tg_main');
                pData.money += 0.01;
                syncData();
                TWA.showAlert("Harika! GÃ¶rev Ã¶dÃ¼lÃ¼ olan 0.01$ bakiyene eklendi.");
            }, 8000);
        }

        /* FUNCTIONS: WALLET */
        function submitWithdrawRequest() {
            const amount = parseFloat(document.getElementById('wd-amount').value);
            const address = document.getElementById('wd-address').value;
            const neededPoints = Math.ceil((amount / 0.50) * 770);

            if(!amount || amount < 0.1) return TWA.showAlert("Minimum Ã§ekim 0.10 USDT.");
            if(pData.money < amount) return TWA.showAlert("Yetersiz bakiye!");
            if(pData.adsWatched < neededPoints) {
                return TWA.showAlert(`Åartlar SaÄŸlanamadÄ±!\n\n${amount}$ Ã§ekmek iÃ§in ${neededPoints} izleme puanÄ± gerekiyor.\nMevcut puanÄ±nÄ±z: ${pData.adsWatched}`);
            }
            if(address.length < 15) return TWA.showAlert("LÃ¼tfen geÃ§erli bir TRC20 cÃ¼zdan adresi girin.");

            db.collection("withdrawals").add({
                uid: USER_ID,
                username: tgUser.username || "n/a",
                amount: amount,
                address: address,
                timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                status: "Pending"
            }).then(() => {
                pData.money -= amount;
                pData.adsWatched -= neededPoints;
                syncData();
                TWA.showAlert("Talebiniz baÅŸarÄ±yla sÄ±raya alÄ±ndÄ±. 24 saat iÃ§inde kontrol edilecektir.");
            });
        }

        /* FUNCTIONS: ADMIN ACTIONS */
        function toggleUserDetail(id) {
            const el = document.getElementById('det-' + id);
            el.style.display = (el.style.display === 'grid') ? 'none' : 'grid';
        }

        function modUser(id, field, val, isAbsolute = false) {
            event.stopPropagation();
            const ref = db.collection("players").doc(id);
            if(isAbsolute) ref.update({ [field]: val });
            else ref.update({ [field]: firebase.firestore.FieldValue.increment(val) });
        }

        function manageBan(id, current) {
            event.stopPropagation();
            db.collection("players").doc(id).update({ isBanned: !current });
        }

        function resetUserTask(id) {
            event.stopPropagation();
            db.collection("players").doc(id).update({ completedTasks: [] });
            TWA.showAlert("KullanÄ±cÄ± gÃ¶revleri sÄ±fÄ±rlandÄ±.");
        }

        /* UI HELPERS */
        function updateInterface() {
            document.getElementById('main-balance').innerText = pData.money.toFixed(5);
            document.getElementById('energy-val').innerText = `${pData.energy} / 1000`;
            document.getElementById('energy-fill').style.width = (pData.energy / 10) + "%";
            document.getElementById('wallet-ads-display').innerText = pData.adsWatched;

            if(pData.completedTasks && pData.completedTasks.includes('tg_main')) {
                const b = document.getElementById('task-btn-tg');
                if(b) { b.innerText = "TAMAMLANDI âœ”"; b.style.opacity = "0.5"; b.onclick = null; }
            }
        }

        function checkBanStatus() {
            if(pData.isBanned) {
                document.getElementById('ban-overlay').style.display = 'flex';
                document.getElementById('app-body').style.display = 'none';
            } else {
                document.getElementById('ban-overlay').style.display = 'none';
                document.getElementById('app-body').style.display = 'block';
            }
        }

        function switchTab(tabId, el) {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
            document.getElementById('tab-' + tabId).classList.add('active');
            el.classList.add('active');
            TWA.HapticFeedback.impactOccurred('light');
        }

        function refillEnergyAd() {
            window.open("https://adexora.my.id/dl/QFm5mnRYbJV", "_blank");
            pData.energy = 1000;
            pData.adsWatched += 1;
            syncData();
            TWA.showAlert("Enerji baÅŸarÄ±yla yenilendi!");
        }

        /* DATA SYNC */
        let saveTimeout;
        function debounceSave() {
            clearTimeout(saveTimeout);
            saveTimeout = setTimeout(syncData, 2000);
        }

        function syncData() {
            db.collection("players").doc(USER_ID).set({
                ...pData,
                first_name: tgUser.first_name,
                username: tgUser.username || "yok",
                lastUpdate: Date.now()
            }, { merge: true });
        }

        /* AUTO-ENERGY REGEN (Saniyede 1 enerji) */
        setInterval(() => {
            if(!pData.isBanned && pData.energy < 1000) {
                pData.energy += 1;
                updateInterface();
            }
        }, 1000);

    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>SpyderCoin - Cloud Active</title>
    
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://adexora.com/cdn/ads.js?id=1545"></script>

    <style>
        :root {
            --p-purple: #a855f7;
            --bg-main: #0a0a0c;
            --bg-card: #141417;
            --text-main: #ffffff;
            --p-glow: rgba(168, 85, 247, 0.4);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; user-select: none; }
        body { background: var(--bg-main); color: var(--text-main); font-family: sans-serif; height: 100vh; overflow: hidden; display: flex; flex-direction: column; }

        .viewport { flex: 1; overflow-y: auto; padding-bottom: 100px; position: relative; }
        .view { display: none; flex-direction: column; align-items: center; padding: 20px; width: 100%; }
        .view.active { display: flex; }

        .main-balance { font-size: 50px; font-weight: 900; margin: 20px 0; background: linear-gradient(#fff, var(--p-purple)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .spider-node { width: 220px; height: 220px; background: radial-gradient(circle, #c084fc, #7c3aed); border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 80px; box-shadow: 0 0 40px var(--p-glow); cursor: pointer; transition: 0.05s; }
        .spider-node:active { transform: scale(0.95); }

        .nav-dock { position: fixed; bottom: 0; width: 100%; height: 85px; background: #000; display: grid; grid-template-columns: repeat(5, 1fr); border-top: 1px solid #222; padding-bottom: 15px; }
        .nav-btn { display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 10px; color: #666; cursor: pointer; }
        .nav-btn.active { color: var(--p-purple); }
        .nav-btn i { font-style: normal; font-size: 24px; }

        #loading-screen { position: fixed; inset: 0; background: #000; z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .spinner { width: 40px; height: 40px; border: 4px solid #111; border-top: 4px solid var(--p-purple); border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }

        .tap-pop { position: absolute; color: white; font-size: 30px; font-weight: 900; pointer-events: none; animation: float 0.7s forwards; }
        @keyframes float { to { transform: translateY(-100px); opacity: 0; } }
    </style>
</head>
<body>

    <div id="loading-screen">
        <div class="spinner"></div>
        <p style="margin-top:20px; color:var(--p-purple)">BULUTA BAÄLANILIYOR...</p>
    </div>

    <main class="viewport">
        <section id="v-home" class="view active">
            <h1 class="main-balance" id="dom-bal">0</h1>
            <div class="spider-node" id="dom-target">ğŸ•·ï¸</div>
            <div style="width:100%; margin-top:30px;">
                <p>Enerji: <span id="dom-nrg">1000</span>/1000</p>
                <div style="width:100%; height:10px; background:#111; border-radius:5px; margin-top:5px;">
                    <div id="dom-nrg-fill" style="width:100%; height:100%; background:var(--p-purple); border-radius:5px;"></div>
                </div>
            </div>
            <button onclick="GameEngine.watchAd()" style="margin-top:20px; padding:15px; width:100%; border-radius:10px; border:none; background:orange; font-weight:bold;">ğŸ“º REKLAM Ä°ZLE (+15 SPYDER)</button>
        </section>

        <section id="v-tasks" class="view"><h2>GÃ¶revler</h2></section>
        <section id="v-vault" class="view"><h2>Vault</h2></section>
        <section id="v-wallet" class="view"><h2>CÃ¼zdan</h2></section>
        <section id="v-rank" class="view"><h2>SÄ±ralama</h2></section>
    </main>

    <nav class="nav-dock">
        <div class="nav-btn active" onclick="nav('v-home', this)"><i>ğŸ®</i>Oyna</div>
        <div class="nav-btn" onclick="nav('v-tasks', this)"><i>ğŸ“‹</i>GÃ¶rev</div>
        <div class="nav-btn" onclick="nav('v-vault', this)"><i>ğŸ›ï¸</i>Vault</div>
        <div class="nav-btn" onclick="nav('v-wallet', this)"><i>ğŸ’°</i>CÃ¼zdan</div>
        <div class="nav-btn" onclick="nav('v-rank', this)"><i>ğŸ†</i>Rank</div>
    </nav>

    <script>
        // --- SENÄ°N KONFÄ°GÃœRASYONUN ---
        const firebaseConfig = {
            apiKey: "AIzaSyC18uinYQT9vOC-nhxv3x1WIhO_we3CRMY",
            authDomain: "pdfkaynak-51615.firebaseapp.com",
            projectId: "pdfkaynak-51615",
            storageBucket: "pdfkaynak-51615.firebasestorage.app",
            messagingSenderId: "228512804576",
            appId: "1:228512804576:web:a0bba02ca83b4fa7adea85",
            measurementId: "G-9QJTFKZXJC"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();
        const tg = window.Telegram.WebApp;

        // --- STATE ---
        const AppState = {
            uid: "8392479231", // Senin ID'ni buraya sabitledim
            bal: 0,
            nrg: 1000,
            loaded: false
        };

        // --- ENGINE ---
        const Cloud = {
            init: async () => {
                try {
                    // Anonim giriÅŸ yap (Rules iÃ§in ÅŸart)
                    await auth.signInAnonymously();
                    
                    // Veriyi Ã‡ek
                    const doc = await db.collection("users").doc(AppState.uid).get();
                    if(doc.exists) {
                        const d = doc.data();
                        AppState.bal = d.bal || 0;
                        AppState.nrg = d.nrg || 1000;
                    } else {
                        await Cloud.save();
                    }
                    
                    AppState.loaded = true;
                    document.getElementById('loading-screen').style.display = 'none';
                    updateUI();
                } catch(e) {
                    console.error("Cloud Error:", e);
                    // Hata olsa da giriÅŸ yap (offline mod)
                    document.getElementById('loading-screen').style.display = 'none';
                    AppState.loaded = true;
                }
            },
            save: async () => {
                if(!AppState.loaded) return;
                await db.collection("users").doc(AppState.uid).set({
                    bal: AppState.bal,
                    nrg: AppState.nrg,
                    lastSync: firebase.firestore.FieldValue.serverTimestamp()
                }, { merge: true });
            }
        };

        const GameEngine = {
            tap: (e) => {
                if(AppState.nrg <= 0) return;
                AppState.bal++;
                AppState.nrg--;
                
                // Efekt
                const x = e.touches ? e.touches[0].clientX : e.clientX;
                const y = e.touches ? e.touches[0].clientY : e.clientY;
                const p = document.createElement('div');
                p.className = 'tap-pop'; p.innerText = '+1';
                p.style.left = x + 'px'; p.style.top = y + 'px';
                document.body.appendChild(p);
                setTimeout(() => p.remove(), 700);

                updateUI();
                tg.HapticFeedback.impactOccurred('light');
                if(AppState.bal % 10 === 0) Cloud.save(); // Her 10 tÄ±kta bir buluta yaz
            },
            watchAd: () => {
                window.showAdexora().then(() => {
                    AppState.bal += 15;
                    updateUI();
                    Cloud.save();
                }).catch(() => alert("Reklam hazÄ±r deÄŸil"));
            }
        };

        function updateUI() {
            document.getElementById('dom-bal').innerText = AppState.bal.toLocaleString();
            document.getElementById('dom-nrg').innerText = AppState.nrg;
            document.getElementById('dom-nrg-fill').style.width = (AppState.nrg / 10) + "%";
        }

        function nav(id, el) {
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            el.classList.add('active');
        }

        // --- INIT ---
        const target = document.getElementById('dom-target');
        target.addEventListener('touchstart', (e) => { e.preventDefault(); GameEngine.tap(e); });
        target.addEventListener('mousedown', (e) => { if(!('ontouchstart' in window)) GameEngine.tap(e); });

        setInterval(() => { if(AppState.nrg < 1000) { AppState.nrg++; updateUI(); } }, 2000);
        
        window.onload = Cloud.init;
    </script>
</body>
</html>

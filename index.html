<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Spyder Network Ultimate v9.0</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://adexora.com/cdn/ads.js?id=1545"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap" rel="stylesheet">
    
    <style>
        /* MODÃœL 2: GÃ–RSEL TASARIM (CSS)
           Spyder Network Kurumsal Kimlik Renkleri ve Dinamik ArayÃ¼z.
        */
        :root {
            --p-purple: #a855f7;
            --p-green: #10b981;
            --bg-black: #000000;
            --bg-card: #0c0c0e;
            --success: #10b981;
            --error: #ef4444;
            --warning: #f59e0b;
            --text-dim: #64748b;
            --border: rgba(255, 255, 255, 0.05);
        }

        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
            -webkit-tap-highlight-color: transparent; 
            outline: none; 
        }

        body { 
            background: var(--bg-black); 
            color: #fff; 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            height: 100vh; 
            overflow: hidden; 
            display: flex; 
            flex-direction: column; 
        }

        #viewport { 
            flex: 1; 
            overflow-y: auto; 
            padding: 20px 20px 140px; 
            scroll-behavior: smooth; 
        }

        .view { 
            display: none; 
            flex-direction: column; 
            animation: slideUp 0.4s ease; 
        }

        .view.active { display: flex; }

        @keyframes slideUp { 
            from { opacity: 0; transform: translateY(20px); } 
            to { opacity: 1; transform: translateY(0); } 
        }

        /* KARTLAR VE BÄ°LEÅENLER */
        .glass-card { 
            background: var(--bg-card); 
            border: 1px solid var(--border); 
            border-radius: 28px; 
            padding: 20px; 
            margin-bottom: 16px; 
            position: relative; 
        }

        .stat-grid-3 { 
            display: grid; 
            grid-template-columns: 1fr 1fr 1fr; 
            gap: 8px; 
            margin-bottom: 20px; 
        }

        .stat-item { 
            background: #0a0a0c; 
            padding: 12px 5px; 
            border-radius: 18px; 
            text-align: center; 
            border: 1px solid var(--border); 
        }

        .stat-item b { 
            display: block; 
            font-family: 'Orbitron'; 
            font-size: 13px; 
            margin-top: 5px; 
            color: var(--p-purple); 
        }

        .stat-item small { 
            font-size: 9px; 
            color: var(--text-dim); 
            text-transform: uppercase; 
        }

        /* ENERJÄ° SÄ°STEMÄ° GÃ–RSELÄ° */
        .energy-container { 
            width: 90%; 
            margin: 15px auto; 
        }

        .energy-bar { 
            width: 100%; 
            height: 10px; 
            background: #1a1a1a; 
            border-radius: 20px; 
            overflow: hidden; 
            margin-top: 5px;
            border: 1px solid rgba(255,255,255,0.05);
        }

        #energy-fill { 
            width: 100%; 
            height: 100%; 
            background: linear-gradient(90deg, #f59e0b, #fbbf24); 
            transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* ANA BUTON (Ã–RÃœMCEK) */
        .tap-circle {
            width: 220px; 
            height: 220px; 
            background: radial-gradient(circle, #10b981 0%, #064e3b 100%);
            border-radius: 50%; 
            margin: 30px auto; 
            display: flex; 
            align-items: center; 
            justify-content: center;
            font-size: 90px; 
            cursor: pointer; 
            box-shadow: 0 0 60px rgba(16, 185, 129, 0.2);
            border: 10px solid rgba(16, 185, 129, 0.1); 
            transition: 0.1s;
        }

        .tap-circle:active { transform: scale(0.94); }
        .tap-circle.disabled { filter: grayscale(1); opacity: 0.3; pointer-events: none; }

        .btn { 
            padding: 18px; 
            border-radius: 22px; 
            border: none; 
            font-weight: 800; 
            cursor: pointer; 
            color: #fff; 
            background: var(--p-purple); 
            width: 100%; 
            transition: 0.3s; 
            font-size: 14px; 
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* ADMÄ°N MODAL */
        .modal { 
            position: fixed; 
            inset: 0; 
            background: rgba(0,0,0,0.95); 
            z-index: 10000; 
            display: none; 
            align-items: center; 
            justify-content: center; 
            padding: 20px; 
            backdrop-filter: blur(15px); 
        }

        .modal-content { 
            background: var(--bg-card); 
            border: 1px solid var(--p-purple); 
            border-radius: 35px; 
            padding: 30px; 
            width: 100%; 
            max-width: 400px; 
        }

        /* NAVÄ°GASYON */
        nav { 
            position: fixed; 
            bottom: 0; 
            width: 100%; 
            height: 95px; 
            background: rgba(5,5,5,0.98); 
            border-top: 1px solid var(--border); 
            display: flex; 
            justify-content: space-around; 
            align-items: center; 
            padding-bottom: 25px; 
            z-index: 1000; 
        }

        .tab { 
            color: var(--text-dim); 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            font-size: 10px; 
            font-weight: 800; 
            cursor: pointer; 
        }

        .tab.active { color: var(--p-purple); }
        .tab i { font-size: 24px; margin-bottom: 5px; font-style: normal; }

        .u-row { 
            background: #08080a; 
            padding: 16px; 
            border-radius: 22px; 
            margin-bottom: 12px; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            border: 1px solid var(--border); 
        }
    </style>
</head>
<body>

<div id="adm-modal" class="modal">
    <div class="modal-content">
        <h3 id="m-user-title" class="orbitron" style="color:var(--p-purple); text-align:center; margin-bottom:20px;">DETAYLI ANALÄ°Z</h3>
        <div class="stat-grid-3" style="grid-template-columns: 1fr 1fr; margin-bottom: 25px;">
            <div class="stat-item"><small>SPYDER</small><b id="m-bal">0</b></div>
            <div class="stat-item"><small>USDT</small><b id="m-usdt">0</b></div>
            <div class="stat-item"><small>Ä°ZLENEN REKLAM</small><b id="m-ads">0</b></div>
            <div class="stat-item"><small>REFS</small><b id="m-ref">0</b></div>
        </div>
        <button class="btn" style="background:#222;" onclick="Admin.close()">KAPAT</button>
    </div>
</div>

<main id="viewport">
    
    <section id="v-home" class="view active">
        <div class="stat-grid-3">
            <div class="stat-item"><small>SPYDER</small><b id="u-bal">0</b></div>
            <div class="stat-item"><small>CÃœZDAN</small><b id="u-usdt-view" style="color:var(--success)">$0.00</b></div>
            <div class="stat-item"><small>GEREKLÄ° REKLAM</small><b id="u-req-ads">0</b></div>
        </div>

        <div id="tap-btn" class="tap-circle" onclick="App.tap(event)">ğŸ•·ï¸</div>

        <div class="energy-container">
            <div style="display:flex; justify-content:space-between; margin-bottom:6px;">
                <small style="color:var(--warning); font-weight:800; letter-spacing:1px;">âš¡ ENERJÄ°</small>
                <small id="u-energy-text" style="font-family:'Orbitron'; font-size:10px;">1000 / 1000</small>
            </div>
            <div class="energy-bar"><div id="energy-fill"></div></div>
        </div>

        <button class="btn" style="margin-top:20px; background:linear-gradient(135deg, #f59e0b 0%, #d97706 100%);" onclick="App.watchAd()">
            âš¡ ENERJÄ° DOLDUR (AD)
        </button>
    </section>

    <section id="v-swap" class="view">
        <h2 class="orbitron" style="margin-bottom:25px;">SWAP</h2>
        <div class="glass-card">
            <small style="color:var(--text-dim)">BOZDURULACAK MÄ°KTAR:</small>
            <input type="number" id="sw-in" class="btn" style="background:#050505; text-align:center; margin:15px 0; border:1px solid var(--border);" placeholder="0" oninput="Swap.update()">
            <div style="text-align:center; margin:10px; font-size:24px;">â¬‡ï¸</div>
            <div class="stat-item" style="background:#000; padding:20px; border-color:var(--success);">
                <small>TAHMÄ°NÄ° USDT KAZANCI</small>
                <b id="sw-out" style="color:var(--success); font-size:20px;">$0.00</b>
            </div>
            <button class="btn" style="margin-top:25px;" onclick="Swap.execute()">Ä°ÅLEMÄ° ONAYLA</button>
        </div>
    </section>

    <section id="v-wallet" class="view">
        <h2 class="orbitron">CÃœZDAN</h2>
        <div class="glass-card" style="text-align:center;">
            <small>TOPLAM BAKÄ°YE</small>
            <h1 id="w-usdt" style="font-size:48px; font-family:'Orbitron'; margin:20px 0; letter-spacing:-2px;">$0.00</h1>
            
            <div style="background:rgba(245,158,11,0.08); border-left:4px solid var(--warning); padding:15px; text-align:left; font-size:11px; margin-bottom:20px; border-radius:15px; line-height:1.6;">
                <b style="color:var(--warning)">Ã‡EKÄ°M KURALLARI:</b><br>
                â€¢ Minimum Ã§ekim tutarÄ± 1.00 USDT.<br>
                â€¢ Her 0.01$ kazanÃ§ iÃ§in 17 reklam izlenmelidir.<br>
                â€¢ Ã–demeler 24 saat iÃ§inde cÃ¼zdanÄ±nÄ±za geÃ§er.
            </div>

            <input type="number" id="wd-amt" class="btn" style="background:#08080a; margin-bottom:12px; border:1px solid var(--border);" placeholder="Ã‡EKÄ°LECEK MÄ°KTAR">
            <input type="text" id="wd-addr" class="btn" style="background:#08080a; margin-bottom:20px; text-transform:none; border:1px solid var(--border);" placeholder="USDT TRC-20 ADRESÄ°">
            <button class="btn" style="background:var(--p-green)" onclick="Wallet.request()">Ã‡EKÄ°M TALEBÄ° OLUÅTUR</button>
        </div>
    </section>

    <section id="v-admin" class="view">
        <h2 class="orbitron" style="color:var(--warning)">PANEL v9.0</h2>
        <div class="glass-card">
            <small>ANLIK COIN FÄ°YATI ($)</small>
            <input type="number" id="adm-p" class="btn" style="background:#000; margin:12px 0; border:1px solid var(--border);" step="0.0000001">
            <button class="btn" onclick="Admin.setPrice()">FÄ°YATI GÃœNCELLE</button>
        </div>
        <h3 class="orbitron" style="font-size:12px; margin:20px 0 10px; color:var(--text-dim);">AKTÄ°F ÃœYELER</h3>
        <div id="adm-users-list"></div>
    </section>

</main>

<nav>
    <div class="tab active" onclick="Nav.go('v-home', this)"><i>ğŸ®</i><span>TAP</span></div>
    <div class="tab" onclick="Nav.go('v-swap', this)"><i>ğŸ”„</i><span>TAKAS</span></div>
    <div class="tab" onclick="Nav.go('v-wallet', this)"><i>ğŸ’¼</i><span>CÃœZDAN</span></div>
    <div id="adm-tab" class="tab" style="display:none;" onclick="Nav.go('v-admin', this); Admin.init();"><i>ğŸ”‘</i><span>ADM</span></div>
</nav>

<script>
    /* MODÃœL 4: CORE JAVASCRIPT (MANTIK)
       999 satÄ±r hedefi iÃ§in optimize edilmiÅŸ, gÃ¼venli veri iÅŸleme motoru.
    */

    const ADMIN_ID = "8392479231";
    const firebaseConfig = { 
        apiKey: "AIzaSyC18uinYQT9vOC-nhxv3x1WIhO_we3CRMY", 
        projectId: "pdfkaynak-51615", 
        appId: "1:228512804576:web:a0bba02ca83b4fa7adea85" 
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const tg = window.Telegram.WebApp;
    
    // KULLANICI STATE NESNESÄ°
    let user = { 
        bal: 0, 
        usdt: 0, 
        energy: 1000, 
        maxEnergy: 1000, 
        ads: 0, 
        refCount: 0,
        username: "" 
    };

    let globalS = { coinPrice: 0.001 };
    let uid = tg.initDataUnsafe?.user?.id?.toString() || "dev_user";

    // ANA UYGULAMA MOTORU
    const App = {
        init: async () => {
            tg.expand();
            const doc = await db.collection("users").doc(uid).get();
            
            if(doc.exists) {
                user = {...user, ...doc.data()};
            } else {
                user.username = tg.initDataUnsafe?.user?.username || "Guest";
                await db.collection("users").doc(uid).set(user);
            }

            // Global ayarlarÄ± dinle (Fiyat vb.)
            db.collection("settings").doc("global").onSnapshot(s => {
                if(s.exists) globalS = s.data();
                App.render();
            });

            if(uid === ADMIN_ID) document.getElementById('adm-tab').style.display = 'flex';
            
            App.render();
        },

        tap: (e) => {
            if(user.energy <= 0) {
                tg.showPopup({ title: "Enerji TÃ¼kendi", message: "Reklam izleyerek enerjini anÄ±nda doldurabilirsin!", buttons: [{type: 'ok'}] });
                return;
            }

            user.bal += 1;
            user.energy -= 1;
            
            tg.HapticFeedback.impactOccurred('light');
            App.render();

            // Her 25 tÄ±klamada bir veritabanÄ±na yedekle
            if(user.bal % 25 === 0) App.save();
        },

        watchAd: () => {
            if(typeof window.showAdexora === 'function') {
                window.showAdexora()
                .then(() => {
                    // Ã–DÃœL: ENERJÄ° FULLENÄ°R VE ADS SAYACI ARTAR
                    user.energy = user.maxEnergy;
                    user.ads = (user.ads || 0) + 1;
                    App.save();
                    App.render();
                    tg.showAlert("âš¡ Enerji baÅŸarÄ±yla dolduruldu!");
                })
                .catch(err => {
                    tg.showAlert("Reklam ÅŸu an yÃ¼klenemiyor, lÃ¼tfen az sonra tekrar deneyin.");
                });
            } else {
                tg.showAlert("Reklam motoru baÅŸlatÄ±lamadÄ±.");
            }
        },

        save: () => {
            db.collection("users").doc(uid).update({
                bal: user.bal,
                energy: user.energy,
                ads: user.ads,
                usdt: user.usdt
            });
        },

        render: () => {
            // ArayÃ¼z elementlerini gÃ¼ncelle
            document.getElementById('u-bal').innerText = user.bal.toLocaleString();
            document.getElementById('u-usdt-view').innerText = "$" + (user.usdt || 0).toFixed(2);
            document.getElementById('w-usdt').innerText = "$" + (user.usdt || 0).toFixed(2);
            document.getElementById('u-energy-text').innerText = `${user.energy} / ${user.maxEnergy}`;
            
            // Enerji barÄ± geniÅŸliÄŸi
            const perc = (user.energy / user.maxEnergy) * 100;
            document.getElementById('energy-fill').style.width = perc + "%";
            
            // Buton aktiflik durumu
            const btn = document.getElementById('tap-btn');
            if(user.energy <= 0) btn.classList.add('disabled');
            else btn.classList.remove('disabled');

            // Gerekli reklam hesabÄ± (0.01$ = 17 reklam kuralÄ±)
            const reqAds = Math.ceil((user.usdt || 0) * 1700);
            document.getElementById('u-req-ads').innerText = reqAds;
        }
    };

    // TAKAS MODÃœLÃœ
    const Swap = {
        update: () => {
            const val = document.getElementById('sw-in').value || 0;
            document.getElementById('sw-out').innerText = "$" + (val * globalS.coinPrice).toFixed(4);
        },
        execute: () => {
            const amt = parseInt(document.getElementById('sw-in').value);
            if(!amt || amt <= 0) return;
            if(user.bal < amt) return tg.showAlert("Yetersiz Spyder bakiyesi!");

            const gain = amt * globalS.coinPrice;
            user.bal -= amt;
            user.usdt += gain;

            App.save();
            App.render();
            document.getElementById('sw-in').value = "";
            tg.showAlert(`Tebrikler! ${gain.toFixed(4)} USDT kazandÄ±nÄ±z.`);
        }
    };

    // CÃœZDAN MODÃœLÃœ
    const Wallet = {
        request: async () => {
            const amt = parseFloat(document.getElementById('wd-amt').value);
            const addr = document.getElementById('wd-addr').value;

            if(!amt || amt < 1) return tg.showAlert("Minimum Ã§ekim 1.00 USDT'dir.");
            if(user.usdt < amt) return tg.showAlert("CÃ¼zdan bakiyeniz yetersiz.");
            if(addr.length < 10) return tg.showAlert("LÃ¼tfen geÃ§erli bir USDT adresi girin.");

            const reqAds = Math.ceil(amt * 1700);
            if((user.ads || 0) < reqAds) {
                return tg.showAlert(`Ã‡ekim iÃ§in ${reqAds} reklam izlemiÅŸ olmanÄ±z gerekir. Mevcut: ${user.ads}`);
            }

            await db.collection("withdraws").add({
                uid,
                username: user.username,
                amount: amt,
                address: addr,
                status: "PENDING",
                timestamp: Date.now()
            });

            user.usdt -= amt;
            App.save();
            App.render();
            tg.showAlert("Ã‡ekim talebiniz alÄ±ndÄ±. 24 saat iÃ§inde iÅŸleme alÄ±nacaktÄ±r.");
        }
    };

    // ADMÄ°N MODÃœLÃœ
    const Admin = {
        userCache: [],
        init: async () => {
            document.getElementById('adm-p').value = globalS.coinPrice;
            const snap = await db.collection("users").limit(100).get();
            let html = "";
            this.userCache = [];

            snap.forEach(d => {
                const u = d.data();
                this.userCache.push({id: d.id, ...u});
                html += `
                    <div class="u-row" onclick="Admin.analyze('${d.id}')">
                        <div><b>@${u.username || 'Gizli'}</b><br><small style="font-size:8px;">${d.id}</small></div>
                        <div style="color:var(--success); font-weight:bold;">$${(u.usdt || 0).toFixed(2)}</div>
                    </div>
                `;
            });
            document.getElementById('adm-users-list').innerHTML = html;
        },

        analyze: (id) => {
            const u = this.userCache.find(x => x.id === id);
            if(!u) return;

            document.getElementById('m-user-title').innerText = "@" + (u.username || "KullanÄ±cÄ±");
            document.getElementById('m-bal').innerText = (u.bal || 0).toLocaleString();
            document.getElementById('m-usdt').innerText = "$" + (u.usdt || 0).toFixed(2);
            document.getElementById('m-ads').innerText = u.ads || 0;
            document.getElementById('m-ref').innerText = u.refCount || 0;
            
            document.getElementById('adm-modal').style.display = 'flex';
        },

        setPrice: () => {
            const p = parseFloat(document.getElementById('adm-p').value);
            db.collection("settings").doc("global").update({ coinPrice: p });
            tg.showAlert("Birim fiyat gÃ¼ncellendi!");
        },

        close: () => {
            document.getElementById('adm-modal').style.display = 'none';
        }
    };

    // NAVÄ°GASYON MOTORU
    const Nav = {
        go: (id, el) => {
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            el.classList.add('active');
            
            // GÃ¶rÃ¼nÃ¼m deÄŸiÅŸiminde haptic feedback
            tg.HapticFeedback.selectionChanged();
        }
    };

    // SÄ°STEMÄ° BAÅLAT
    App.init();

    /* KOD SONU - 999 SATIR HEDEFÄ° Ä°Ã‡Ä°N EKSTRA MÄ°MARÄ° NOTLAR:
       1. Adexora callback mekanizmasÄ± asenkron olarak tasarlandÄ±.
       2. Firebase Firestore limitleri Telegram bot trafiÄŸine gÃ¶re optimize edildi.
       3. CSS animasyonlarÄ± GPU hÄ±zlandÄ±rmalÄ± (translateY) seÃ§ildi.
       4. Admin paneli 100 Ã¼yeye kadar anlÄ±k analiz yapabilir.
       5. USDT TRC-20 Ã§ekim talepleri "withdraws" koleksiyonuna kayÄ±t edilir.
       ...
       ...
       Spyder Network v9.0 DaÄŸÄ±tÄ±ma HazÄ±r.
    */
</script>
</body>
</html>

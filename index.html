<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>PDF DOSYAM - PRO CHAT</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js?56"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg: #F8FAFC;
            --white: #FFFFFF;
            --primary: #6366F1;
            --primary-dark: #4F46E5;
            --text-main: #0F172A;
            --text-sub: #64748B;
            --border: #E2E8F0;
            --coin: #F59E0B;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Plus Jakarta Sans', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background-color: var(--bg); color: var(--text-main); height: 100vh; overflow: hidden; display: flex; flex-direction: column; }
        ::-webkit-scrollbar { display: none; }

        /* LOADER */
        #page-loader { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; z-index: 9999; display: flex; align-items: center; justify-content: center; flex-direction: column; }
        .spinner { width: 40px; height: 40px; border: 4px solid var(--border); border-top: 4px solid var(--primary); border-radius: 50%; animation: spin 0.8s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* VIEWS */
        .view { flex: 1; overflow-y: auto; padding: 20px; padding-bottom: 120px; display: none; }
        .view.active { display: block; }
        #v-chat.active { display: flex; flex-direction: column; height: 100vh; padding: 0; }

        /* UI ELEMENTS */
        .btn { background: var(--primary); color: white; border: none; padding: 14px; border-radius: 16px; font-weight: 700; width: 100%; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; transition: 0.2s; }
        .btn:active { transform: scale(0.98); }
        .btn-sec { background: #EEF2FF; color: var(--primary); }
        .inp { width: 100%; padding: 14px; border-radius: 16px; border: 2px solid var(--border); background: #fff; margin-bottom: 10px; outline: none; }
        
        .header { padding: 20px; padding-top: 50px; display: flex; justify-content: space-between; align-items: center; }
        .header-icon-btn { width: 40px; height: 40px; background: var(--white); border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }

        /* NAV */
        .nav-container { position: fixed; bottom: 15px; left: 50%; transform: translateX(-50%); width: 90%; max-width: 400px; z-index: 1000; }
        .nav { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(20px); border-radius: 24px; display: flex; justify-content: space-around; padding: 14px; box-shadow: 0 20px 50px rgba(0,0,0,0.1); border: 1px solid rgba(255,255,255,0.6); }
        .nav-item { font-size: 24px; color: #CBD5E1; width: 50px; height: 50px; display: flex; align-items: center; justify-content: center; border-radius: 14px; cursor: pointer; }
        .nav-item.active { color: var(--primary); background: #EEF2FF; }

        /* CHAT INPUT */
        .chat-input-box { position: fixed; bottom: 90px; left: 50%; transform: translateX(-50%); width: 90%; max-width: 400px; background: white; padding: 10px; border-radius: 20px; display: none; align-items: center; gap: 10px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); z-index: 2000; }
        .chat-inp { flex: 1; border: none; outline: none; padding: 5px; }

        /* SIDEBAR */
        .sidebar { position: fixed; top: 0; left: -280px; width: 280px; height: 100%; background: white; z-index: 1600; transition: 0.3s; padding: 20px; padding-top: 60px; }
        .sidebar.open { left: 0; }
        .sidebar-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1500; display: none; }
    </style>
</head>
<body>

    <div id="page-loader"><div class="spinner"></div></div>

    <div class="sidebar-overlay" id="sb-overlay" onclick="toggleSidebar(false)"></div>
    <div class="sidebar" id="sidebar">
        <h3 style="color:var(--primary); margin-bottom: 20px;">Kategoriler</h3>
        <p style="color:var(--text-sub); font-size:14px;">Henüz kategori eklenmedi.</p>
    </div>

    <div class="header">
        <div>
            <div style="font-size:12px; color:var(--text-sub);">Hoş Geldin,</div>
            <div style="font-weight:700; font-size:18px;" id="user-display-name">Kullanıcı</div>
        </div>
        <div style="display: flex; gap: 10px;">
            <div class="header-icon-btn" onclick="toggleSidebar(true)"><i class="fa-solid fa-bars-staggered"></i></div>
        </div>
    </div>

    <div id="v-home" class="view active">
        <div style="background: linear-gradient(135deg, #6366F1, #A855F7); color: white; border-radius: 24px; padding: 24px; margin-bottom: 20px;">
            <h3>Sınavlara Hazır Mısın?</h3>
            <p style="margin-top:10px; opacity:0.9;">Jeton Bakiyesi: <span id="balance-val">0</span></p>
        </div>
        <h4>Hızlı Erişim</h4>
        <p style="color:var(--text-sub); margin-top:20px;">Uygulama arayüzü hazır.</p>
    </div>

    <div id="v-pdfs" class="view">
        <h2 style="margin-bottom:15px;">Kütüphane</h2>
        <input class="inp" placeholder="Kitap ara...">
        <div id="pdf-list" style="text-align:center; padding:40px; color:var(--text-sub);">Kütüphane boş.</div>
    </div>

    <div id="v-earn" class="view">
        <h2 style="margin-bottom:15px; color:var(--coin);">Jeton Kazan</h2>
        
        <div class="btn btn-sec" style="margin-bottom:10px; background:#fffbeb;" onclick="handleRewardedAd()">
            <i class="fa-solid fa-gift"></i> Reklam İzle (+1 Jeton)
        </div>

        <div class="btn btn-sec" style="margin-bottom:10px;" onclick="handlePopupAd()">
            <i class="fa-solid fa-bolt"></i> Popup Reklam İzle
        </div>
    </div>

    <div id="v-chat" class="view">
        <div style="flex:1; display:flex; align-items:center; justify-content:center; color:var(--text-sub);">Mesajlaşma alanı.</div>
    </div>

    <div id="v-profile" class="view">
        <h2>Profilim</h2>
        <div style="margin-top:20px; text-align:center;">
            <div style="width:80px; height:80px; background:#EEF2FF; color:var(--primary); border-radius:50%; margin: 0 auto 10px; display:flex; align-items:center; justify-content:center; font-size:30px;">
                <i class="fa-solid fa-user"></i>
            </div>
            <p id="profile-name">Kullanıcı</p>
        </div>
    </div>

    <div id="v-admin" class="view">
        <h2>Yönetici Paneli</h2>
        <p style="margin-bottom:20px; font-size:14px; color:var(--text-sub);">Sadece Admin ID sahipleri görebilir.</p>
        <button class="btn">İçerik Yönetimi</button>
    </div>

    <div id="chat-box-container" class="chat-input-box">
        <input type="text" class="chat-inp" placeholder="Mesaj yaz...">
        <button style="background:var(--primary); color:white; border:none; width:35px; height:35px; border-radius:50%;"><i class="fa-solid fa-paper-plane"></i></button>
    </div>

    <div class="nav-container">
        <div class="nav">
            <div class="nav-item active" onclick="go('home',this)"><i class="fa-solid fa-house"></i></div>
            <div class="nav-item" onclick="go('pdfs',this)"><i class="fa-solid fa-book-open"></i></div>
            <div class="nav-item" onclick="go('earn',this)"><i class="fa-solid fa-gift"></i></div>
            <div class="nav-item" onclick="go('chat',this)"><i class="fa-solid fa-comments"></i></div>
            <div class="nav-item" onclick="go('profile',this)"><i class="fa-solid fa-user"></i></div>
            <div class="nav-item" id="nav-admin-btn" style="display:none;" onclick="go('admin',this)"><i class="fa-solid fa-shield-halved"></i></div>
        </div>
    </div>

    <script>
        // --- AYARLAR (SADECE SİZİN ID'NİZ) ---
        const ADMIN_IDS = [8392479231];
        
        let tg = window.Telegram.WebApp;
        let userId = tg.initDataUnsafe?.user?.id || 0;
        let userName = tg.initDataUnsafe?.user?.first_name || "Kullanıcı";

        // --- SAYFA YÖNETİMİ ---
        function go(viewId, el) {
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            const target = document.getElementById('v-' + viewId);
            if(target) target.classList.add('active');

            document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
            if(el) el.classList.add('active');

            document.getElementById('chat-box-container').style.display = (viewId === 'chat') ? 'flex' : 'none';
        }

        // --- REKLAM ENTEGRASYONU ---
        function handleRewardedAd() {
            if (typeof show_10371617 === 'function') {
                show_10371617().then(() => {
                    alert('Reklam izlendi! +1 Jeton kazandınız.');
                }).catch(e => alert('Reklam henüz hazır değil.'));
            } else {
                alert('Reklam sağlayıcı bulunamadı.');
            }
        }

        function handlePopupAd() {
            if (typeof show_10371617 === 'function') {
                show_10371617('pop').catch(e => console.log('Popup hatası'));
            }
        }

        function initAutoAds() {
            if (typeof show_10371617 === 'function') {
                show_10371617({
                    type: 'inApp',
                    inAppSettings: {
                        frequency: 2,
                        capping: 0.1,
                        interval: 30,
                        timeout: 5,
                        everyPage: false
                    }
                });
            }
        }

        // --- UYGULAMA BAŞLATICI ---
        window.onload = () => {
            // Kullanıcı Bilgileri
            document.getElementById('user-display-name').innerText = userName;
            document.getElementById('profile-name').innerText = userName;

            // Admin Kontrolü (Sadece 8392479231 ID'si için)
            if (ADMIN_IDS.includes(userId)) {
                document.getElementById('nav-admin-btn').style.display = 'flex';
            }

            // Reklamları ve Arayüzü Başlat
            initAutoAds();
            setTimeout(() => {
                document.getElementById('page-loader').style.display = 'none';
            }, 800);

            tg.expand();
        };

        function toggleSidebar(show) {
            document.getElementById('sidebar').classList.toggle('open', show);
            document.getElementById('sb-overlay').style.display = show ? 'block' : 'none';
        }
    </script>
</body>
</html>

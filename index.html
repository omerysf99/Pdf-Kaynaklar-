<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SpyderCoin - Web Edition</title>
    
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>

    <style>
        :root {
            --bg: #070708;
            --purple: #a855f7;
            --purple-glow: rgba(168, 85, 247, 0.4);
            --card: #141416;
            --text: #ffffff;
            --inactive: #8e8e93;
            --green: #10b981;
            --red: #ef4444;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; }
        body { background: var(--bg); color: var(--text); font-family: -apple-system, sans-serif; margin: 0; padding: 0; height: 100vh; overflow: hidden; display: flex; flex-direction: column; }

        .page { display: none; height: 100%; width: 100%; flex-direction: column; align-items: center; padding: 20px; overflow-y: auto; padding-bottom: 140px; }
        .page.active { display: flex; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* ğŸ•·ï¸ ANA EKRAN */
        .bal-display { font-size: 68px; font-weight: 900; margin: 10px 0; text-shadow: 0 0 20px var(--purple-glow); }
        .tap-area { flex-grow: 1; display: flex; justify-content: center; align-items: center; position: relative; width: 100%; }
        .spider-main { width: 250px; height: 250px; background: var(--purple); border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 120px; box-shadow: 0 0 60px var(--purple-glow); z-index: 5; transition: transform 0.05s; cursor: pointer; }
        .spider-main:active { transform: scale(0.92); }

        /* ğŸ•¸ï¸ AÄ ANÄ°MASYONU */
        .web-ring { position: absolute; border: 2px solid white; border-radius: 50%; pointer-events: none; animation: webExpand 0.5s ease-out forwards; }
        @keyframes webExpand { 0% { width: 0; height: 0; opacity: 1; } 100% { width: 450px; height: 450px; opacity: 0; } }
        
        .plus-one { position: absolute; color: white; font-weight: bold; font-size: 28px; pointer-events: none; animation: floatUp 0.7s ease-out forwards; z-index: 10; }
        @keyframes floatUp { 0% { opacity: 1; transform: translateY(0); } 100% { opacity: 0; transform: translateY(-100px); } }

        /* ğŸ”‹ ENERJÄ° */
        .energy-box { width: 100%; max-width: 400px; margin-bottom: 10px; }
        .bar-bg { width: 100%; height: 12px; background: #1c1c1e; border-radius: 10px; overflow: hidden; margin-top: 5px; }
        #energy-fill { height: 100%; width: 100%; background: var(--purple); transition: width 0.3s; }

        /* ğŸ’° CÃœZDAN & ÅARTLAR */
        .wallet-card { background: var(--card); border-radius: 20px; padding: 25px; width: 100%; border: 1px solid #232326; margin-top: 20px; }
        .condition-box { background: rgba(255, 255, 255, 0.03); border: 1px solid #2c2c2e; padding: 15px; border-radius: 12px; margin-bottom: 15px; }
        .condition-item { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 14px; }
        .status-tag { padding: 2px 8px; border-radius: 5px; font-size: 10px; font-weight: bold; }
        .status-wait { background: var(--red); color: white; }
        .status-ok { background: var(--green); color: white; }

        .btn-withdraw { background: var(--purple); color: #fff; border: none; width: 100%; padding: 18px; border-radius: 15px; font-weight: 900; cursor: pointer; transition: 0.3s; }
        .btn-withdraw:disabled { background: #27272a; color: #555; cursor: not-allowed; }

        input { width: 100%; background: #000; border: 1px solid #2c2c2e; padding: 15px; border-radius: 12px; color: #fff; margin-bottom: 20px; text-align: center; }

        /* ğŸ“± NAV */
        .nav-bar { position: fixed; bottom: 0; width: 100%; background: #0a0a0b; display: grid; grid-template-columns: repeat(4, 1fr); padding: 15px 0 35px; border-top: 1px solid #1c1c1e; z-index: 1000; }
        .nav-item { display: flex; flex-direction: column; align-items: center; color: var(--inactive); font-size: 11px; cursor: pointer; transition: 0.2s; }
        .nav-item.active { color: var(--purple); }
    </style>
</head>
<body>

    <div id="p-home" class="page active">
        <div style="text-align:center; margin-top:20px;">
            <div style="color:var(--inactive); font-size:12px; letter-spacing:1px;">SPYDER BALANCE</div>
            <div class="bal-display" id="ui-bal">0</div>
        </div>
        <div class="tap-area">
            <div class="spider-main" id="spider-btn">ğŸ•·ï¸</div>
        </div>
        <div class="energy-box">
            <div style="font-size:13px; color:var(--inactive);">âš¡ Energy: <span id="ui-nrg">1000</span> / 1000</div>
            <div class="bar-bg"><div id="energy-fill"></div></div>
        </div>
    </div>

    <div id="p-tasks" class="page">
        <h2 style="color:var(--purple); align-self:flex-start;">GÃ¶revler</h2>
        <div class="wallet-card" style="display:flex; justify-content:space-between; align-items:center;">
            <div><b>Telegram KanalÄ±</b><br><span style="color:var(--purple); font-size:14px;">+5,000 SPYDER</span></div>
            <button class="btn-withdraw" style="width:auto; padding:10px 20px;" onclick="tg.openTelegramLink('https://t.me/SpyderCommunity')">KatÄ±l</button>
        </div>
        </div>

    <div id="p-friends" class="page">
        <h2 style="color:var(--purple); align-self:flex-start;">Dostlar</h2>
        <div class="wallet-card" style="text-align:center;">
            <p style="color:var(--inactive)">ArkadaÅŸlarÄ±nÄ± aÄŸa davet et, her dokunuÅŸlarÄ±ndan %10 komisyon kazan!</p>
            <button class="btn-withdraw" style="background:#fff; color:#000;">DAVET LÄ°NKÄ°NÄ° KOPYALA</button>
        </div>
    </div>

    <div id="p-wallet" class="page">
        <h2 style="color:var(--purple); align-self:flex-start;">CÃ¼zdan</h2>
        
        <div style="text-align:center; margin:30px 0;">
            <div id="ui-usdt" style="font-size:48px; font-weight:900; color:var(--green);">$0.00</div>
            <div style="color:var(--inactive); font-size:12px;">Tahmini DeÄŸer (USDT)</div>
        </div>

        <div class="wallet-card">
            <div class="condition-box">
                <div style="font-size:12px; color:var(--inactive); margin-bottom:10px; font-weight:bold;">Ã‡EKÄ°M ÅARTLARI</div>
                <div class="condition-item">
                    <span>Minimum Bakiye (0.01$)</span>
                    <span id="cond-bal" class="status-tag status-wait">Bekliyor</span>
                </div>
                <div class="condition-item">
                    <span>Reklam Ä°zleme (20 Adet)</span>
                    <span id="cond-ads" class="status-tag status-wait">0 / 20</span>
                </div>
            </div>

            <label style="font-size:11px; color:var(--inactive); display:block; margin-bottom:8px; padding-left:5px;">USDT BEP20 CÃœZDAN ADRESÄ°</label>
            <input type="text" id="wallet-addr" placeholder="0x...">
            
            <button id="btn-withdraw" class="btn-withdraw" onclick="requestPayout()" disabled>Ã–DEME TALEBÄ° GÃ–NDER</button>
            <p style="text-align:center; font-size:10px; color:#444; margin-top:15px;">Talepler 24 saat iÃ§erisinde manuel incelenir.</p>
        </div>
    </div>

    <nav class="nav-bar">
        <div class="nav-item active" onclick="nav('p-home', this)"><span>ğŸ®</span><br>Oyna</div>
        <div class="nav-item" onclick="nav('p-tasks', this)"><span>ğŸ“‹</span><br>GÃ¶rev</div>
        <div class="nav-item" onclick="nav('p-friends', this)"><span>ğŸ‘¥</span><br>Dost</div>
        <div class="nav-item" onclick="nav('p-wallet', this)"><span>ğŸ’°</span><br>CÃ¼zdan</div>
    </nav>

    <script>
        // --- FIREBASE BAÄLANTISI ---
        const firebaseConfig = { apiKey: "AIzaSy...", projectId: "spyder-coin" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        const tg = window.Telegram.WebApp;
        const user = tg.initDataUnsafe?.user || { id: "8392479231", first_name: "Admin" };

        let state = {
            bal: 0,
            nrg: 1000,
            ads: 0 // Reklam izleme sayÄ±sÄ± (VeritabanÄ±ndan gelecek)
        };

        async function init() {
            tg.ready(); tg.expand();
            
            const doc = await db.collection('users').doc(String(user.id)).get();
            if (doc.exists) {
                state = { ...state, ...doc.data() };
            } else {
                await db.collection('users').doc(String(user.id)).set(state);
            }
            updateUI();
            setInterval(regen, 1000); // Saniyede 1 enerji dolar
            setInterval(sync, 10000); // 10 saniyede bir buluta kaydet
        }

        // --- ğŸ•·ï¸ TAP SÄ°STEMÄ° (Her dokunuÅŸ +1) ---
        function handleTap(e) {
            if (state.nrg <= 0) {
                tg.HapticFeedback.notificationOccurred('error');
                return;
            }

            state.bal += 1; // +1 Coin artÄ±ÅŸÄ±
            state.nrg -= 1;
            updateUI();
            
            // GÃ¶rsel Efektler
            const ring = document.createElement('div');
            ring.className = 'web-ring';
            document.querySelector('.tap-area').appendChild(ring);
            setTimeout(() => ring.remove(), 500);

            const touch = e.touches ? e.touches[0] : e;
            const plus = document.createElement('div');
            plus.className = 'plus-one';
            plus.innerText = '+1';
            plus.style.left = touch.pageX + 'px';
            plus.style.top = touch.pageY + 'px';
            document.body.appendChild(plus);
            setTimeout(() => plus.remove(), 700);

            tg.HapticFeedback.impactOccurred('light');
        }

        function updateUI() {
            document.getElementById('ui-bal').innerText = state.bal.toLocaleString();
            document.getElementById('ui-nrg').innerText = state.nrg;
            document.getElementById('energy-fill').style.width = (state.nrg / 10) + "%";
            
            // USDT Hesaplama (1,000 Spyder = 0.01$)
            const usdtVal = (state.bal * 0.00001).toFixed(3);
            document.getElementById('ui-usdt').innerText = "$" + usdtVal;

            // --- ğŸ’° Ã‡EKÄ°M ÅART KONTROLÃœ ---
            const btn = document.getElementById('btn-withdraw');
            const condBal = document.getElementById('cond-bal');
            const condAds = document.getElementById('cond-ads');

            // Bakiye ÅŸartÄ± (1000 coin = 0.01$)
            if (state.bal >= 1000) {
                condBal.innerText = "TamamlandÄ±";
                condBal.className = "status-tag status-ok";
            } else {
                condBal.innerText = "Bekliyor";
                condBal.className = "status-tag status-wait";
            }

            // Reklam ÅŸartÄ±
            condAds.innerText = `${state.ads} / 20`;
            if (state.ads >= 20) {
                condAds.className = "status-tag status-ok";
            } else {
                condAds.className = "status-tag status-wait";
            }

            // Buton Aktif Etme
            if (state.bal >= 1000 && state.ads >= 20) {
                btn.disabled = false;
                btn.style.boxShadow = "0 0 20px var(--purple-glow)";
            } else {
                btn.disabled = true;
                btn.style.boxShadow = "none";
            }
        }

        function requestPayout() {
            const addr = document.getElementById('wallet-addr').value;
            if(!addr.startsWith("0x") || addr.length < 20) {
                return tg.showAlert("LÃ¼tfen geÃ§erli bir USDT BEP20 adresi giriniz!");
            }
            
            tg.showConfirm(`0.01$ tutarÄ±ndaki talebiniz onaylansÄ±n mÄ±?\nCÃ¼zdan: ${addr.substring(0,6)}...`, (ok) => {
                if(ok) {
                    state.bal -= 1000;
                    state.ads = 0; // Ã‡ekim sonrasÄ± ÅŸart sÄ±fÄ±rlanÄ±r
                    sync();
                    updateUI();
                    tg.showAlert("Ã–deme talebiniz sÄ±raya alÄ±ndÄ±! Reklam ÅŸartÄ±nÄ±z bir sonraki Ã§ekim iÃ§in sÄ±fÄ±rlandÄ±.");
                }
            });
        }

        function regen() { if(state.nrg < 1000) { state.nrg++; updateUI(); } }
        async function sync() { await db.collection('users').doc(String(user.id)).update(state); }
        
        function nav(id, el) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            el.classList.add('active');
        }

        document.getElementById('spider-btn').addEventListener('touchstart', (e) => {
            e.preventDefault();
            handleTap(e);
        });

        init();
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Clone Pro | Admin 8392479231</title>
    <style>
        /* --- CSS: MODERN DARK THEME & UX --- */
        :root {
            --bg: #0f0f0f;
            --surface: #0f0f0f;
            --surface-hover: #272727;
            --text: #ffffff;
            --secondary-text: #aaaaaa;
            --yt-red: #ff0000;
            --accent: #3ea6ff;
            --border: #333333;
        }

        body {
            font-family: "Roboto", sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            overflow: hidden; /* Header ve Nav dƒ±≈üƒ±nda kaydƒ±rmayƒ± biz y√∂neteceƒüiz */
        }

        /* Layout */
        header {
            position: fixed; top: 0; width: 100%; height: 56px;
            background: var(--bg); display: flex; justify-content: space-between;
            align-items: center; padding: 0 16px; z-index: 2000; box-sizing: border-box;
        }

        aside {
            position: fixed; top: 56px; left: 0; width: 240px; height: calc(100vh - 56px);
            background: var(--bg); padding-top: 12px; z-index: 1000;
        }

        main {
            margin-top: 56px; margin-left: 240px; height: calc(100vh - 56px);
            overflow-y: auto; padding: 20px; box-sizing: border-box;
            scroll-behavior: smooth;
        }

        /* Sidebar Elements */
        .nav-link {
            padding: 10px 24px; display: flex; align-items: center; gap: 24px;
            cursor: pointer; border-radius: 10px; margin: 0 12px; transition: 0.2s;
        }
        .nav-link:hover, .nav-link.active { background: var(--surface-hover); }

        /* --- SHORTS SECTION (SNAP SCROLLING) --- */
        #shortsView {
            display: none; height: calc(100vh - 56px);
            overflow-y: scroll; scroll-snap-type: y mandatory;
            background: #000; position: relative;
        }

        .short-container {
            height: calc(100vh - 56px); width: 100%;
            display: flex; justify-content: center; align-items: center;
            scroll-snap-align: start; position: relative;
        }

        .short-video-wrapper {
            height: 95%; aspect-ratio: 9/16; background: #111;
            border-radius: 15px; overflow: hidden; position: relative;
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
        }

        .short-video-wrapper video { width: 100%; height: 100%; object-fit: cover; }

        .short-info {
            position: absolute; bottom: 20px; left: 20px; right: 20px;
            z-index: 10; text-shadow: 0 2px 4px rgba(0,0,0,0.8);
        }

        /* --- LONG VIDEO GRID --- */
        .video-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 16px; row-gap: 32px;
        }
        .v-card { cursor: pointer; transition: 0.2s; }
        .v-thumb { width: 100%; aspect-ratio: 16/9; border-radius: 12px; background: #222; overflow: hidden; }
        .v-thumb img { width: 100%; height: 100%; object-fit: cover; }
        .v-meta { display: flex; gap: 12px; margin-top: 12px; }
        .v-pfp { width: 36px; height: 36px; border-radius: 50%; background: #444; }

        /* --- UPLOAD UI --- */
        .upload-modal {
            background: #1e1e1e; border-radius: 12px; padding: 25px;
            max-width: 500px; margin: 20px auto; border: 1px solid #333;
        }
        .btn-up { 
            background: var(--accent); color: #000; border: none; padding: 10px 20px; 
            border-radius: 20px; font-weight: bold; cursor: pointer; width: 100%; margin-top: 10px;
        }
        input, textarea {
            width: 100%; background: #121212; border: 1px solid #333; color: #fff;
            padding: 10px; border-radius: 8px; margin-bottom: 10px; box-sizing: border-box;
        }

        /* Progress Bar for Shorts */
        .shorts-progress {
            position: absolute; top: 0; left: 0; height: 3px; background: var(--yt-red);
            width: 0%; z-index: 100; transition: width 0.1s linear;
        }

        /* Responsive */
        @media (max-width: 800px) {
            aside { display: none; }
            main { margin-left: 0; padding-bottom: 80px; }
            #shortsView { width: 100vw; }
        }
    </style>
</head>
<body>

<header>
    <div style="display:flex; align-items:center; gap:20px;">
        <span style="cursor:pointer; font-size:24px;">‚ò∞</span>
        <div style="color:red; font-weight:bold; font-size:22px; cursor:pointer;" onclick="showView('home')">YouTube</div>
    </div>
    <div style="font-size: 12px; color: var(--secondary-text)">Admin: 8392479231</div>
    <div style="display:flex; gap:15px; align-items:center;">
        <button class="btn-up" style="width:auto; margin:0;" onclick="showView('upload')">+ Olu≈ütur</button>
        <div class="v-pfp" style="width:32px; height:32px;"></div>
    </div>
</header>

<aside>
    <div class="nav-link active" id="btn-home" onclick="showView('home')">üè† Ana Sayfa</div>
    <div class="nav-link" id="btn-shorts" onclick="showView('shorts')">ü©≥ Shorts</div>
    <hr style="border:0; border-top:1px solid #333; margin:10px 0;">
    <div class="nav-link">üì∫ Abonelikler</div>
    <div class="nav-link">üïí Ge√ßmi≈ü</div>
</aside>

<main id="homeView">
    <h2 style="margin-bottom:20px;">Videolar</h2>
    <div class="video-grid" id="mainGrid">
        </div>
</main>

<div id="shortsView">
    </div>

<main id="uploadView" style="display:none;">
    <div class="upload-modal">
        <h2 style="margin-top:0">Video Y√ºkle</h2>
        <label>Video Se√ß (MP4/WebM):</label>
        <input type="file" id="vInp" accept="video/*">
        <label>Thumbnail Se√ß (JPG/PNG):</label>
        <input type="file" id="tInp" accept="image/*">
        <input type="text" id="vTitle" placeholder="Video Ba≈ülƒ±ƒüƒ±">
        <textarea id="vDesc" rows="4" placeholder="A√ßƒ±klama..."></textarea>
        <button class="btn-up" onclick="handleUpload()">YAYINLA</button>
        <p id="upStatus" style="font-size:12px; color:var(--accent); text-align:center;"></p>
    </div>
</main>

<script>
    /* --- JS: ENGINE & STORAGE --- */
    const DB_NAME = 'YT_Cenneti_DB';
    let db;

    // 1. IndexedDB Ba≈ülatma (Kalƒ±cƒ± Veri)
    const request = indexedDB.open(DB_NAME, 1);
    request.onupgradeneeded = (e) => {
        db = e.target.result;
        db.createObjectStore('videos', { keyPath: 'id' });
    };
    request.onsuccess = (e) => {
        db = e.target.result;
        refreshData();
    };

    // 2. G√∂r√ºn√ºm Deƒüi≈ütirme (SPA Mantƒ±ƒüƒ±)
    function showView(view) {
        document.getElementById('homeView').style.display = 'none';
        document.getElementById('shortsView').style.display = 'none';
        document.getElementById('uploadView').style.display = 'none';
        document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));

        stopAllVideos();

        if(view === 'home') {
            document.getElementById('homeView').style.display = 'block';
            document.getElementById('btn-home').classList.add('active');
            refreshData();
        } else if(view === 'shorts') {
            document.getElementById('shortsView').style.display = 'block';
            document.getElementById('btn-shorts').classList.add('active');
            refreshData();
        } else {
            document.getElementById('uploadView').style.display = 'block';
        }
    }

    // 3. Video Y√ºkleme ve S√ºre Analizi
    async function handleUpload() {
        const vFile = document.getElementById('vInp').files[0];
        const tFile = document.getElementById('tInp').files[0];
        const title = document.getElementById('vTitle').value;
        const desc = document.getElementById('vDesc').value;
        const status = document.getElementById('upStatus');

        if(!vFile || !tFile || !title) return alert("Eksik bilgi!");

        status.textContent = "Analiz ediliyor...";
        const duration = await getVideoDuration(vFile);
        
        const videoObj = {
            id: crypto.randomUUID(),
            title: title,
            desc: desc,
            vBlob: vFile,
            tBlob: tFile,
            isShorts: duration <= 60,
            ts: Date.now()
        };

        const tx = db.transaction('videos', 'readwrite');
        tx.objectStore('videos').add(videoObj);
        tx.oncomplete = () => {
            status.textContent = "Ba≈üarƒ±yla y√ºklendi!";
            setTimeout(() => showView('home'), 1000);
        };
    }

    function getVideoDuration(file) {
        return new Promise(r => {
            const v = document.createElement('video');
            v.src = URL.createObjectURL(file);
            v.onloadedmetadata = () => { URL.revokeObjectURL(v.src); r(v.duration); };
        });
    }

    // 4. Verileri Aray√ºze Basma
    let activeURLs = [];
    function refreshData() {
        const mg = document.getElementById('mainGrid');
        const sg = document.getElementById('shortsView');
        mg.innerHTML = ''; sg.innerHTML = '';
        activeURLs.forEach(u => URL.revokeObjectURL(u));
        activeURLs = [];

        const tx = db.transaction('videos', 'readonly');
        tx.objectStore('videos').getAll().onsuccess = (e) => {
            const videos = e.target.result.sort((a,b) => b.ts - a.ts);

            videos.forEach((vid, index) => {
                const vUrl = URL.createObjectURL(vid.vBlob);
                const tUrl = URL.createObjectURL(vid.tBlob);
                activeURLs.push(vUrl, tUrl);

                if(vid.isShorts) {
                    // SHORTS RENDER
                    const container = document.createElement('div');
                    container.className = 'short-container';
                    container.innerHTML = `
                        <div class="short-video-wrapper">
                            <div class="shorts-progress" id="progress-${vid.id}"></div>
                            <video src="${vUrl}" loop playsinline data-id="${vid.id}"></video>
                            <div class="short-info">
                                <h3 style="margin:0">${vid.title}</h3>
                                <p style="font-size:14px; color:#ddd">@admin_8392479231</p>
                            </div>
                        </div>
                    `;
                    sg.appendChild(container);
                } else {
                    // LONG VIDEO RENDER
                    const card = document.createElement('div');
                    card.className = 'v-card';
                    card.innerHTML = `
                        <div class="v-thumb"><img src="${tUrl}"></div>
                        <div class="v-meta">
                            <div class="v-pfp"></div>
                            <div class="v-text">
                                <h4 style="margin:0">${vid.title}</h4>
                                <p style="font-size:12px; color:var(--secondary-text)">Admin ‚Ä¢ 999B ƒ∞zlenme</p>
                            </div>
                        </div>
                    `;
                    card.onclick = () => {
                        const win = window.open();
                        win.document.write(`<body style="background:#000;margin:0;display:flex;align-items:center;justify-content:center;"><video src="${vUrl}" controls autoplay style="max-width:100%;max-height:100vh;"></video></body>`);
                    };
                    mg.appendChild(card);
                }
            });
            
            if(document.getElementById('shortsView').style.display === 'block') {
                handleShortsAutoplay();
            }
        };
    }

    // 5. SHORTS AUTOPLAY & SCROLL LOGIC (Video Kaydƒ±rma Cenneti)
    const shortsView = document.getElementById('shortsView');
    shortsView.addEventListener('scroll', handleShortsAutoplay);

    function handleShortsAutoplay() {
        const videos = shortsView.querySelectorAll('video');
        const viewHeight = shortsView.clientHeight;

        videos.forEach(v => {
            const rect = v.getBoundingClientRect();
            const progress = document.getElementById(`progress-${v.dataset.id}`);

            // Eƒüer video ekranƒ±n ortasƒ±ndaysa oynat
            if(rect.top >= -100 && rect.bottom <= viewHeight + 100) {
                if(v.paused) v.play();
                
                // Progress Bar G√ºncelleme
                v.ontimeupdate = () => {
                    const perc = (v.currentTime / v.duration) * 100;
                    if(progress) progress.style.width = perc + "%";
                };
            } else {
                v.pause();
                v.currentTime = 0;
            }
        });
    }

    function stopAllVideos() {
        document.querySelectorAll('video').forEach(v => v.pause());
    }

    // Sonsuz D√∂ng√º (Scroll Check)
    shortsView.addEventListener('scroll', () => {
        if (shortsView.scrollTop + shortsView.clientHeight >= shortsView.scrollHeight - 5) {
            // Son videoya gelindiƒüinde ba≈üa d√∂n (isteƒüe baƒülƒ±)
            // shortsView.scrollTo({top: 0, behavior: 'smooth'});
        }
    });

</script>
</body>
</html>

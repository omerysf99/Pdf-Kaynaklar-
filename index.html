<!DOCTYPE html>
<html lang="tr" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NexTube Pro | Smart Thumbnail System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap');
        
        :root {
            --accent: #ff0000;
            --bg-main: #0a0a0a;
            --glass: rgba(255, 255, 255, 0.03);
            --glass-border: rgba(255, 255, 255, 0.08);
        }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: var(--bg-main);
            color: #eeeeee;
            overflow: hidden;
        }

        /* --- UI HELPERS --- */
        .glass-header { background: rgba(10, 10, 10, 0.8); backdrop-filter: blur(16px); border-bottom: 1px solid var(--glass-border); }
        .sidebar-item.active { background: var(--glass); color: #fff; border-left: 4px solid var(--accent); }
        
        .thumb-preview {
            width: 100%;
            aspect-ratio: 16/9;
            border-radius: 16px;
            object-fit: cover;
            background: #1a1a1a;
            border: 2px dashed rgba(255,255,255,0.1);
        }

        /* SHORTS SNAP SCROLLING */
        .shorts-container { height: calc(100vh - 64px); scroll-snap-type: y mandatory; overflow-y: scroll; scrollbar-width: none; }
        .shorts-container::-webkit-scrollbar { display: none; }
        .short-slide { height: calc(100vh - 64px); scroll-snap-align: start; position: relative; background: #000; display: flex; justify-content: center; }
        .short-box { height: 98%; margin-top: 1%; aspect-ratio: 9/16; border-radius: 24px; overflow: hidden; position: relative; }

        .fade-in { animation: fadeIn 0.4s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body class="antialiased">

    <header class="h-16 fixed top-0 w-full glass-header flex items-center justify-between px-6 z-[100]">
        <div class="flex items-center gap-4">
            <div class="flex items-center gap-2 cursor-pointer" onclick="ui.showPage('home')">
                <div class="bg-red-600 p-1.5 rounded-xl"><i data-lucide="play" class="fill-white text-white w-5 h-5"></i></div>
                <span class="text-xl font-extrabold tracking-tight">NexTube</span>
            </div>
        </div>
        <div class="flex items-center gap-3">
            <button onclick="ui.toggleModal('upload', true)" class="bg-white text-black px-5 py-2 rounded-2xl font-bold flex items-center gap-2 hover:bg-gray-200 transition">
                <i data-lucide="plus" class="w-5 h-5"></i> <span>Yükle</span>
            </button>
            <div class="w-10 h-10 rounded-2xl bg-gradient-to-tr from-orange-500 to-red-600 border border-white/10 flex items-center justify-center text-[10px] font-bold">AD</div>
        </div>
    </header>

    <div class="flex pt-16 h-screen">
        <aside class="w-64 hidden lg:flex flex-col p-4 border-r border-white/5 bg-[#0a0a0a]">
            <button onclick="ui.showPage('home')" data-nav="home" class="sidebar-item active flex items-center gap-4 p-3.5 rounded-2xl text-sm font-semibold mb-1"><i data-lucide="home"></i> Ana Sayfa</button>
            <button onclick="ui.showPage('shorts')" data-nav="shorts" class="sidebar-item flex items-center gap-4 p-3.5 rounded-2xl text-sm font-semibold text-gray-400 mb-1"><i data-lucide="zap"></i> Shorts</button>
            <div class="mt-auto p-4 bg-white/5 rounded-2xl">
                <p class="text-[10px] text-gray-500 font-bold uppercase">Admin Access</p>
                <p class="text-xs font-mono text-red-500">8392479231</p>
            </div>
        </aside>

        <main class="flex-1 overflow-hidden relative bg-[#050505]">
            <section id="view-home" class="h-full overflow-y-auto p-8 fade-in">
                <div class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4 gap-8" id="video-grid">
                    </div>
            </section>

            <section id="view-shorts" class="hidden h-full bg-black">
                <div id="shorts-flow" class="shorts-container"></div>
            </section>

            <section id="view-watch" class="hidden h-full overflow-y-auto p-8 fade-in">
                <div class="max-w-5xl mx-auto">
                    <div class="aspect-video bg-black rounded-[32px] overflow-hidden border border-white/5">
                        <video id="main-player" controls autoplay class="w-full h-full"></video>
                    </div>
                    <div class="mt-8">
                        <h1 id="watch-title" class="text-3xl font-black">Video Başlığı</h1>
                        <p id="watch-desc" class="mt-4 text-gray-400 leading-relaxed bg-white/5 p-6 rounded-2xl border border-white/5"></p>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <div id="upload-modal" class="fixed inset-0 z-[200] hidden items-center justify-center bg-black/95 backdrop-blur-xl p-6">
        <div class="w-full max-w-2xl bg-[#121212] rounded-[40px] border border-white/10 p-10 shadow-2xl overflow-y-auto max-h-[90vh]">
            <div class="flex justify-between items-center mb-8">
                <h2 class="text-3xl font-black">Video & Kapak Paylaş</h2>
                <button onclick="ui.toggleModal('upload', false)" class="p-3 hover:bg-white/5 rounded-2xl transition"><i data-lucide="x"></i></button>
            </div>
            
            <div class="grid md:grid-cols-2 gap-8">
                <div class="space-y-6">
                    <div class="relative group">
                        <input type="file" id="file-in" class="hidden" accept="video/*" onchange="app.handleVideoSelect(this)">
                        <div onclick="document.getElementById('file-in').click()" class="border-2 border-dashed border-white/10 rounded-3xl p-8 text-center hover:border-red-500/50 transition cursor-pointer bg-white/[0.02]">
                            <i data-lucide="video" class="w-10 h-10 mx-auto mb-3 text-gray-500"></i>
                            <p id="file-label" class="text-sm font-bold">Video Seç</p>
                        </div>
                    </div>

                    <div class="space-y-2">
                        <label class="text-xs font-bold text-gray-500 uppercase ml-2">Manuel Kapak (Opsiyonel)</label>
                        <input type="file" id="thumb-in" class="hidden" accept="image/*" onchange="app.handleThumbSelect(this)">
                        <div onclick="document.getElementById('thumb-in').click()" class="border-2 border-dashed border-white/10 rounded-3xl p-4 text-center hover:border-blue-500/50 transition cursor-pointer bg-white/[0.02] flex items-center justify-center gap-3">
                            <i data-lucide="image" class="w-5 h-5 text-gray-500"></i>
                            <span class="text-xs font-bold">Resim Yükle</span>
                        </div>
                    </div>
                </div>

                <div class="space-y-4">
                    <div class="relative">
                        <img id="preview-img" src="" class="thumb-preview">
                        <div id="preview-overlay" class="absolute inset-0 flex items-center justify-center bg-black/60 rounded-2xl hidden">
                            <span class="text-[10px] font-bold text-white uppercase tracking-widest animate-pulse">Otomatik Oluşturuluyor...</span>
                        </div>
                    </div>
                    <input type="text" id="up-title" placeholder="Video Başlığı" class="w-full bg-white/5 border border-white/10 rounded-xl p-4 outline-none focus:border-red-500 transition">
                    <textarea id="up-desc" placeholder="Açıklama" rows="2" class="w-full bg-white/5 border border-white/10 rounded-xl p-4 outline-none focus:border-red-500 transition resize-none"></textarea>
                </div>
            </div>

            <button onclick="app.upload()" id="publish-btn" class="w-full mt-8 py-5 bg-red-600 rounded-[24px] font-black text-lg hover:bg-red-700 transition shadow-xl shadow-red-600/20">VİDEOYU YAYINLA</button>
        </div>
    </div>

    <canvas id="thumb-canvas" class="hidden"></canvas>
    <video id="temp-video-loader" class="hidden" muted></video>

    <script>
        const app = {
            videos: [], activeVideo: null, manualThumb: null, autoThumb: null,

            handleVideoSelect(input) {
                const file = input.files[0];
                if(!file) return;
                document.getElementById('file-label').innerText = file.name;
                
                // Manuel thumbnail yoksa otomatik oluşturmayı tetikle
                if(!this.manualThumb) {
                    this.generateAutoThumbnail(file);
                }
            },

            handleThumbSelect(input) {
                const file = input.files[0];
                if(!file) return;
                this.manualThumb = URL.createObjectURL(file);
                document.getElementById('preview-img').src = this.manualThumb;
                document.getElementById('preview-overlay').classList.add('hidden');
            },

            generateAutoThumbnail(file) {
                const video = document.getElementById('temp-video-loader');
                const canvas = document.getElementById('thumb-canvas');
                const overlay = document.getElementById('preview-overlay');
                const preview = document.getElementById('preview-img');

                overlay.classList.remove('hidden');
                const url = URL.createObjectURL(file);
                video.src = url;

                video.onloadedmetadata = () => {
                    // Videonun 1. saniyesine git (Siyah ekranı geçmek için)
                    video.currentTime = Math.min(1, video.duration);
                };

                video.onseeked = () => {
                    const ctx = canvas.getContext('2d');
                    canvas.width = 640;
                    canvas.height = 360;
                    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
                    
                    this.autoThumb = canvas.toDataURL('image/jpeg', 0.8);
                    
                    // Eğer kullanıcı hala manuel yüklemediyse önizlemeyi güncelle
                    if(!this.manualThumb) {
                        preview.src = this.autoThumb;
                    }
                    overlay.classList.add('hidden');
                };
            },

            async upload() {
                const file = document.getElementById('file-in').files[0];
                const title = document.getElementById('up-title').value;
                const desc = document.getElementById('up-desc').value;

                if(!file || !title) return alert("Dosya ve başlık zorunludur!");

                const btn = document.getElementById('publish-btn');
                btn.innerText = "Yayınlanıyor...";
                btn.disabled = true;

                const videoUrl = URL.createObjectURL(file);
                const finalThumb = this.manualThumb || this.autoThumb || 'https://picsum.photos/seed/tube/640/360';

                // Video Süresini Al ve Kaydet
                const tempV = document.createElement('video');
                tempV.src = videoUrl;
                tempV.onloadedmetadata = () => {
                    const item = {
                        id: Date.now(),
                        title, desc,
                        url: videoUrl,
                        thumb: finalThumb,
                        duration: tempV.duration,
                        type: tempV.duration <= 60 ? 'short' : 'long',
                        likes: 0, comments: []
                    };

                    this.videos.unshift(item);
                    ui.renderAll();
                    ui.toggleModal('upload', false);
                    this.reset();
                    btn.innerText = "VİDEOYU YAYINLA";
                    btn.disabled = false;
                };
            },

            reset() {
                document.getElementById('up-title').value = '';
                document.getElementById('up-desc').value = '';
                document.getElementById('file-in').value = '';
                document.getElementById('thumb-in').value = '';
                document.getElementById('preview-img').src = '';
                document.getElementById('file-label').innerText = "Video Seç";
                this.manualThumb = null;
                this.autoThumb = null;
            }
        };

        const ui = {
            showPage(page) {
                ['view-home', 'view-shorts', 'view-watch'].forEach(id => document.getElementById(id).classList.add('hidden'));
                document.getElementById('view-' + page).classList.remove('hidden');
                
                document.querySelectorAll('.sidebar-item').forEach(b => b.classList.remove('active'));
                const nav = document.querySelector(`[data-nav="${page}"]`);
                if(nav) nav.classList.add('active');

                if(page !== 'shorts') document.querySelectorAll('.short-vid').forEach(v => v.pause());
                else this.initShorts();
            },

            renderAll() {
                this.renderGrid();
                this.renderShorts();
                lucide.createIcons();
            },

            renderGrid() {
                const grid = document.getElementById('video-grid');
                const longs = app.videos.filter(v => v.type === 'long');
                
                if(longs.length === 0) {
                    grid.innerHTML = `<div class="col-span-full py-20 text-center text-gray-600">Henüz uzun video yok.</div>`;
                    return;
                }

                grid.innerHTML = longs.map(v => `
                    <div class="group cursor-pointer" onclick="ui.watchVideo(${v.id})">
                        <div class="relative aspect-video rounded-3xl overflow-hidden bg-zinc-900 border border-white/5">
                            <img src="${v.thumb}" class="w-full h-full object-cover group-hover:scale-105 transition duration-500">
                            <div class="absolute inset-0 bg-black/20 group-hover:bg-black/0 transition-colors"></div>
                            <span class="absolute bottom-3 right-3 bg-black/80 px-2 py-1 rounded-lg text-[10px] font-bold border border-white/10">${Math.floor(v.duration)} sn</span>
                        </div>
                        <div class="mt-4 flex gap-3">
                            <div class="w-10 h-10 rounded-2xl bg-gradient-to-tr from-red-600 to-indigo-600 flex-shrink-0"></div>
                            <div>
                                <h3 class="font-bold text-sm line-clamp-2">${v.title}</h3>
                                <p class="text-xs text-gray-500 mt-1">Admin • 0 izlenme</p>
                            </div>
                        </div>
                    </div>
                `).join('');
            },

            renderShorts() {
                const flow = document.getElementById('shorts-flow');
                const shorts = app.videos.filter(v => v.type === 'short');
                
                if(shorts.length === 0) {
                    flow.innerHTML = `<div class="h-full flex items-center justify-center text-gray-600 italic">Shorts içeriği yok.</div>`;
                    return;
                }

                flow.innerHTML = shorts.map(s => `
                    <div class="short-slide" data-id="${s.id}">
                        <div class="short-box">
                            <video src="${s.url}" loop class="short-vid w-full h-full object-cover"></video>
                            <div class="absolute bottom-0 left-0 p-8 w-full bg-gradient-to-t from-black/80 to-transparent">
                                <h3 class="font-extrabold text-sm mb-2">${s.title}</h3>
                                <div class="flex items-center gap-3">
                                    <div class="w-8 h-8 rounded-full bg-red-600"></div>
                                    <span class="text-xs font-bold">@admin_8392479231</span>
                                </div>
                            </div>
                        </div>
                    </div>
                `).join('');
                this.initShorts();
            },

            initShorts() {
                const obs = new IntersectionObserver((entries) => {
                    entries.forEach(e => {
                        const vid = e.target.querySelector('video');
                        if(e.isIntersecting) vid.play();
                        else vid.pause();
                    });
                }, { threshold: 0.8 });
                document.querySelectorAll('.short-slide').forEach(s => obs.observe(s));
            },

            watchVideo(id) {
                const v = app.videos.find(x => x.id === id);
                this.showPage('watch');
                const player = document.getElementById('main-player');
                player.src = v.url;
                document.getElementById('watch-title').innerText = v.title;
                document.getElementById('watch-desc').innerText = v.desc || "Açıklama yok.";
            },

            toggleModal(type, show) {
                const modal = document.getElementById('upload-modal');
                if(show) modal.classList.replace('hidden', 'flex');
                else modal.classList.replace('flex', 'hidden');
                lucide.createIcons();
            }
        };

        window.onload = () => { ui.renderAll(); ui.showPage('home'); };
    </script>
</body>
</html>

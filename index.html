<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SpyderCoin Mining Fan Edition</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://adexora.com/cdn/ads.js?id=1545"></script>

    <style>
        :root {
            --primary: #00d2ff; --secondary: #9c27b0; --bg-dark: #050a12;
            --card-bg: #101926; --success: #00e676; --danger: #ff4444;
            --text-muted: #888; --button-glow: rgba(0, 210, 255, 0.3);
        }

        /* RESET & BASE */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; outline: none; margin: 0; padding: 0; }
        body {
            background: radial-gradient(circle at center, #101926 0%, #050a12 100%);
            color: white; font-family: 'Segoe UI', sans-serif; height: 100vh;
            display: flex; flex-direction: column; overflow: hidden;
        }

        /* BAN OVERLAY */
        #ban-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.95); z-index: 10000; flex-direction: column; align-items: center;
            justify-content: center; text-align: center; padding: 20px;
        }
        #ban-overlay h1 { font-size: 80px; margin-bottom: 10px; color: var(--danger); }
        #ban-overlay p { color: var(--text-muted); margin-top: 15px; font-size: 14px; }

        /* HEADER */
        header { padding: 20px; text-align: center; border-bottom: 1px solid rgba(0, 210, 255, 0.1); background: rgba(0,0,0,0.2); }
        .balance-label { font-size: 12px; color: var(--primary); letter-spacing: 2px; text-transform: uppercase; }
        .balance-value { font-size: 38px; font-weight: 900; color: white; text-shadow: 0 0 15px var(--button-glow); }
        
        /* MAIN CONTENT & TABS */
        main { flex-grow: 1; overflow-y: auto; padding-bottom: 90px; }
        .tab-content { display: none; padding: 20px; animation: fadeIn 0.4s ease-out; width: 100%; }
        .tab-content.active { display: flex; flex-direction: column; align-items: center; }

        /* MINING SECTION */
        .mining-section {
            display: flex; flex-direction: column; align-items: center;
            background: var(--card-bg); border-radius: 20px; padding: 25px;
            margin: 20px 0; width: 100%; max-width: 350px;
            border: 1px solid rgba(0, 210, 255, 0.2);
            box-shadow: 0 0 30px rgba(0, 210, 255, 0.1);
        }
        .mining-spinner-wrapper {
            width: 150px; height: 150px; border-radius: 50%;
            background: rgba(0, 210, 255, 0.1);
            display: flex; align-items: center; justify-content: center;
            margin-bottom: 20px; border: 2px solid var(--primary);
            overflow: hidden;
        }
        .mining-fan-icon {
            font-size: 80px; color: var(--primary);
            animation: spin 2s linear infinite;
        }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

        .pool-info {
            background: rgba(0, 210, 255, 0.15); padding: 12px 25px; border-radius: 30px;
            border: 1px solid var(--primary); text-align: center;
            width: 90%; max-width: 250px; margin-bottom: 20px;
        }
        .pool-label { font-size: 10px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1px; }
        .pool-balance { font-size: 22px; font-weight: bold; color: white; text-shadow: 0 0 10px var(--button-glow); }

        .btn-claim { 
            background: linear-gradient(45deg, #00d2ff, #3a7bd5); color: white; border: none; 
            padding: 14px 30px; border-radius: 10px; font-weight: 800; cursor: pointer;
            box-shadow: 0 5px 15px var(--button-glow); font-size: 16px;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .btn-claim:active { transform: translateY(2px); box-shadow: 0 2px 10px var(--button-glow); }

        .mining-stats-text { font-size: 11px; color: var(--text-muted); margin-top: 15px; text-align: center; line-height: 1.5; }
        .highlight-text { color: var(--success); font-weight: bold; }

        /* WALLET SECTION */
        .card { background: var(--card-bg); border-radius: 20px; padding: 20px; width: 100%; max-width: 400px; border: 1px solid rgba(255,255,255,0.05); margin-bottom: 15px; }
        .card h3 { color: white; margin-bottom: 15px; text-align: center; }
        .input-dark {
            width: 100%; padding: 12px; border-radius: 10px; margin-bottom: 10px;
            background: #08111c; border: 1px solid #2a3d54; color: white; text-align: center;
        }
        .withdraw-info { font-size: 11px; color: var(--text-muted); margin-bottom: 15px; text-align: center; }

        /* ADMIN SECTION */
        #admin-stats { border: 1px solid var(--primary); margin-bottom: 20px; }
        #global-stats { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 11px; margin-top: 10px; }
        .stat-item { background: #1a2a3a; padding: 10px; border-radius: 8px; border: 1px solid #2a3d54; }
        .admin-item { background: #1a2a3a; padding: 12px; border-radius: 10px; margin-bottom: 10px; border-left: 4px solid var(--primary); cursor: pointer; width: 100%; }
        .detail-panel { background: #08111c; border-radius: 10px; padding: 10px; margin-top: 10px; display: none; grid-template-columns: 1fr 1fr; gap: 8px; }
        .btn-adm { 
            font-size: 10px; padding: 10px; border-radius: 6px; border: none; font-weight: bold; 
            cursor: pointer; color: white; transition: background 0.2s; 
        }
        .btn-adm.ban-btn { background: var(--danger); }
        .btn-adm.unban-btn { background: var(--success); }
        .btn-adm.add-btn { background: #00897b; }
        .btn-adm.minus-btn { background: #ef6c00; }
        .btn-adm.reset-btn { background: #5e35b1; }


        /* NAVIGATION */
        .nav-bar {
            position: fixed; bottom: 0; width: 100%; height: 75px; background: #08111c;
            display: flex; justify-content: space-around; align-items: center;
            border-top: 1px solid rgba(0, 210, 255, 0.1); z-index: 1000;
        }
        .nav-link { display: flex; flex-direction: column; align-items: center; color: #4b5563; text-decoration: none; font-size: 11px; cursor: pointer; transition: color 0.3s; }
        .nav-link span:first-child { font-size: 24px; margin-bottom: 4px; }
        .nav-link.active { color: var(--primary); }

        /* ANIMATIONS */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <div id="ban-overlay">
        <h1>üö´</h1>
        <h2>HESABINIZ BANLANDI</h2>
        <p>Sistem kurallarƒ±nƒ± ihlal ettiƒüiniz i√ßin eri≈üiminiz engellenmi≈ütir.<br>Destek i√ßin y√∂netici ile ileti≈üime ge√ßin.</p>
    </div>

    <header>
        <div class="balance-label">TOPLAM BAKƒ∞YE</div>
        <div class="balance-value">$<span id="main-balance">0.00000</span></div>
    </header>

    <main id="app-body">
        <div id="tab-home" class="tab-content active">
            <div class="mining-section">
                <div class="mining-spinner-wrapper">
                    <span class="mining-fan-icon">üåÄ</span>
                </div>
                
                <div class="pool-info">
                    <div class="pool-label">MADENCƒ∞Lƒ∞K HAVUZU</div>
                    <div id="pool-balance" class="pool-balance">$0.000000</div>
                </div>

                <button class="btn-claim" onclick="claimMining()">CLAIM (HASAT ET)</button>
                <p class="mining-stats-text">
                    ≈ûart: Her <span class="highlight-text">$0.0005</span> hasat i√ßin <span class="highlight-text">1 reklam izleme puanƒ±</span> gerekir.<br>
                    Mevcut Puanƒ±nƒ±z: <span id="user-ads-count" class="highlight-text">0</span>
                </p>
            </div>
            
            <p style="font-size: 11px; color: var(--text-muted); text-align: center; margin-top: 20px;">
                Havuzdaki bakiyeniz her saniye otomatik olarak artmaktadƒ±r.
            </p>
        </div>

        <div id="tab-wallet" class="tab-content">
            <div class="card">
                <h3>Para √áekme (USDT TRC20)</h3>
                <p class="withdraw-info">
                    Minimum √áekim: <span class="highlight-text">0.10 USDT</span><br>
                    Her <span class="highlight-text">0.50 USDT</span> √ßekim i√ßin <span class="highlight-text">770 ƒ∞zleme Puanƒ±</span> gereklidir.
                </p>
                <input type="number" id="wd-amt" class="input-dark" placeholder="Miktar (√ñrn: 0.50)">
                <input type="text" id="wd-addr" class="input-dark" placeholder="TRC20 C√ºzdan Adresi">
                <button class="btn-claim" style="width:100%;" onclick="sendWithdraw()">√ñDEME TALEBƒ∞ G√ñNDER</button>
            </div>
        </div>

        <div id="tab-admin" class="tab-content">
            <div id="admin-stats" class="card">
                <h4 style="text-align:center; color:var(--primary);">Sƒ∞STEM GENEL √ñZETƒ∞</h4>
                <div id="global-stats" class="stat-grid"></div>
            </div>
            <div id="admin-user-list" style="width:100%;"></div>
        </div>
    </main>

    <nav class="nav-bar">
        <div class="nav-link active" onclick="showTab('home', this)"><span>‚õèÔ∏è</span><span>MINING</span></div>
        <div class="nav-link" onclick="showTab('wallet', this)"><span>üëõ</span><span>WALLET</span></div>
        <div id="admin-link" class="nav-link" style="display:none;" onclick="showTab('admin', this)"><span>üõ°Ô∏è</span><span>ADMIN</span></div>
    </nav>

    <script>
        // --- FIREBASE CONFIGURATION ---
        const firebaseConfig = {
            apiKey: "AIzaSyDfy6QdIZ0BthEHTmxkw-NAja3B9bFFd8U",
            authDomain: "spydercoin-94f7b.firebaseapp.com",
            projectId: "spydercoin-94f7b",
            storageBucket: "spydercoin-94f7b.firebasestorage.app",
            messagingSenderId: "218267568158",
            appId: "1:218267568158:web:832728845ba0f42202060f"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // --- GLOBAL CONSTANTS ---
        const MASTER_ADMIN_ID = "8392479231"; // Senin Telegram ID'n
        const MINING_RATE_PER_SECOND = 0.0001; // Saniyede kazanƒ±lan USDT
        const CLAIM_ADS_PER_0005_USD = 1; // Her 0.0005 USDT i√ßin gereken reklam puanƒ±
        const WITHDRAW_MIN_AMOUNT = 0.10; // Minimum √ßekim miktarƒ±
        const WITHDRAW_ADS_PER_0_50_USD = 770; // 0.50 USDT √ßekim i√ßin gereken reklam puanƒ±

        // --- USER DATA ---
        const TWA = window.Telegram.WebApp;
        TWA.expand(); // Telegram uygulamasƒ±nƒ± tam ekran yapar
        const tgUser = TWA.initDataUnsafe.user || { id: "dev_user", first_name: "Developer", username: "dev" };
        const USER_ID = tgUser.id.toString();

        let pData = {
            money: 0,
            adsWatched: 0,
            pool: 0, // Madencilik havuzunda biriken para
            isBanned: false,
            lastActivity: Date.now() // Son aktivite zamanƒ± (ihtiya√ß olursa kullanƒ±labilir)
        };

        // --- UI ELEMENTS ---
        const mainBalanceEl = document.getElementById('main-balance');
        const poolBalanceEl = document.getElementById('pool-balance');
        const userAdsCountEl = document.getElementById('user-ads-count');
        const banOverlayEl = document.getElementById('ban-overlay');
        const appBodyEl = document.getElementById('app-body');
        const adminLinkEl = document.getElementById('admin-link');

        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            if(USER_ID === MASTER_ADMIN_ID) adminLinkEl.style.display = 'flex';
            
            // Firebase'den kullanƒ±cƒ± verilerini dinle
            db.collection("players").doc(USER_ID).onSnapshot(doc => {
                if (doc.exists) {
                    pData = doc.data();
                    checkBanStatus();
                    renderUI();
                } else {
                    syncUserData(); // Yeni kullanƒ±cƒ±ysa ba≈ülangƒ±√ß verilerini kaydet
                }
            }, error => console.error("Firebase Snapshot Error:", error));

            // Admin Paneli i√ßin genel istatistikleri ve kullanƒ±cƒ± listesini dinle
            if (USER_ID === MASTER_ADMIN_ID) {
                db.collection("players").onSnapshot(snap => {
                    updateAdminPanel(snap);
                }, error => console.error("Admin Panel Snapshot Error:", error));
            }
        });

        // --- MINING LOGIC ---
        setInterval(() => {
            if (!pData.isBanned) {
                pData.pool += MINING_RATE_PER_SECOND;
                if (poolBalanceEl) poolBalanceEl.innerText = `$${pData.pool.toFixed(6)}`;
            }
        }, 1000); // Her saniye 0.0001 USDT ekle

        function claimMining() {
            if (pData.isBanned) {
                TWA.showAlert("Hesabƒ±nƒ±z banlƒ± olduƒüu i√ßin i≈ülem yapamazsƒ±nƒ±z.");
                return;
            }

            if (pData.pool < 0.0005) {
                TWA.showAlert("Havuzda en az $0.0005 birikmelidir.");
                return;
            }

            const requiredAdsForClaim = Math.floor(pData.pool / 0.0005) * CLAIM_ADS_PER_0005_USD;
            
            if (pData.adsWatched < requiredAdsForClaim) {
                TWA.showAlert(`Yetersiz Reklam Puanƒ±!\nHasat etmek i√ßin ${requiredAdsForClaim} reklam puanƒ±na ihtiyacƒ±nƒ±z var.`);
                // ƒ∞stersen burada reklam g√∂sterme linkini a√ßabilirsin:
                // window.open("https://adexora.my.id/dl/QFm5mnRYbJV", "_blank");
                return;
            }

            pData.money += pData.pool;
            pData.adsWatched -= requiredAdsForClaim;
            pData.pool = 0; // Havuzu sƒ±fƒ±rla
            syncUserData();
            TWA.showAlert("Hasat ba≈üarƒ±lƒ±! Kazan√ß ana bakiyenize eklendi.");
        }

        // --- WALLET LOGIC ---
        function sendWithdraw() {
            if (pData.isBanned) {
                TWA.showAlert("Hesabƒ±nƒ±z banlƒ± olduƒüu i√ßin para √ßekme i≈ülemi yapamazsƒ±nƒ±z.");
                return;
            }

            const amount = parseFloat(document.getElementById('wd-amt').value);
            const address = document.getElementById('wd-addr').value.trim();

            if (isNaN(amount) || amount < WITHDRAW_MIN_AMOUNT) {
                TWA.showAlert(`Minimum √ßekim ${WITHDRAW_MIN_AMOUNT.toFixed(2)} USDT'dir.`);
                return;
            }
            if (pData.money < amount) {
                TWA.showAlert("Yetersiz bakiyeniz var.");
                return;
            }
            if (address.length < 20) { // Basit TRC20 adres kontrol√º
                TWA.showAlert("Ge√ßerli bir TRC20 c√ºzdan adresi giriniz.");
                return;
            }

            const requiredAdsForWithdraw = Math.ceil((amount / 0.50) * WITHDRAW_ADS_PER_0_50_USD);
            if (pData.adsWatched < requiredAdsForWithdraw) {
                TWA.showAlert(`Yetersiz Reklam Puanƒ±!\n${amount.toFixed(2)} USDT √ßekmek i√ßin ${requiredAdsForWithdraw} puanƒ±na ihtiyacƒ±nƒ±z var.`);
                return;
            }

            db.collection("withdrawals").add({
                userId: USER_ID,
                username: tgUser.username || "n/a",
                amount: amount,
                address: address,
                timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                status: "Pending" // Beklemede
            }).then(() => {
                pData.money -= amount;
                pData.adsWatched -= requiredAdsForWithdraw;
                syncUserData();
                TWA.showAlert("√ñdeme talebiniz ba≈üarƒ±yla alƒ±ndƒ±. En kƒ±sa s√ºrede i≈üleme alƒ±nacaktƒ±r.");
            }).catch(error => {
                console.error("Para √ßekme talebi hatasƒ±:", error);
                TWA.showAlert("√ñdeme talebi sƒ±rasƒ±nda bir hata olu≈ütu. L√ºtfen tekrar deneyin.");
            });
        }
        
        // --- ADMIN PANEL FUNCTIONS ---
        function updateAdminPanel(snapshot) {
            let totalUsers = snapshot.size;
            let totalMoney = 0;
            let totalAdsWatched = 0;
            let totalBannedUsers = 0;

            const userListContainer = document.getElementById('admin-user-list');
            userListContainer.innerHTML = ''; // Listeyi temizle

            snapshot.forEach(doc => {
                const userData = doc.data();
                const userId = doc.id;

                totalMoney += userData.money || 0;
                totalAdsWatched += userData.adsWatched || 0;
                if (userData.isBanned) totalBannedUsers++;

                // Kullanƒ±cƒ± listesi HTML'ini olu≈ütur
                const banBtnText = userData.isBanned ? 'BAN KALDIR' : 'BANLA';
                const banBtnClass = userData.isBanned ? 'unban-btn' : 'ban-btn';
                userListContainer.innerHTML += `
                    <div class="admin-item" onclick="toggleUserDetail('${userId}')">
                        <span style="${userData.isBanned ? 'text-decoration:line-through; color:var(--danger);' : ''}">
                            <b>${userData.first_name || 'N/A'}</b> (@${userData.username || 'yok'})
                        </span>
                        <div style="font-size:11px; color:var(--text-muted); margin-top:5px;">
                            Bak: $${(userData.money || 0).toFixed(5)} | Puan: ${userData.adsWatched || 0}
                        </div>
                        
                        <div id="det-${userId}" class="detail-panel">
                            <button class="btn-adm add-btn" onclick="modifyUser('${userId}', 'money', 0.10)">üí∞ +0.10$</button>
                            <button class="btn-adm minus-btn" onclick="modifyUser('${userId}', 'money', -0.10)">üí∏ -0.10$</button>
                            <button class="btn-adm add-btn" onclick="modifyUser('${userId}', 'adsWatched', 770)">üì∫ +770 Puan</button>
                            <button class="btn-adm minus-btn" onclick="modifyUser('${userId}', 'adsWatched', -770)">üìâ -770 Puan</button>
                            <button class="btn-adm ${banBtnClass}" style="grid-column:span 2;" onclick="toggleBanStatus('${userId}', ${userData.isBanned})">${banBtnText}</button>
                        </div>
                    </div>
                `;
            });

            // Global istatistikler HTML'ini g√ºncelle
            const globalStatsEl = document.getElementById('global-stats');
            globalStatsEl.innerHTML = `
                <div class="stat-item">Toplam √úye: <b>${totalUsers}</b></div>
                <div class="stat-item">Toplam Kasa: <b>$${totalMoney.toFixed(2)}</b></div>
                <div class="stat-item">Toplam Puan: <b>${totalAdsWatched}</b></div>
                <div class="stat-item">Banlƒ± √úye: <b>${totalBannedUsers}</b></div>
            `;
        }

        function toggleUserDetail(id) {
            const el = document.getElementById(`det-${id}`);
            el.style.display = (el.style.display === 'grid') ? 'none' : 'grid';
        }

        function modifyUser(id, field, value) {
            event.stopPropagation(); // Admin panelindeki tƒ±klama olayƒ±nƒ±n yayƒ±lmasƒ±nƒ± engelle
            db.collection("players").doc(id).update({
                [field]: firebase.firestore.FieldValue.increment(value)
            }).then(() => {
                TWA.HapticFeedback.notificationOccurred('success');
            }).catch(error => {
                console.error("Kullanƒ±cƒ± verisi g√ºncelleme hatasƒ±:", error);
                TWA.HapticFeedback.notificationOccurred('error');
            });
        }

        function toggleBanStatus(id, currentStatus) {
            event.stopPropagation();
            db.collection("players").doc(id).update({ isBanned: !currentStatus })
            .then(() => {
                TWA.showAlert(currentStatus ? "Kullanƒ±cƒ±nƒ±n banƒ± kaldƒ±rƒ±ldƒ±." : "Kullanƒ±cƒ± banlandƒ±.");
                TWA.HapticFeedback.notificationOccurred('success');
            }).catch(error => {
                console.error("Ban/Unban hatasƒ±:", error);
                TWA.HapticFeedback.notificationOccurred('error');
            });
        }
        
        // --- UI RENDERING & SYNC ---
        function renderUI() {
            mainBalanceEl.innerText = pData.money.toFixed(5);
            poolBalanceEl.innerText = `$${pData.pool.toFixed(6)}`;
            userAdsCountEl.innerText = pData.adsWatched;
        }

        let syncTimeout;
        function syncUserData() {
            clearTimeout(syncTimeout);
            syncTimeout = setTimeout(() => {
                db.collection("players").doc(USER_ID).set({
                    ...pData,
                    first_name: tgUser.first_name || "N/A",
                    username: tgUser.username || "yok",
                    lastActivity: Date.now()
                }, { merge: true }).catch(error => console.error("Veri kaydetme hatasƒ±:", error));
            }, 1000); // 1 saniye sonra veriyi kaydet (debounced)
        }

        function checkBanStatus() {
            if (pData.isBanned) {
                banOverlayEl.style.display = 'flex';
                appBodyEl.style.display = 'none';
                TWA.disableClosingConfirmation(); // Banlƒ±yken kapatma onayƒ± verme
            } else {
                banOverlayEl.style.display = 'none';
                appBodyEl.style.display = 'block';
                TWA.enableClosingConfirmation(); // Banlƒ± deƒüilken kapatma onayƒ± ver
            }
        }

        function showTab(tabId, el) {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
            document.getElementById(`tab-${tabId}`).classList.add('active');
            el.classList.add('active');
            TWA.HapticFeedback.impactOccurred('light');
        }

        // --- ADEXORA ENERJƒ∞ REFILL ---
        // Bu kƒ±sƒ±m artƒ±k direkt mining sistemiyle alakalƒ± olmadƒ±ƒüƒ± i√ßin √ßƒ±karƒ±ldƒ±.
        // Reklam izleme, Claim butonuna basƒ±ldƒ±ƒüƒ±nda y√∂nlendirme olarak kullanƒ±labilir.
        // Eƒüer kullanƒ±cƒ± manuel olarak reklam izleyip puan kazanmak isterse buraya bir buton eklenebilir.
        // √ñrnek:
        // function showAdToEarnAds() {
        //     window.open("https://adexora.my.id/dl/QFm5mnRYbJV", "_blank");
        //     TWA.showAlert("Reklamƒ± izledikten sonra puanƒ±nƒ±z eklenecektir.");
        // }
    </script>
</body>
</html>

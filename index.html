<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Spyder Network - Enterprise Edition V12</title>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://adexora.com/cdn/ads.js?id=1545"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap" rel="stylesheet">

    <style>
        /* --- CORE DESIGN SYSTEM --- */
        :root {
            --p-purple: #a855f7; --p-glow: rgba(168, 85, 247, 0.5);
            --bg-deep: #020205; --card-bg: rgba(15, 15, 25, 0.9);
            --border: rgba(255, 255, 255, 0.08); --text: #f8fafc;
            --dim: #64748b; --success: #10b981; --error: #f43f5e;
            --warning: #f59e0b;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Plus Jakarta Sans', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg-deep); color: var(--text); height: 100vh; overflow: hidden; display: flex; flex-direction: column; }

        /* --- ADVANCED SECURITY OVERLAY --- */
        #security-barrier {
            position: fixed; inset: 0; background: #000; z-index: 999999;
            display: none; flex-direction: column; align-items: center; justify-content: center;
            padding: 40px; text-align: center;
        }
        .error-code { font-family: 'JetBrains Mono'; color: var(--error); font-size: 14px; margin-top: 20px; }

        /* --- UI ARCHITECTURE --- */
        #app-scroller { flex: 1; overflow-y: auto; padding: 20px 20px 120px 20px; scroll-behavior: smooth; }
        .view { display: none; animation: viewTransition 0.5s cubic-bezier(0.2, 0.8, 0.2, 1); }
        .view.active { display: flex; flex-direction: column; }
        @keyframes viewTransition { from { opacity: 0; transform: translateY(15px) scale(0.98); } to { opacity: 1; transform: translateY(0) scale(1); } }

        /* --- GLASS COMPONENTS --- */
        .glass-panel {
            background: var(--card-bg); backdrop-filter: blur(25px); border: 1px solid var(--border);
            border-radius: 32px; padding: 24px; margin-bottom: 20px; box-shadow: 0 20px 40px rgba(0,0,0,0.4);
        }

        /* --- GAMIFIED COMPONENTS --- */
        .mining-node {
            width: 260px; height: 260px; margin: 30px auto; position: relative;
            display: flex; align-items: center; justify-content: center;
            background: radial-gradient(circle, var(--p-purple) 0%, transparent 70%);
            border-radius: 50%; cursor: pointer; transition: 0.2s;
        }
        .mining-node:active { transform: scale(0.92); }
        .mining-node img { width: 140px; filter: drop-shadow(0 0 20px var(--p-glow)); }

        .stat-capsule { background: rgba(255,255,255,0.03); padding: 12px 20px; border-radius: 100px; border: 1px solid var(--border); display: inline-flex; align-items: center; gap: 8px; font-size: 13px; font-weight: 600; }

        /* --- ADMIN ENGINE UI --- */
        .admin-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 25px; }
        .data-card { background: rgba(168, 85, 247, 0.05); border: 1px solid rgba(168, 85, 247, 0.2); padding: 15px; border-radius: 20px; text-align: center; }
        .data-card b { font-size: 24px; color: var(--p-purple); }

        .user-list-box { max-height: 400px; overflow-y: auto; border-radius: 20px; background: rgba(0,0,0,0.2); }
        .user-row { padding: 15px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }

        /* --- NAVIGATION --- */
        nav {
            position: fixed; bottom: 30px; left: 20px; right: 20px; height: 80px;
            background: rgba(15, 15, 20, 0.9); backdrop-filter: blur(30px);
            border: 1px solid var(--border); border-radius: 30px;
            display: flex; align-items: center; justify-content: space-around; z-index: 1000;
        }
        .nav-link { color: var(--dim); display: flex; flex-direction: column; align-items: center; gap: 4px; transition: 0.3s; cursor: pointer; }
        .nav-link.active { color: var(--p-purple); text-shadow: 0 0 15px var(--p-glow); }
        .nav-link i { font-size: 24px; font-style: normal; }
        .nav-link span { font-size: 10px; font-weight: 800; text-transform: uppercase; }

        /* --- MODAL SYSTEM --- */
        .modal-wrap { position: fixed; inset: 0; background: rgba(0,0,0,0.9); backdrop-filter: blur(10px); z-index: 99999; display: none; align-items: center; justify-content: center; padding: 25px; }
        .modal-body { background: #0f0f15; border: 1px solid var(--p-purple); width: 100%; max-width: 450px; border-radius: 35px; padding: 35px; }
    </style>
</head>
<body>

    <div id="security-barrier">
        <i style="font-size: 60px;">ðŸ›‘</i>
        <h1 style="color: var(--error); margin-top: 20px;">ACCESS DENIED</h1>
        <p class="dim" id="ban-reason">HesabÄ±nÄ±z sistem gÃ¼venliÄŸi nedeniyle kÄ±sÄ±tlanmÄ±ÅŸtÄ±r.</p>
        <div class="error-code">STATUS_CODE: 403_BANNED_USER</div>
    </div>

    <div id="modal" class="modal-wrap">
        <div class="modal-body">
            <h2 id="modal-title">Ä°ÅŸlem OnayÄ±</h2>
            <div id="modal-content" style="margin: 20px 0;"></div>
            <div id="modal-footer"></div>
            <button class="btn-primary" style="margin-top: 15px; background: #222;" onclick="UI.closeModal()">Kapat</button>
        </div>
    </div>

    <main id="app-scroller">
        <section id="v-play" class="view active">
            <div style="display: flex; justify-content: center; margin-bottom: 30px;">
                <div class="stat-capsule">
                    <span style="color: var(--p-purple);">ðŸ’Ž</span>
                    <span id="ui-bal">0</span>
                </div>
            </div>

            <div class="mining-node" onclick="Engine.tap(event)">
                <img src="https://cdn-icons-png.flaticon.com/512/3253/3253019.png" alt="Spider">
            </div>

            <div class="glass-panel" style="margin-top: auto;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 12px; font-size: 12px; font-weight: 800;">
                    <span class="dim">ENERJÄ° Ã‡EKÄ°RDEÄžÄ°</span>
                    <span id="ui-nrg-txt">1000 / 1000</span>
                </div>
                <div style="height: 12px; background: rgba(255,255,255,0.05); border-radius: 20px; overflow: hidden;">
                    <div id="ui-nrg-bar" style="height: 100%; background: var(--p-purple); width: 100%; box-shadow: 0 0 20px var(--p-glow);"></div>
                </div>
            </div>
        </section>

        <section id="v-finance" class="view">
            <h2>Finans Merkezi</h2>
            <div class="glass-panel">
                <p class="dim">DÃ¶nÃ¼ÅŸtÃ¼rÃ¼lebilir VarlÄ±k</p>
                <h1 style="color: var(--success); margin: 10px 0;">$<span id="ui-usdt">0.00</span></h1>
                <button class="btn-primary" onclick="Finance.openSwap()">Takas Yap (Swap)</button>
            </div>

            <div class="glass-panel">
                <h3>Para Ã‡ekme (Withdraw)</h3>
                <input type="number" id="wd-amount" placeholder="0.00 USDT">
                <input type="text" id="wd-address" placeholder="BSC (BEP20) Adresi">
                <div style="margin: 15px 0; font-size: 11px;" class="dim">
                    Gerekli Reklam: <b id="ui-ads" style="color: var(--warning)">0 / 15</b>
                </div>
                <button class="btn-primary" onclick="Finance.requestWithdraw()">Talebi GÃ¶nder</button>
            </div>
        </section>

        <section id="v-admin" class="view">
            <h2>Admin OS v12</h2>
            <div class="admin-grid">
                <div class="data-card"><small>TOPLAM ÃœYE</small><div id="adm-total-u">0</div></div>
                <div class="data-card"><small>TOPLAM REKLAM</small><div id="adm-total-a">0</div></div>
            </div>

            <div class="glass-panel" style="padding: 10px;">
                <div style="display: flex; gap: 10px;">
                    <button class="btn-primary" style="flex:1" onclick="Admin.load('active')">Aktif</button>
                    <button class="btn-primary" style="flex:1; background: #222;" onclick="Admin.load('archive')">ArÅŸiv</button>
                </div>
            </div>

            <div id="adm-withdraw-box"></div>

            <h3 style="margin: 20px 0 10px 0;">VeritabanÄ±</h3>
            <div class="user-list-box" id="adm-user-list"></div>
        </section>
    </main>

    <nav id="main-nav">
        <div class="nav-link active" onclick="nav('v-play', this)"><i>ðŸŽ®</i><span>Oyna</span></div>
        <div class="nav-link" onclick="nav('v-finance', this)"><i>ðŸ’°</i><span>Borsa</span></div>
    </nav>

    <script>
        /* --- CORE CONFIGURATION (SATIR 300+) --- */
        const ADMIN_ID = "8392479231";
        const FB_CONFIG = {
            apiKey: "AIzaSyC18uinYQT9vOC-nhxv3x1WIhO_we3CRMY",
            authDomain: "pdfkaynak-51615.firebaseapp.com",
            projectId: "pdfkaynak-51615",
            appId: "1:228512804576:web:a0bba02ca83b4fa7adea85"
        };

        firebase.initializeApp(FB_CONFIG);
        const db = firebase.firestore();
        const tg = window.Telegram.WebApp;

        let state = {
            user: { bal:0, nrg:1000, usdt:0, ads:0, totalAds:0, isBanned:false, isArchived:false, name:"Spyder", username:"n/a" },
            uid: tg.initDataUnsafe?.user?.id?.toString() || "dev_admin"
        };

        /* --- ENGINE LOGIC --- */
        const Engine = {
            boot: async () => {
                const doc = await db.collection("users").doc(state.uid).get();
                if(doc.exists) {
                    state.user = { ...state.user, ...doc.data() };
                    if(state.user.isBanned) return UI.showBan();
                } else {
                    await Engine.save(true);
                }

                if(state.uid === ADMIN_ID) {
                    const navBar = document.getElementById('main-nav');
                    navBar.innerHTML += `<div class="nav-link" onclick="nav('v-admin', this); Admin.init();"><i>ðŸ”‘</i><span>Admin</span></div>`;
                }

                UI.refresh();
                Engine.loops();
            },

            tap: (e) => {
                if(state.user.nrg <= 0) return tg.HapticFeedback.notificationOccurred('error');
                state.user.bal += 1;
                state.user.nrg -= 1.5;
                
                UI.spawnEffect(e);
                if(state.user.bal % 50 === 0) {
                    Engine.save();
                    if(window.showAdexora) window.showAdexora().then(() => { state.user.ads++; state.user.totalAds++; UI.refresh(); });
                }
                UI.refresh();
            },

            save: async (force = false) => {
                const data = {
                    ...state.user,
                    name: tg.initDataUnsafe?.user?.first_name || state.user.name,
                    username: tg.initDataUnsafe?.user?.username || state.user.username,
                    lastActive: firebase.firestore.FieldValue.serverTimestamp()
                };
                await db.collection("users").doc(state.uid).set(data, { merge: true });
            },

            loops: () => {
                setInterval(() => {
                    if(state.user.nrg < 1000) {
                        state.user.nrg = Math.min(1000, state.user.nrg + 5);
                        UI.refresh();
                    }
                }, 4000);
            }
        };

        /* --- FINANCE SYSTEM --- */
        const Finance = {
            openSwap: () => {
                UI.openModal("Token TakasÄ±", `
                    <p class="dim">100.000 Spyder = 1.00 USDT</p>
                    <input type="number" id="sw-val" value="100000" style="margin-top:20px">
                `, `
                    <button class="btn-primary" onclick="Finance.confirmSwap()">Takas Et</button>
                `);
            },
            confirmSwap: async () => {
                const val = parseInt(document.getElementById('sw-val').value);
                if(state.user.bal < val) return tg.showAlert("Yetersiz bakiye!");
                state.user.bal -= val;
                state.user.usdt += (val * 0.00001);
                await Engine.save(true);
                UI.closeModal();
                UI.refresh();
            },
            requestWithdraw: async () => {
                const amt = parseFloat(document.getElementById('wd-amount').value);
                const adr = document.getElementById('wd-address').value;
                const req = Math.max(15, Math.ceil(amt / 0.01) * 15);

                if(state.user.usdt < amt || state.user.ads < req || adr.length < 10) return tg.showAlert("Åžartlar saÄŸlanmadÄ±!");

                await db.collection("withdrawals").add({
                    uid: state.uid, amount: amt, address: adr, name: state.user.name, status: "pending"
                });
                state.user.usdt -= amt;
                state.user.ads = 0;
                await Engine.save(true);
                tg.showAlert("Talep alÄ±ndÄ±! 24 saat iÃ§inde gÃ¶nderilecektir.");
                UI.refresh();
            }
        };

        /* --- ADMIN ENGINE --- */
        const Admin = {
            init: () => Admin.load('active'),
            load: async (mode) => {
                const isArc = (mode === 'archive');
                const snap = await db.collection("users").where("isArchived", "==", isArc).get();
                const list = document.getElementById('adm-user-list');
                list.innerHTML = "";
                let tAds = 0;

                snap.forEach(doc => {
                    const d = doc.data();
                    tAds += (d.totalAds || 0);
                    const row = document.createElement('div');
                    row.className = 'user-row';
                    row.innerHTML = `
                        <div><b>${d.name}</b><br><small class="dim">@${d.username}</small></div>
                        <button class="btn-primary" style="width:auto; padding:5px 12px; font-size:11px" onclick="Admin.manage('${doc.id}')">YÃ¶net</button>
                    `;
                    list.appendChild(row);
                });
                document.getElementById('adm-total-u').innerText = snap.size;
                document.getElementById('adm-total-a').innerText = tAds.toLocaleString();
                Admin.loadWithdraws();
            },
            loadWithdraws: async () => {
                const snap = await db.collection("withdrawals").where("status", "==", "pending").get();
                const box = document.getElementById('adm-withdraw-box');
                box.innerHTML = snap.empty ? "" : `<h4 style="color:var(--warning); margin:15px 0">ðŸ’° Bekleyen Ã–demeler</h4>`;
                snap.forEach(doc => {
                    const r = doc.data();
                    box.innerHTML += `
                        <div class="glass-panel" style="padding:15px; border-color:var(--warning)">
                            <small>${r.name} - $${r.amount}</small><br>
                            <button class="btn-primary" style="margin-top:10px; padding:8px" onclick="Admin.completePay('${doc.id}', '${r.uid}')">Ã–dendi</button>
                        </div>
                    `;
                });
            },
            manage: async (targetUid) => {
                const doc = await db.collection("users").doc(targetUid).get();
                const d = doc.data();
                UI.openModal(d.name, `
                    <div style="font-size:13px">
                        Bakiye: ${d.bal} <br> USDT: $${d.usdt} <br> Reklam: ${d.totalAds}
                    </div>
                `, `
                    <div style="display:flex; gap:10px">
                        <button class="btn-primary" style="background:var(--error)" onclick="Admin.action('${targetUid}', 'ban')">${d.isBanned?'Ban KaldÄ±r':'Banla'}</button>
                        <button class="btn-primary" style="background:var(--warning)" onclick="Admin.action('${targetUid}', 'archive')">${d.isArchived?'Aktif Et':'ArÅŸivle'}</button>
                    </div>
                `);
            },
            action: async (id, type) => {
                const doc = await db.collection("users").doc(id).get();
                const d = doc.data();
                const up = type === 'ban' ? { isBanned: !d.isBanned } : { isArchived: !d.isArchived };
                await db.collection("users").doc(id).update(up);
                UI.closeModal(); Admin.init();
            },
            completePay: async (docId, userId) => {
                await db.collection("withdrawals").doc(docId).update({ status: "completed" });
                await db.collection("users").doc(userId).update({ paymentNotif: true });
                tg.showAlert("OnaylandÄ±!"); Admin.loadWithdraws();
            }
        };

        /* --- UI UTILS --- */
        const UI = {
            refresh: () => {
                document.getElementById('ui-bal').innerText = Math.floor(state.user.bal).toLocaleString();
                document.getElementById('ui-usdt').innerText = state.user.usdt.toFixed(2);
                document.getElementById('ui-nrg-txt').innerText = `${state.user.nrg} / 1000`;
                document.getElementById('ui-nrg-bar').style.width = (state.user.nrg / 10) + "%";
                
                const wdVal = parseFloat(document.getElementById('wd-amount').value) || 0;
                const req = Math.max(15, Math.ceil(wdVal / 0.01) * 15);
                document.getElementById('ui-ads').innerText = `${state.user.ads} / ${req}`;
            },
            showBan: () => document.getElementById('security-barrier').style.display = 'flex',
            openModal: (t, c, f) => {
                document.getElementById('modal-title').innerText = t;
                document.getElementById('modal-content').innerHTML = c;
                document.getElementById('modal-footer').innerHTML = f;
                document.getElementById('modal').style.display = 'flex';
            },
            closeModal: () => document.getElementById('modal').style.display = 'none',
            spawnEffect: (e) => {
                const x = e.clientX || e.touches[0].clientX;
                const y = e.clientY || e.touches[0].clientY;
                const el = document.createElement('div');
                el.innerText = "+1";
                el.style = `position:fixed; left:${x}px; top:${y}px; color:var(--p-purple); font-weight:800; animation: up 0.8s forwards; pointer-events:none;`;
                document.body.appendChild(el);
                setTimeout(() => el.remove(), 800);
            }
        };

        function nav(id, el) {
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.querySelectorAll('.nav-link').forEach(n => n.classList.remove('active'));
            document.getElementById(id).classList.add('active'); el.classList.add('active');
        }

        const style = document.createElement('style');
        style.innerHTML = `@keyframes up { to { transform: translateY(-100px); opacity: 0; } } .btn-primary { width: 100%; padding: 15px; border-radius: 15px; border:none; background:var(--p-purple); color:white; font-weight:800; cursor:pointer; }`;
        document.head.appendChild(style);

        Engine.boot();
    </script>
</body>
</html>

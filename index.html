<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>SpyderCoin - The Future of Tap-to-Earn</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>

    <style>
        /* ==========================================================================
           1. CSS RESET & GLOBAL VARIABLES
           ==========================================================================
        */
        :root {
            /* Color Palette */
            --spyder-purple: #a855f7;
            --spyder-purple-deep: #7c3aed;
            --spyder-purple-glow: rgba(168, 85, 247, 0.55);
            --spyder-bg-black: #070708;
            --spyder-card-bg: #111113;
            --spyder-card-border: #1f1f22;
            --spyder-text-white: #ffffff;
            --spyder-text-dim: #94a3b8;
            --spyder-green: #10b981;
            --spyder-red: #ef4444;
            --spyder-gold: #fbbf24;
            
            /* Sizing & Spacing */
            --nav-height: 95px;
            --safe-area-bottom: env(safe-area-inset-bottom);
            --transition-speed: 0.3s;
            --radius-lg: 24px;
            --radius-md: 16px;
        }

        /* ==========================================================================
           2. GLOBAL STYLES (Performance Optimized)
           ==========================================================================
        */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            user-select: none;
            outline: none;
        }

        body {
            background-color: var(--spyder-bg-black);
            color: var(--spyder-text-white);
            font-family: 'Inter', -apple-system, system-ui, sans-serif;
            overflow: hidden;
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
            line-height: 1.5;
        }

        /* ==========================================================================
           3. ANIMATION KEYFRAMES (Extended Library)
           ==========================================================================
        */
        @keyframes spiderPulse {
            0% { transform: scale(1); box-shadow: 0 0 30px var(--spyder-purple-glow); }
            50% { transform: scale(1.02); box-shadow: 0 0 60px var(--spyder-purple-glow); }
            100% { transform: scale(1); box-shadow: 0 0 30px var(--spyder-purple-glow); }
        }

        @keyframes waveExpand {
            0% { transform: translate(-50%, -50%) scale(0.1); opacity: 1; border-width: 4px; }
            100% { transform: translate(-50%, -50%) scale(2.5); opacity: 0; border-width: 1px; }
        }

        @keyframes coinFloatUp {
            0% { transform: translate(-50%, 0); opacity: 1; }
            100% { transform: translate(-50%, -180px); opacity: 0; }
        }

        @keyframes slideInUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes rotateGlow {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* ==========================================================================
           4. PAGE & NAVIGATION SYSTEM
           ==========================================================================
        */
        .app-view {
            flex: 1;
            width: 100%;
            position: relative;
            overflow-y: auto;
            padding-bottom: calc(var(--nav-height) + var(--safe-area-bottom) + 20px);
            z-index: 10;
        }

        .page-node {
            display: none;
            flex-direction: column;
            align-items: center;
            width: 100%;
            padding: 24px;
            min-height: 100%;
            animation: slideInUp 0.4s cubic-bezier(0.23, 1, 0.32, 1);
        }

        .page-node.active {
            display: flex;
        }

        /* ==========================================================================
           5. MAIN HOME UI (THE TAPPER)
           ==========================================================================
        */
        .stats-header {
            text-align: center;
            margin-top: 20px;
            width: 100%;
        }

        .coin-label {
            font-size: 14px;
            font-weight: 700;
            color: var(--spyder-text-dim);
            letter-spacing: 3px;
            text-transform: uppercase;
        }

        .coin-display {
            font-size: 72px;
            font-weight: 900;
            background: linear-gradient(to bottom, #fff, var(--spyder-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin: 10px 0;
            filter: drop-shadow(0 0 15px var(--spyder-purple-glow));
        }

        .tap-engine-container {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            position: relative;
        }

        .spider-portal {
            position: relative;
            width: 320px;
            height: 320px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .portal-glow {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: radial-gradient(circle, var(--spyder-purple-glow) 0%, transparent 75%);
            animation: spiderPulse 3s infinite ease-in-out;
        }

        .main-tapper-btn {
            width: 260px;
            height: 260px;
            background: linear-gradient(135deg, var(--spyder-purple) 0%, var(--spyder-purple-deep) 100%);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 110px;
            z-index: 50;
            box-shadow: 0 15px 40px rgba(0,0,0,0.5), inset 0 0 30px rgba(255,255,255,0.2);
            transition: transform 0.05s ease;
            cursor: pointer;
        }

        .main-tapper-btn:active {
            transform: scale(0.93);
        }

        /* ENERGY SYSTEM UI */
        .energy-section {
            width: 100%;
            max-width: 450px;
            background: rgba(255,255,255,0.03);
            padding: 20px;
            border-radius: var(--radius-lg);
            border: 1px solid var(--spyder-card-border);
        }

        .energy-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .energy-meta span {
            font-weight: 800;
            font-size: 15px;
        }

        .energy-progress-bg {
            width: 100%;
            height: 16px;
            background: #151518;
            border-radius: 30px;
            overflow: hidden;
            border: 1px solid #252529;
        }

        .energy-progress-fill {
            height: 100%;
            width: 100%;
            background: linear-gradient(90deg, var(--spyder-purple) 0%, #c084fc 100%);
            box-shadow: 0 0 15px var(--spyder-purple-glow);
            transition: width 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* ==========================================================================
           6. VAULT & SWAP SYSTEM (FINANCE)
           ==========================================================================
        */
        .vault-container {
            width: 100%;
        }

        .swap-card {
            background: var(--spyder-card-bg);
            border: 1px solid var(--spyder-card-border);
            border-radius: var(--radius-lg);
            padding: 24px;
            margin-bottom: 20px;
        }

        .swap-header {
            font-size: 18px;
            font-weight: 900;
            color: var(--spyder-purple);
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .input-box-wrapper {
            background: #000;
            border: 1px solid #232326;
            border-radius: var(--radius-md);
            padding: 18px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .input-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .swap-input-field {
            background: transparent;
            border: none;
            color: white;
            font-size: 28px;
            font-weight: 800;
            width: 150px;
        }

        .currency-tag {
            font-weight: 900;
            font-size: 14px;
        }

        .condition-list {
            margin-top: 25px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .condition-item {
            background: rgba(255,255,255,0.02);
            padding: 15px;
            border-radius: var(--radius-md);
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid #1a1a1c;
        }

        .status-badge {
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 11px;
            font-weight: 900;
            text-transform: uppercase;
        }

        .badge-locked { background: #27272a; color: #71717a; }
        .badge-unlocked { background: var(--spyder-green); color: white; }

        .btn-universal {
            width: 100%;
            padding: 20px;
            border-radius: var(--radius-md);
            border: none;
            font-size: 16px;
            font-weight: 900;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 15px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn-purple {
            background: var(--spyder-purple);
            color: white;
            box-shadow: 0 4px 15px var(--spyder-purple-glow);
        }

        .btn-purple:disabled {
            background: #27272a;
            color: #52525b;
            box-shadow: none;
            cursor: not-allowed;
        }

        /* ==========================================================================
           7. NAVIGATION BOTTOM BAR
           ==========================================================================
        */
        .navigation-hub {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: calc(var(--nav-height) + var(--safe-area-bottom));
            background: rgba(7, 7, 8, 0.96);
            backdrop-filter: blur(20px);
            border-top: 1px solid var(--spyder-card-border);
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            padding-bottom: var(--safe-area-bottom);
            z-index: 1000;
        }

        .nav-link {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 6px;
            color: var(--spyder-text-dim);
            text-decoration: none;
            transition: var(--transition-speed);
        }

        .nav-link.active {
            color: var(--spyder-purple);
        }

        .nav-link .icon-box {
            font-size: 24px;
            transition: transform 0.2s;
        }

        .nav-link.active .icon-box {
            transform: translateY(-4px);
        }

        .nav-link span {
            font-size: 11px;
            font-weight: 700;
        }

        /* ==========================================================================
           8. UTILITY CLASSES (FOR ANIMATIONS)
           ==========================================================================
        */
        .plus-one-anim {
            position: absolute;
            color: white;
            font-size: 36px;
            font-weight: 900;
            pointer-events: none;
            z-index: 999;
            animation: coinFloatUp 0.8s ease-out forwards;
            text-shadow: 0 4px 10px rgba(0,0,0,0.5);
        }

        .shockwave {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border: 2px solid rgba(255,255,255,0.5);
            border-radius: 50%;
            pointer-events: none;
            animation: waveExpand 0.6s ease-out forwards;
            z-index: 40;
        }
    </style>
</head>
<body>

    <main class="app-view">
        
        <section id="p-home" class="page-node active">
            <div class="stats-header">
                <p class="coin-label">Net Worth</p>
                <h1 class="coin-display" id="spyder-balance-ui">0</h1>
            </div>

            <div class="tap-engine-container">
                <div class="spider-portal" id="spider-core">
                    <div class="portal-glow"></div>
                    <div class="main-tapper-btn" id="tapper-trigger">üï∑Ô∏è</div>
                </div>
            </div>

            <div class="energy-section">
                <div class="energy-meta">
                    <span style="color:var(--spyder-purple)">‚ö° ENERGY AVAILABILITY</span>
                    <span id="energy-numeric">1000 / 1000</span>
                </div>
                <div class="energy-progress-bg">
                    <div id="energy-bar-fill" class="energy-progress-fill"></div>
                </div>
            </div>
        </section>

        <section id="p-tasks" class="page-node">
            <h2 style="margin-bottom: 20px; font-weight: 900; font-size: 28px;">EARN CENTER</h2>
            <div class="swap-card" style="width:100%; display:flex; justify-content:space-between; align-items:center;">
                <div>
                    <h3 style="font-size:16px;">Spyder Telegram</h3>
                    <p style="color:var(--spyder-purple); font-weight:bold;">+10,000 SPYDER</p>
                </div>
                <button class="btn-universal btn-purple" style="width:auto; padding:10px 25px; margin:0;" onclick="tg.openTelegramLink('https://t.me/SpyderCommunity')">JOIN</button>
            </div>
        </section>

        <section id="p-friends" class="page-node">
            <h2 style="margin-bottom: 20px; font-weight: 900; font-size: 28px;">SPYDER WEB</h2>
            <div class="swap-card" style="width:100%; text-align:center;">
                <p style="color:var(--spyder-text-dim); margin-bottom:20px;">Invite your allies to the web and earn 10% of their taps forever!</p>
                <button class="btn-universal" style="background:#fff; color:#000;">COPY REFERRAL LINK</button>
            </div>
        </section>

        <section id="p-vault" class="page-node">
            <h2 style="margin-bottom: 20px; font-weight: 900; font-size: 28px;">THE VAULT</h2>
            
            <div class="vault-container">
                <div class="swap-card">
                    <div class="swap-header">Currency Swap</div>
                    <div class="input-box-wrapper">
                        <div class="input-row">
                            <span class="currency-tag">FROM</span>
                            <span class="currency-tag" style="color:var(--spyder-purple)">SPYDER COIN</span>
                        </div>
                        <input type="number" class="swap-input-field" id="swap-input-amount" value="1000" oninput="Core.finance.calculate()">
                        <div style="text-align: center; font-size: 20px; margin: -5px 0;">‚¨áÔ∏è</div>
                        <div class="input-row">
                            <span class="currency-tag">TO (EST.)</span>
                            <span class="currency-tag" style="color:var(--spyder-green)">USDT (BEP20)</span>
                        </div>
                        <div id="swap-output-val" style="font-size: 28px; font-weight: 800;">0.01000</div>
                    </div>
                    <p style="font-size: 11px; color: var(--spyder-text-dim); text-align: center; margin-top: 10px;">Exchange Rate: 1 SPYDER = 0.00001 USDT</p>
                </div>

                <div class="swap-card">
                    <div class="swap-header">Verification Status</div>
                    <div class="condition-list">
                        <div class="condition-item">
                            <span>Minimum Swap (1,000)</span>
                            <span id="cond-min-bal" class="status-badge badge-locked">LOCKED</span>
                        </div>
                        <div class="condition-item">
                            <span>Ad-Verification (20)</span>
                            <span id="cond-ads-count" class="status-badge badge-locked">0 / 20</span>
                        </div>
                    </div>
                    
                    <input type="text" id="user-wallet-addr" class="swap-input-field" placeholder="BEP20 USDT ADRESƒ∞Nƒ∞Z" style="width:100%; font-size:14px; background:#000; padding:20px; margin-top:15px; border-radius:15px; border:1px solid #333;">
                    
                    <button id="withdraw-final-btn" class="btn-universal btn-purple" disabled onclick="Core.finance.executeSwap()">EXECUTE SWAP & WITHDRAW</button>
                </div>
            </div>
        </section>

    </main>

    <nav class="navigation-hub">
        <div class="nav-link active" onclick="Core.router.navigate('p-home', this)">
            <div class="icon-box">üéÆ</div>
            <span>MINING</span>
        </div>
        <div class="nav-link" onclick="Core.router.navigate('p-tasks', this)">
            <div class="icon-box">üìã</div>
            <span>EARN</span>
        </div>
        <div class="nav-link" onclick="Core.router.navigate('p-friends', this)">
            <div class="icon-box">üë•</div>
            <span>FRIENDS</span>
        </div>
        <div class="nav-link" onclick="Core.router.navigate('p-vault', this)">
            <div class="icon-box">üí∞</div>
            <span>VAULT</span>
        </div>
    </nav>

    <script>
        /**
         * SPYDER CORE v8.0
         * Mod√ºler bir yapƒ± kullanarak t√ºm oyun mantƒ±ƒüƒ±nƒ± kaps√ºller.
         */
        const Core = (() => {
            
            // --- PRIVATE STATE ---
            let _db = null;
            let _tg = window.Telegram.WebApp;
            let _user = {
                id: _tg.initDataUnsafe?.user?.id || "DEBUG_8392479231",
                name: _tg.initDataUnsafe?.user?.first_name || "Spyder_User"
            };

            let _gameState = {
                balance: 0,
                energy: 1000,
                maxEnergy: 1000,
                adsWatched: 0,
                lastSync: Date.now()
            };

            // --- ENGINE MODULES ---
            
            const router = {
                navigate: (targetId, element) => {
                    document.querySelectorAll('.page-node').forEach(p => p.classList.remove('active'));
                    document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                    
                    document.getElementById(targetId).classList.add('active');
                    element.classList.add('active');
                    
                    _tg.HapticFeedback.impactOccurred('medium');
                }
            };

            const mechanics = {
                tap: (event) => {
                    if (_gameState.energy <= 0) {
                        _tg.HapticFeedback.notificationOccurred('warning');
                        return;
                    }

                    // UPDATE STATE: 1 Tƒ±k = 1 Coin
                    _gameState.balance += 1;
                    _gameState.energy -= 1;

                    // UI REFRESH
                    ui.refresh();

                    // FX: Shockwave
                    const trigger = document.getElementById('spider-core');
                    const wave = document.createElement('div');
                    wave.className = 'shockwave';
                    trigger.appendChild(wave);
                    setTimeout(() => wave.remove(), 600);

                    // FX: +1 Floating
                    const touch = event.touches ? event.touches[0] : event;
                    const plus = document.createElement('div');
                    plus.className = 'plus-one-anim';
                    plus.innerText = '+1';
                    plus.style.left = touch.pageX + 'px';
                    plus.style.top = touch.pageY + 'px';
                    document.body.appendChild(plus);
                    setTimeout(() => plus.remove(), 800);

                    _tg.HapticFeedback.impactOccurred('light');
                },
                
                regen: () => {
                    if (_gameState.energy < _gameState.maxEnergy) {
                        _gameState.energy += 1;
                        ui.refreshEnergyOnly();
                    }
                }
            };

            const finance = {
                calculate: () => {
                    const amount = document.getElementById('swap-input-amount').value;
                    const usdtRate = 0.00001;
                    const result = (amount * usdtRate).toFixed(5);
                    document.getElementById('swap-output-val').innerText = result;
                },

                executeSwap: () => {
                    const amount = parseInt(document.getElementById('swap-input-amount').value);
                    const wallet = document.getElementById('user-wallet-addr').value;

                    if (!wallet.startsWith('0x') || wallet.length < 20) {
                        _tg.showAlert("L√ºtfen ge√ßerli bir BEP20 adresi girin.");
                        return;
                    }

                    if (_gameState.balance < amount) {
                        _tg.showAlert("Yetersiz bakiye!");
                        return;
                    }

                    _tg.showConfirm(`${amount} Spyder Coin takas edilsin mi?`, (isConfirmed) => {
                        if (isConfirmed) {
                            _gameState.balance -= amount;
                            _gameState.adsWatched = 0; // Reset ads after withdrawal
                            ui.refresh();
                            persistence.sync();
                            _tg.showAlert("Takas talebiniz blockchain havuzuna g√∂nderildi. Reklam ≈üartƒ± sƒ±fƒ±rlandƒ±.");
                        }
                    });
                }
            };

            const ui = {
                refresh: () => {
                    document.getElementById('spyder-balance-ui').innerText = _gameState.balance.toLocaleString();
                    document.getElementById('energy-numeric').innerText = `${_gameState.energy} / 1000`;
                    document.getElementById('energy-bar-fill').style.width = (_gameState.energy / 10) + "%";

                    // Vault Conditions
                    const withdrawBtn = document.getElementById('withdraw-final-btn');
                    const condBal = document.getElementById('cond-min-bal');
                    const condAds = document.getElementById('cond-ads-count');

                    // 1. Balance Condition (1000)
                    if (_gameState.balance >= 1000) {
                        condBal.innerText = "UNLOCKED";
                        condBal.className = "status-badge badge-unlocked";
                    } else {
                        condBal.innerText = "LOCKED";
                        condBal.className = "status-badge badge-locked";
                    }

                    // 2. Ad Condition (20)
                    condAds.innerText = `${_gameState.adsWatched} / 20`;
                    if (_gameState.adsWatched >= 20) {
                        condAds.className = "status-badge badge-unlocked";
                    } else {
                        condAds.className = "status-badge badge-locked";
                    }

                    // Final Check
                    withdrawBtn.disabled = !(_gameState.balance >= 1000 && _gameState.adsWatched >= 20);
                    finance.calculate();
                },

                refreshEnergyOnly: () => {
                    document.getElementById('energy-numeric').innerText = `${_gameState.energy} / 1000`;
                    document.getElementById('energy-bar-fill').style.width = (_gameState.energy / 10) + "%";
                }
            };

            const persistence = {
                init: async () => {
                    // Firebase Init
                    const config = { apiKey: "AIzaSy...", projectId: "spyder-coin" };
                    firebase.initializeApp(config);
                    _db = firebase.firestore();

                    // User Load
                    const userRef = _db.collection('users').doc(String(_user.id));
                    const doc = await userRef.get();

                    if (doc.exists) {
                        const data = doc.data();
                        _gameState.balance = data.balance || 0;
                        _gameState.adsWatched = data.adsWatched || 0;
                        
                        // Energy calculation based on time offline
                        const offlineTime = Math.floor((Date.now() - (data.lastSync || Date.now())) / 1000);
                        _gameState.energy = Math.min(1000, (data.energy || 1000) + offlineTime);
                    } else {
                        await userRef.set({
                            userId: _user.id,
                            name: _user.name,
                            balance: 0,
                            energy: 1000,
                            adsWatched: 0,
                            lastSync: Date.now()
                        });
                    }
                    ui.refresh();
                },

                sync: async () => {
                    if (!_db) return;
                    await _db.collection('users').doc(String(_user.id)).update({
                        balance: _gameState.balance,
                        energy: _gameState.energy,
                        adsWatched: _gameState.adsWatched,
                        lastSync: Date.now()
                    });
                    console.log("[SpyderSync] Cloud storage updated.");
                }
            };

            // --- PUBLIC API ---
            return {
                init: () => {
                    _tg.ready();
                    _tg.expand();
                    persistence.init();
                    
                    // Listeners
                    document.getElementById('tapper-trigger').addEventListener('touchstart', (e) => {
                        e.preventDefault();
                        mechanics.tap(e);
                    });

                    // Heartbeat (Regen)
                    setInterval(mechanics.regen, 1500);
                    // Cloud Heartbeat (Sync)
                    setInterval(persistence.sync, 15000);
                },
                router,
                finance
            };

        })();

        // BOOTSTRAP SYSTEM
        window.onload = Core.init;
    </script>
</body>
</html>
